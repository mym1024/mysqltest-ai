ALTER SYSTEM SET merge_delay_interval='6s' server_type=yaodatasvr;
ALTER SYSTEM SET major_freeze_wait_time='6s' server_type=yaoadminsvr;
ALTER SYSTEM SET  min_major_freeze_interval='5s' server_type=yaotxnsvr;
ALTER SYSTEM SET min_merge_interval='5s' server_type=yaodatasvr;
ALTER SYSTEM SET  max_merge_thread_num='20' server_type=yaodatasvr;
drop table if exists t1;
alter system set min_drop_cache_wait_time='10s' server_type=yaodatasvr;
create hash partition function h1(x)'x+1';
create table t1(id int primary key,c1 int,c2 decimal(25,0)) partition by(hs,h1,id);
show partition groups;
group_name	start_version	paxos_id	reserver_field1
hs#0	2	0	NULL
hs#1	2	1	NULL
hs#10	2	0	NULL
hs#11	2	1	NULL
hs#12	2	0	NULL
hs#2	2	0	NULL
hs#3	2	1	NULL
hs#4	2	0	NULL
hs#5	2	1	NULL
hs#6	2	0	NULL
hs#7	2	1	NULL
hs#8	2	0	NULL
hs#9	2	1	NULL
create index t1_index1 on t1 (c1) storing (c2);
create index t1_index2 on t1 (c2) storing (c1);
Okay
create or replace sequence seq;
insert into t1 values(nextval for seq,nextval for seq+nextval for seq,0);
insert into t1 values(nextval for seq,nextval for seq+nextval for seq,prevval for seq),(nextval for seq,nextval for seq+nextval for seq,prevval for seq),(nextval for seq,nextval for seq+nextval for seq,prevval for seq),(nextval for seq,nextval for seq+nextval for seq,prevval for seq),(nextval for seq,nextval for seq+nextval for seq,prevval for seq),(nextval for seq,nextval for seq+nextval for seq,prevval for seq),(nextval for seq,nextval for seq+nextval for seq,prevval for seq),(nextval for seq,nextval for seq+nextval for seq,prevval for seq),(nextval for seq,nextval for seq+nextval for seq,prevval for seq),(nextval for seq,nextval for seq+nextval for seq,prevval for seq),(nextval for seq,nextval for seq+nextval for seq,prevval for seq),(nextval for seq,nextval for seq+nextval for seq,prevval for seq),(nextval for seq,nextval for seq+nextval for seq,prevval for seq);
"merge"
major_freeze...
__3001__idx__t1_index1
__3001__idx__t1_index2
set yao_query_timeout=900000000;
select * from __3001__idx__t1_index1;
id	c1	c2
1	2	0
2	4	1
3	6	1
4	8	1
5	10	1
6	12	1
7	14	1
8	16	1
9	18	1
10	20	1
11	22	1
12	24	1
13	26	1
14	28	1
select * from __3001__idx__t1_index2;
id	c1	c2
1	2	0
2	4	1
3	6	1
4	8	1
5	10	1
6	12	1
7	14	1
8	16	1
9	18	1
10	20	1
11	22	1
12	24	1
13	26	1
14	28	1
select * from t1;
id	c1	c2
1	2	0
2	4	1
3	6	1
4	8	1
5	10	1
6	12	1
7	14	1
8	16	1
9	18	1
10	20	1
11	22	1
12	24	1
13	26	1
14	28	1
select * from __3001__idx__t1_index1;
id	c1	c2
1	2	0
2	4	1
3	6	1
4	8	1
5	10	1
6	12	1
7	14	1
8	16	1
9	18	1
10	20	1
11	22	1
12	24	1
13	26	1
14	28	1
select * from __3001__idx__t1_index2;
id	c1	c2
1	2	0
2	4	1
3	6	1
4	8	1
5	10	1
6	12	1
7	14	1
8	16	1
9	18	1
10	20	1
11	22	1
12	24	1
13	26	1
14	28	1
delete from t1 where id = prevval for seq;
select * from t1;
id	c1	c2
1	2	0
2	4	1
3	6	1
4	8	1
5	10	1
6	12	1
7	14	1
8	16	1
9	18	1
10	20	1
11	22	1
12	24	1
13	26	1
select * from __3001__idx__t1_index1;
id	c1	c2
1	2	0
2	4	1
3	6	1
4	8	1
5	10	1
6	12	1
7	14	1
8	16	1
9	18	1
10	20	1
11	22	1
12	24	1
13	26	1
select * from __3001__idx__t1_index2;
id	c1	c2
1	2	0
2	4	1
3	6	1
4	8	1
5	10	1
6	12	1
7	14	1
8	16	1
9	18	1
10	20	1
11	22	1
12	24	1
13	26	1
delete from t1 where id = prevval for seq1;
ERROR HY000: YAO-5824: the sequence::[seq1] you input is not exist,please check!
select * from t1;
id	c1	c2
1	2	0
2	4	1
3	6	1
4	8	1
5	10	1
6	12	1
7	14	1
8	16	1
9	18	1
10	20	1
11	22	1
12	24	1
13	26	1
select * from __3001__idx__t1_index1;
id	c1	c2
1	2	0
2	4	1
3	6	1
4	8	1
5	10	1
6	12	1
7	14	1
8	16	1
9	18	1
10	20	1
11	22	1
12	24	1
13	26	1
select * from __3001__idx__t1_index2;
id	c1	c2
1	2	0
2	4	1
3	6	1
4	8	1
5	10	1
6	12	1
7	14	1
8	16	1
9	18	1
10	20	1
11	22	1
12	24	1
13	26	1
delete from t1 where id = prevval for seq +1;
select * from t1;
id	c1	c2
1	2	0
2	4	1
3	6	1
4	8	1
5	10	1
6	12	1
7	14	1
8	16	1
9	18	1
10	20	1
11	22	1
12	24	1
13	26	1
select * from __3001__idx__t1_index1;
id	c1	c2
1	2	0
2	4	1
3	6	1
4	8	1
5	10	1
6	12	1
7	14	1
8	16	1
9	18	1
10	20	1
11	22	1
12	24	1
13	26	1
select * from __3001__idx__t1_index2;
id	c1	c2
1	2	0
2	4	1
3	6	1
4	8	1
5	10	1
6	12	1
7	14	1
8	16	1
9	18	1
10	20	1
11	22	1
12	24	1
13	26	1
delete from t1 where id >= prevval for seq;
select * from t1;
id	c1	c2
1	2	0
2	4	1
3	6	1
4	8	1
5	10	1
6	12	1
7	14	1
8	16	1
9	18	1
10	20	1
11	22	1
12	24	1
13	26	1
select * from __3001__idx__t1_index1;
id	c1	c2
1	2	0
2	4	1
3	6	1
4	8	1
5	10	1
6	12	1
7	14	1
8	16	1
9	18	1
10	20	1
11	22	1
12	24	1
13	26	1
select * from __3001__idx__t1_index2;
id	c1	c2
1	2	0
2	4	1
3	6	1
4	8	1
5	10	1
6	12	1
7	14	1
8	16	1
9	18	1
10	20	1
11	22	1
12	24	1
13	26	1
delete from t1 where id >= prevval for seq-2;
select * from t1;
id	c1	c2
1	2	0
2	4	1
3	6	1
4	8	1
5	10	1
6	12	1
7	14	1
8	16	1
9	18	1
10	20	1
11	22	1
select * from __3001__idx__t1_index1;
id	c1	c2
1	2	0
2	4	1
3	6	1
4	8	1
5	10	1
6	12	1
7	14	1
8	16	1
9	18	1
10	20	1
11	22	1
select * from __3001__idx__t1_index2;
id	c1	c2
1	2	0
2	4	1
3	6	1
4	8	1
5	10	1
6	12	1
7	14	1
8	16	1
9	18	1
10	20	1
11	22	1
create or replace sequence seq;
delete from t1 where id = prevval for seq;
ERROR HY000: YAO--1: THE PREVVAL expression of  sequence [seq] can't be used before using NEXTVAL
select * from t1;
id	c1	c2
1	2	0
2	4	1
3	6	1
4	8	1
5	10	1
6	12	1
7	14	1
8	16	1
9	18	1
10	20	1
11	22	1
select * from __3001__idx__t1_index1;
id	c1	c2
1	2	0
2	4	1
3	6	1
4	8	1
5	10	1
6	12	1
7	14	1
8	16	1
9	18	1
10	20	1
11	22	1
select * from __3001__idx__t1_index2;
id	c1	c2
1	2	0
2	4	1
3	6	1
4	8	1
5	10	1
6	12	1
7	14	1
8	16	1
9	18	1
10	20	1
11	22	1
create or replace sequence seq;
delete from t1 where id <= prevval for seq;
ERROR HY000: YAO--1: THE PREVVAL expression of  sequence [seq] can't be used before using NEXTVAL
select * from t1;
id	c1	c2
1	2	0
2	4	1
3	6	1
4	8	1
5	10	1
6	12	1
7	14	1
8	16	1
9	18	1
10	20	1
11	22	1
select * from __3001__idx__t1_index1;
id	c1	c2
1	2	0
2	4	1
3	6	1
4	8	1
5	10	1
6	12	1
7	14	1
8	16	1
9	18	1
10	20	1
11	22	1
select * from __3001__idx__t1_index2;
id	c1	c2
1	2	0
2	4	1
3	6	1
4	8	1
5	10	1
6	12	1
7	14	1
8	16	1
9	18	1
10	20	1
11	22	1
create or replace sequence seq;
delete from t1 where id = prevval for seq +1;
ERROR HY000: YAO--1: THE PREVVAL expression of  sequence [seq] can't be used before using NEXTVAL
select * from t1;
id	c1	c2
1	2	0
2	4	1
3	6	1
4	8	1
5	10	1
6	12	1
7	14	1
8	16	1
9	18	1
10	20	1
11	22	1
select * from __3001__idx__t1_index1;
id	c1	c2
1	2	0
2	4	1
3	6	1
4	8	1
5	10	1
6	12	1
7	14	1
8	16	1
9	18	1
10	20	1
11	22	1
select * from __3001__idx__t1_index2;
id	c1	c2
1	2	0
2	4	1
3	6	1
4	8	1
5	10	1
6	12	1
7	14	1
8	16	1
9	18	1
10	20	1
11	22	1
create or replace sequence seq;
delete from t1 where id <= prevval for seq +1;
ERROR HY000: YAO--1: THE PREVVAL expression of  sequence [seq] can't be used before using NEXTVAL
select * from t1;
id	c1	c2
1	2	0
2	4	1
3	6	1
4	8	1
5	10	1
6	12	1
7	14	1
8	16	1
9	18	1
10	20	1
11	22	1
select * from __3001__idx__t1_index1;
id	c1	c2
1	2	0
2	4	1
3	6	1
4	8	1
5	10	1
6	12	1
7	14	1
8	16	1
9	18	1
10	20	1
11	22	1
select * from __3001__idx__t1_index2;
id	c1	c2
1	2	0
2	4	1
3	6	1
4	8	1
5	10	1
6	12	1
7	14	1
8	16	1
9	18	1
10	20	1
11	22	1
create or replace sequence seq;
delete from t1 where id = prevval for seq +prevval for seq;
ERROR HY000: YAO--1: THE PREVVAL expression of  sequence [seq] can't be used before using NEXTVAL
select * from t1;
id	c1	c2
1	2	0
2	4	1
3	6	1
4	8	1
5	10	1
6	12	1
7	14	1
8	16	1
9	18	1
10	20	1
11	22	1
select * from __3001__idx__t1_index1;
id	c1	c2
1	2	0
2	4	1
3	6	1
4	8	1
5	10	1
6	12	1
7	14	1
8	16	1
9	18	1
10	20	1
11	22	1
select * from __3001__idx__t1_index2;
id	c1	c2
1	2	0
2	4	1
3	6	1
4	8	1
5	10	1
6	12	1
7	14	1
8	16	1
9	18	1
10	20	1
11	22	1
create or replace sequence seq;
delete from t1 where id <= prevval for seq +prevval for seq;
ERROR HY000: YAO--1: THE PREVVAL expression of  sequence [seq] can't be used before using NEXTVAL
select * from t1;
id	c1	c2
1	2	0
2	4	1
3	6	1
4	8	1
5	10	1
6	12	1
7	14	1
8	16	1
9	18	1
10	20	1
11	22	1
select * from __3001__idx__t1_index1;
id	c1	c2
1	2	0
2	4	1
3	6	1
4	8	1
5	10	1
6	12	1
7	14	1
8	16	1
9	18	1
10	20	1
11	22	1
select * from __3001__idx__t1_index2;
id	c1	c2
1	2	0
2	4	1
3	6	1
4	8	1
5	10	1
6	12	1
7	14	1
8	16	1
9	18	1
10	20	1
11	22	1
select nextval for seq from t1;
nextval for seq
1
2
3
4
5
6
7
8
9
10
11
delete from t1 where id between 10 and prevval for seq;
select * from t1;
id	c1	c2
1	2	0
2	4	1
3	6	1
4	8	1
5	10	1
6	12	1
7	14	1
8	16	1
9	18	1
select * from __3001__idx__t1_index1;
id	c1	c2
1	2	0
2	4	1
3	6	1
4	8	1
5	10	1
6	12	1
7	14	1
8	16	1
9	18	1
select * from __3001__idx__t1_index2;
id	c1	c2
1	2	0
2	4	1
3	6	1
4	8	1
5	10	1
6	12	1
7	14	1
8	16	1
9	18	1
select nextval for seq from t1;
nextval for seq
12
13
14
15
16
17
18
19
20
delete from t1 where id between 9 and prevval for seq+1;
select * from t1;
id	c1	c2
1	2	0
2	4	1
3	6	1
4	8	1
5	10	1
6	12	1
7	14	1
8	16	1
select * from __3001__idx__t1_index1;
id	c1	c2
1	2	0
2	4	1
3	6	1
4	8	1
5	10	1
6	12	1
7	14	1
8	16	1
select * from __3001__idx__t1_index2;
id	c1	c2
1	2	0
2	4	1
3	6	1
4	8	1
5	10	1
6	12	1
7	14	1
8	16	1
select nextval for seq from t1;
nextval for seq
21
22
23
24
25
26
27
28
delete from t1 where id between 9 and prevval for seq+prevval for seq;
select * from t1;
id	c1	c2
1	2	0
2	4	1
3	6	1
4	8	1
5	10	1
6	12	1
7	14	1
8	16	1
select * from __3001__idx__t1_index1;
id	c1	c2
1	2	0
2	4	1
3	6	1
4	8	1
5	10	1
6	12	1
7	14	1
8	16	1
select * from __3001__idx__t1_index2;
id	c1	c2
1	2	0
2	4	1
3	6	1
4	8	1
5	10	1
6	12	1
7	14	1
8	16	1
select nextval for seq from t1;
nextval for seq
29
30
31
32
33
34
35
36
delete from t1 where id between 9 and prevval for seq+prevval for seq1;
ERROR HY000: YAO-5824: the sequence::[seq1] you input is not exist,please check!
select * from t1;
id	c1	c2
1	2	0
2	4	1
3	6	1
4	8	1
5	10	1
6	12	1
7	14	1
8	16	1
select * from __3001__idx__t1_index1;
id	c1	c2
1	2	0
2	4	1
3	6	1
4	8	1
5	10	1
6	12	1
7	14	1
8	16	1
select * from __3001__idx__t1_index2;
id	c1	c2
1	2	0
2	4	1
3	6	1
4	8	1
5	10	1
6	12	1
7	14	1
8	16	1
create or replace sequence seq quick;
delete from t1 where id = prevval for seq;
ERROR HY000: YAO--1: THE PREVVAL expression of  sequence [seq] can't be used before using NEXTVAL
select * from t1;
id	c1	c2
1	2	0
2	4	1
3	6	1
4	8	1
5	10	1
6	12	1
7	14	1
8	16	1
select * from __3001__idx__t1_index1;
id	c1	c2
1	2	0
2	4	1
3	6	1
4	8	1
5	10	1
6	12	1
7	14	1
8	16	1
select * from __3001__idx__t1_index2;
id	c1	c2
1	2	0
2	4	1
3	6	1
4	8	1
5	10	1
6	12	1
7	14	1
8	16	1
create or replace sequence seq quick;
select nextval for seq;
nextval for seq
1
delete from t1 where id = prevval for seq;
select * from t1;
id	c1	c2
2	4	1
3	6	1
4	8	1
5	10	1
6	12	1
7	14	1
8	16	1
select * from __3001__idx__t1_index1;
id	c1	c2
2	4	1
3	6	1
4	8	1
5	10	1
6	12	1
7	14	1
8	16	1
select * from __3001__idx__t1_index2;
id	c1	c2
2	4	1
3	6	1
4	8	1
5	10	1
6	12	1
7	14	1
8	16	1
create or replace sequence seq quick;
select nextval for seq;
nextval for seq
1
delete from t1 where id <= prevval for seq;
select * from t1;
id	c1	c2
2	4	1
3	6	1
4	8	1
5	10	1
6	12	1
7	14	1
8	16	1
select * from __3001__idx__t1_index1;
id	c1	c2
2	4	1
3	6	1
4	8	1
5	10	1
6	12	1
7	14	1
8	16	1
select * from __3001__idx__t1_index2;
id	c1	c2
2	4	1
3	6	1
4	8	1
5	10	1
6	12	1
7	14	1
8	16	1
