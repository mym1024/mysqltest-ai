ALTER SYSTEM SET merge_delay_interval='6s' server_type=yaodatasvr;
ALTER SYSTEM SET major_freeze_wait_time='6s' server_type=yaoadminsvr;
ALTER SYSTEM SET  min_major_freeze_interval='5s' server_type=yaotxnsvr;
ALTER SYSTEM SET min_merge_interval='5s' server_type=yaodatasvr;
ALTER SYSTEM SET  max_merge_thread_num='20' server_type=yaodatasvr;
drop table if exists t1;
create table t1(c1 int primary key, c2 int);
insert into t1 values(1,1),(2,2),(3,3);
set @a=1,@b=1;
create trigger test before update on t1 for each row 
begin case 
when new.c1=3 
then set new.c1=5;
end case;
end|
update t1 set c2=4 where c1=3;
select * from t1;
c1	c2
1	1
2	2
5	4
drop table if exists t1;
create table t1(c1 int primary key, c2 int);
insert into t1 values(1,1),(2,2),(3,3);
set @a=1,@b=1;
create trigger test before update on t1 for each row 
begin case 
when @a=5
then set @a=1;
end case;
end|
set @a=5;
update t1 set c1=4 where c1=1;
select @a;
@a
1
select * from t1;
c1	c2
2	2
3	3
4	1
drop table if exists t1;
create table t1(c1 int primary key, c2 int);
insert into t1 values(1,1),(2,2),(3,3);
set @a=1,@b=1;
create trigger test
before update on t1 
for each row
begin add_num:LOOP 
SET new.c1=new.c1+1 ;
IF new.c1>10 THEN LEAVE add_num;
END IF;
END LOOP add_num ;
end|
update t1 set c2=4 where c1=1;
select * from t1;
c1	c2
2	2
3	3
11	4
drop table if exists t1;
create table t1(c1 int primary key, c2 int);
insert into t1 values(1,1),(2,2),(3,3);
set @a=1,@b=1;
create trigger test 
before update on t1 
for each row
begin 
set new.c1=new.c1+1;
end|
update t1 set c2=5 where c1=3;
select * from t1;
c1	c2
1	1
2	2
4	5
drop table if exists t1;
create table t1(c1 int primary key, c2 int);
insert into t1 values(1,1),(2,2),(3,3);
set @a=1,@b=1;
create TRIGGER test 
before update on t1 
for each row
begin 
set @a=@a+1;
end|
update t1 set c2=5 where c1=1;
select @a;
@a
2
drop table if exists t1;
create table t1(c1 int primary key, c2 int);
insert into t1 values(1,1),(2,2),(3,3);
set @a=1,@b=1;
create TRIGGER test
before update on t1
for each row 
begin 
IF new.c1=7 THEN 
set new.c1=new.c1+1;
END IF;
end|
update t1 set c2=4 where c1=2;
select * from t1;
c1	c2
1	1
2	4
3	3
drop table if exists t1;
create table t1(c1 int primary key, c2 int);
insert into t1 values(1,1),(2,2),(3,3);
set @a=1,@b=1;
create trigger test before update on t1  
for each row 
begin  
add_num:LOOP  
SET new.c1=new.c1+1; 
IF new.c1>10 THEN LEAVE add_num; 
END IF; 
END LOOP add_num ;  
end|
update t1 set c2=5 where c1=2;
select * from t1;
c1	c2
1	1
3	3
11	5
drop table if exists t1;
create table t1(c1 int primary key, c2 int);
insert into t1 values(1,1),(2,2),(3,3);
set @a=1,@b=1;
create trigger test 
before update on t1 
for each row 
begin REPEAT 
set new.c1=new.c1+1; 
UNTIL new.c1=20  
end repeat; 
end|
update t1 set c2=6 where c1=1;
select * from t1;
c1	c2
2	2
3	3
20	6
drop table if exists t1;
create table t1(c1 int primary key, c2 int);
insert into t1 values(1,1),(2,2),(3,3);
set @a=1,@b=1;
create trigger test
before update on t1 
for each row  begin REPEAT 
set @a=@a+1;
UNTIL @a=30 
end repeat; 
end|
set @a=1;
update t1 set c2=7 where c1=2;
select @a;
@a
30
drop table if exists t1;
create table t1(c1 int primary key, c2 int);
insert into t1 values(1,1),(2,2),(3,3);
set @a=1,@b=1;
create trigger test before update on t1 for each row 
begin WHILE new.c1=3 
DO 
set new.c1=new.c1+1;
end while; 
end|
update t1 set c2=6 where c1=3;
select * from t1;
c1	c2
1	1
2	2
4	6
drop table if exists t1;
create table t1(c1 int primary key, c2 int);
insert into t1 values(1,1),(2,2),(3,3);
set @a=1,@b=1;
create trigger test 
before update on t1 
for each row 
begin WHILE @a=11
DO set @a=@a+1;
end while;
end|
set @a=11;
update t1 set c2=5 where c1=2;
select @a;
@a
12
drop table if exists t1;
create table t1(c1 int primary key, c2 int);
insert into t1 values(1,1),(2,2),(3,3);
set @a=1,@b=1;
create trigger test
before update on t1 
for each row  begin add_num:LOOP
SET @a=@a+1 ;
IF(@a<new.c1)
THEN iterate add_num;
end if;set @b=@b+1; 
IF(@a=new.c1) 
THEN leave add_num;
END IF;
END LOOP add_num; 
end|
set @a=1,@b=1;
insert into t1 values (20,20);
update t1 set c2=5 where c1=20;
select @a, @b;
@a	@b
20	2
drop table if exists t1;
create table t1(c1 int primary key, c2 int);
insert into t1 values(1,1),(2,2),(3,3);
set @a=1,@b=1;
create TRIGGER test
before update on t1
for each row
begin 
end|
update t1 set c2=6 where c1=2;
select * from t1;
c1	c2
1	1
2	6
3	3
drop table if exists t1;
create table t1(c1 int primary key, c2 int);
insert into t1 values(1,1),(2,2),(3,3);
set @a=1,@b=1;
create trigger test before update on t1 for each row begin prepare stmt from select c2 from t1 ;end|
ERROR HY000: YAO-7013: trigger does not support prepare statement now
drop table if exists t1;
create table t1(c1 int primary key, c2 int);
insert into t1 values(1,1),(2,2),(3,3);
set @a=1,@b=1;
create trigger test before update on t1 for each row 
begin
WHILE @a<70 DO 
if @a<30 then set @a=old.c1+@a;
else  set @a=old.c1+@a+10;
end if; 
end while;
end|
set @a=1;
update t1 set c2=5 where c1=2;
select @a;
@a
79
drop table if exists t1;
create table t1(c1 int primary key, c2 int);
insert into t1 values(1,1),(2,2),(3,3);
set @a=1,@b=1;
create trigger test before update on t1  for each row begin WHILE @a<70 DO if @a<30 then set @a=10+@a;else  set @a=@a+2;end if; end while;end|
set @a=1;
update t1 set c2=5 where c1=2;
select @a;
@a
71
drop table if exists t1;
create table t1(c1 int primary key, c2 int);
insert into t1 values(1,1),(2,2),(3,3);
set @a=1,@b=1;
create trigger test before update on t1 for each row  
begin 
add_num:LOOP 
case when @a<10 then set @a=old.c1+@a;
when @a>9 then set @a=old.c1+@a+10; 
end case; 
IF @a>15 THEN LEAVE add_num;
END IF;
END LOOP add_num ;	
end|
set @a=1;
update t1 set c2=31 where c1=1;
select @a;
@a
21
drop table if exists t1;
create table t1(c1 int primary key, c2 int);
insert into t1 values(1,1),(2,2),(3,3);
set @a=1,@b=1;
create trigger test before update on t1 for each row 
begin 
add_num:LOOP 
case when @a<10 then set @a=@a+1;
end case; 
IF @a>5 THEN LEAVE add_num;
END IF;
END LOOP add_num ;
end|
set @a=1;
update t1 set c2=31 where c1=1;
select @a;
@a
6
drop table if exists t1;
create table t1(c1 int primary key, c2 int);
insert into t1 values(1,1),(2,2),(3,3);
set @a=1,@b=1;
create trigger test 
after update on t1 
for each row  
begin case when @a=1 then set @a=5; 
end case; 
end|
update t1 set c2=5 where c1=2;
select @a;
@a
5
drop table if exists t1;
create table t1(c1 int primary key, c2 int);
insert into t1 values(1,1),(2,2),(3,3);
set @a=1,@b=1;
create trigger test 
after update on t1 
for each row 
begin add_num:LOOP SET @a=@a+1 ;
IF @a>10 THEN LEAVE add_num;
END IF;
END LOOP add_num ; 
end|
set @a=1;
update t1 set c2=5 where c1=2;
select @a;
@a
11
drop table if exists t1;
create table t1(c1 int primary key, c2 int);
insert into t1 values(1,1),(2,2),(3,3);
set @a=1,@b=1;
create trigger test 
after update on t1 
for each row 
begin 
set @a=@a+1; 
end|
set @a=11;
update t1 set c2=5 where c1=2;
select @a;
@a
12
drop table if exists t1;
create table t1(c1 int primary key, c2 int);
insert into t1 values(1,1),(2,2),(3,3);
set @a=1,@b=1;
create TRIGGER test 
after update on t1 
for each row  
begin IF new.c1>0 
THEN set @a=new.c1+1; 
END IF;
end|
set @a=1;
update t1 set c2=10 where c1=2;
select @a;
@a
3
drop table if exists t1;
create table t1(c1 int primary key, c2 int);
insert into t1 values(1,1),(2,2),(3,3);
set @a=1,@b=1;
create trigger test after update on t1 for each row  begin REPEAT set @a=@a+1; UNTIL @a>30   end repeat; end|
set @a=21;
update t1 set c2=5 where c1=2;
select @a;
@a
31
drop table if exists t1;
create table t1(c1 int primary key, c2 int);
insert into t1 values(1,1),(2,2),(3,3);
set @a=1,@b=1;
create trigger test after update on t1 for each row  
begin 
add_num:LOOP SET @a=@a+1 ;
IF(@a<30) THEN iterate add_num;end if;set @b=@b+1; IF(@a=30) THEN leave add_num;
END IF;END LOOP add_num; end|
set @a=20;
set @b=0;
update t1 set c2=5 where c1=1;
select @a, @b;
@a	@b
30	1
drop table if exists t1;
create table t1(c1 int primary key, c2 int);
insert into t1 values(1,1),(2,2),(3,3);
set @a=1,@b=1;
create trigger test after update on t1 for each row  begin set @a=1+(select c1 from t1 where c1=old.c1); end|
set @a=5;
update t1 set c2=5 where c1=1;
select @a;
@a
2
drop trigger test;
drop table if exists t1;
create table t1(c1 int primary key, c2 int);
insert into t1 values(1,1),(2,2),(3,3);
drop table if exists t2;
create table t2(c1 int primary key, c2 int);
insert into t2 values(1,1),(2,2),(3,3);
set @a=1,@b=1;
create trigger test after update on t1 for each row  begin  update t2 set c1=20 where c1=old.c1; end|
update t1 set c2=8 where c1=1;
select * from t2;
c1	c2
2	2
3	3
20	1
drop table if exists t1;
create table t1(c1 int primary key, c2 int);
insert into t1 values(1,1),(2,2),(3,3);
drop table if exists t2;
create table t2(c1 int primary key, c2 int);
insert into t2 values(1,1),(2,2),(3,3);
set @a=1,@b=1;
create trigger test after update on t1  for each row begin insert into t2 values(new.c2,3); end|
update t1 set c2=5 where c1=2;
select * from t2;
c1	c2
1	1
2	2
3	3
5	3
drop table if exists t1;
create table t1(c1 int primary key, c2 int);
insert into t1 values(1,1),(2,2),(3,3);
drop table if exists t2;
create table t2(c1 int primary key, c2 int);
insert into t2 values(1,1),(2,2),(3,3);
set @a=1,@b=1;
create trigger test after update on t1  for each row begin delete from t2 where c2=new.c1; end|
update t1 set c2=1 where c1=3;
select * from t2;
c1	c2
1	1
2	2
drop table if exists t1;
create table t1(c1 int primary key, c2 int);
insert into t1 values(1,1),(2,2),(3,3);
drop table if exists t2;
create table t2(c1 int primary key, c2 int);
insert into t2 values(1,1),(2,2),(3,3);
set @a=1,@b=1;
create trigger test after update on t1  for each row begin set @a=20;insert into t2 values(new.c2,2); end|
update t1 set c2=4 where c1=1;
select * from t2;
c1	c2
1	1
2	2
3	3
4	2
drop table if exists t1;
create table t1(c1 int primary key, c2 int);
insert into t1 values(1,1),(2,2),(3,3);
drop table if exists t2;
create table t2(c1 int primary key, c2 int);
insert into t2 values(1,1),(2,2),(3,3);
set @a=1,@b=1;
create trigger test after update on t1  for each row 
begin 
set @a=20;
delete from t1 where c2=new.c2;
repeat set @a=@a+1;
until @a>30 end repeat; 
end|
update t1 set c2=2 where c1=5;
select c1, c2, @a from t2;
c1	c2	@a
1	1	1
2	2	1
3	3	1
drop table if exists t1;
create table t1(c1 int primary key, c2 int);
insert into t1 values(1,1),(2,2),(3,3);
drop table if exists t2;
create table t2(c1 int primary key, c2 int);
insert into t2 values(1,1),(2,2),(3,3);
set @a=1,@b=1;
create trigger test after update on t1  for each row 
begin 
set @a=20;
insert into t2 values(5,5);
repeat set @a=@a+1; 
until @a>35 
end repeat; 
end|
update t1 set c2=1 where c1=1;
select c1, c2, @a from t2;
c1	c2	@a
1	1	36
2	2	36
3	3	36
5	5	36
drop table if exists t1;
create table t1(c1 int primary key, c2 int);
insert into t1 values(1,1),(2,2),(3,3);
drop table if exists t2;
create table t2(c1 int primary key, c2 int);
insert into t2 values(1,1),(2,2),(3,3);
set @a=1,@b=1;
create trigger test 
after update on t1
for each row
begin
prepare stmt from select c2 from t1 where c1=n.c1;
update t1 set n.c2=n.c1 where c1=n.c1;
end|
ERROR HY000: YAO-7013: trigger does not support prepare statement now
drop table if exists t1;
create table t1(c1 int primary key, c2 int);
insert into t1 values(1,1),(2,2),(3,3);
drop table if exists t2;
create table t2(c1 int primary key, c2 int);
insert into t2 values(1,1),(2,2),(3,3);
set @a=1,@b=1;
create trigger test 
after update on t1
for each row
begin
prepare stmt from select c2 from t1 where c1=b;
end|
ERROR HY000: YAO-7013: trigger does not support prepare statement now
drop table if exists t1;
create table t1(c1 int primary key, c2 int);
insert into t1 values(1,1),(2,2),(3,3);
drop table if exists t2;
create table t2(c1 int primary key, c2 int);
insert into t2 values(1,1),(2,2),(3,3);
set @a=1,@b=1;
create trigger test  after update on t1 
for each row 
begin case when @a=5 then set @a=5+old.c1; 
end case; 
end|
set @a=5;
update t1 set c2=2 where c1=3;
select @a;
@a
8
drop table if exists t1;
create table t1(c1 int primary key, c2 int);
insert into t1 values(1,1),(2,2),(3,3);
drop table if exists t2;
create table t2(c1 int primary key, c2 int);
insert into t2 values(1,1),(2,2),(3,3);
set @a=1,@b=1;
create trigger test after update on t1 for each row 
begin case 
when @a=1 then set @a=5; 
end case; 
end|
set @a=1;
update t1 set c2=2 where c1=3;
select @a;
@a
5
drop table if exists t1;
create table t1(c1 int primary key, c2 int);
insert into t1 values(1,1),(2,2),(3,3);
drop table if exists t2;
create table t2(c1 int primary key, c2 int);
insert into t2 values(1,1),(2,2),(3,3);
set @a=1,@b=1;
create TRIGGER test after update on t1 for each row begin IF @a<10 THEN set @a=old.c1+1; END IF;end|
set @a=1;
update t1 set c2=10 where c1=2;
select @a;
@a
3
drop table if exists t1;
create table t1(c1 int primary key, c2 int);
insert into t1 values(1,1),(2,2),(3,3);
drop table if exists t2;
create table t2(c1 int primary key, c2 int);
insert into t2 values(1,1),(2,2),(3,3);
set @a=1,@b=1;
create trigger test after update on t1 for each row 
begin 
add_num:LOOP SET @a=old.c1+@a ;
IF @a>20 THEN LEAVE add_num;
END IF;
END LOOP add_num ; 
end|
set @a=8;
update t1 set c2=10 where c1=2;
select @a;
@a
22
drop table if exists t1;
create table t1(c1 int primary key, c2 int);
insert into t1 values(1,1),(2,2),(3,3);
drop table if exists t2;
create table t2(c1 int primary key, c2 int);
insert into t2 values(1,1),(2,2),(3,3);
set @a=1,@b=1;
create trigger test after update on t1 for each row 
begin 
add_num:LOOP SET @a=2+@a ;
IF @a>30 THEN LEAVE add_num;
END IF;
END LOOP add_num ; 
end|
set @a=26;
update t1 set c2=10 where c1=2;
select @a;
@a
32
drop table if exists t1;
create table t1(c1 int primary key, c2 int);
insert into t1 values(1,1),(2,2),(3,3);
drop table if exists t2;
create table t2(c1 int primary key, c2 int);
insert into t2 values(1,1),(2,2),(3,3);
set @a=1,@b=1;
create trigger test after update on t1 for each row 
begin 
REPEAT set @a=@a+old.c1; 
UNTIL @a>20   end repeat; 
end|
set @a=1;
update t1 set c2=10 where c1=2;
select @a;
@a
21
drop table if exists t1;
create table t1(c1 int primary key, c2 int);
insert into t1 values(1,1),(2,2),(3,3);
drop table if exists t2;
create table t2(c1 int primary key, c2 int);
insert into t2 values(1,1),(2,2),(3,3);
set @a=1,@b=1;
create trigger test after update on t1 for each row 
begin 
add_num:LOOP SET @a=@a+1 ;
IF(@a<40) THEN iterate add_num;
end if;
set @b=@b+1; 
IF(@a=40) THEN leave add_num;
END IF;
END LOOP add_num; 
end|
set @a=36;
set @b=0;
update t1 set c2=3 where c1=3;
select @a, @b;
@a	@b
40	1
drop table if exists t1;
create table t1(c1 int primary key, c2 int);
insert into t1 values(1,1),(2,2),(3,3);
drop table if exists t2;
create table t2(c1 int primary key, c2 int);
insert into t2 values(1,1),(2,2),(3,3);
set @a=1,@b=1;
create trigger test after update on t1 for each row begin update t2 set c2=5 where c1=old.c2; end|
update t1 set c2=15 where c1=1;
select * from t2;
c1	c2
1	5
2	2
3	3
drop table if exists t1;
create table t1(c1 int primary key, c2 int);
insert into t1 values(1,1),(2,2),(3,3);
drop table if exists t2;
create table t2(c1 int primary key, c2 int);
insert into t2 values(1,1),(2,2),(3,3);
set @c=1;
set @a=1,@b=1;
create trigger test 
after update on t1
for each row
begin
set @b=1;
set @c=2;
update t2 set c2=@c+1 where c1=@b+1;
end|
update t1 set c2=5 where c1=1;
select * from t2;
c1	c2
1	1
2	3
3	3
drop table if exists t1;
create table t1(c1 int primary key, c2 int);
insert into t1 values(1,1),(2,2),(3,3);
drop table if exists t2;
create table t2(c1 int primary key, c2 int);
insert into t2 values(1,1),(2,2),(3,3);
set @a=1,@b=1;
create trigger test 
after update on t1
for each row
begin
set @b=2;
delete from t2 where c1=@b+1;
end|
update t1 set c2=6 where c1=1;
select * from t2;
c1	c2
1	1
2	2
drop table if exists t1;
create table t1(c1 int primary key, c2 int);
insert into t1 values(1,1),(2,2),(3,3);
drop table if exists t2;
create table t2(c1 int primary key, c2 int);
insert into t2 values(1,1),(2,2),(3,3);
set @a=1,@b=1;
create trigger test 
after update
on t1
for each row
begin
end;|
update t1 set c2=7 where c1=1;
select * from t2;
c1	c2
1	1
2	2
3	3
drop table if exists t1;
create table t1(c1 int primary key, c2 int);
insert into t1 values(1,1),(2,2),(3,3);
drop table if exists t2;
create table t2(c1 int primary key, c2 int);
insert into t2 values(1,1),(2,2),(3,3);
set @a=1,@b=1;
create trigger test 
after update on t1
for each row
begin
prepare stmt from select c2 from t1;
end|
ERROR HY000: YAO-7013: trigger does not support prepare statement now
drop table if exists t1;
create table t1(c1 int primary key, c2 int);
insert into t1 values(1,1),(2,2),(3,3);
drop table if exists t2;
create table t2(c1 int primary key, c2 int);
insert into t2 values(1,1),(2,2),(3,3);
set @a=1,@b=1;
create trigger test after update on t1 for each row 
begin 
update t1 set c2=1 where c1=1; 
prepare stmt from select c2 from t1 where c1=1; 
set @a=15;
end|
ERROR HY000: YAO-7013: trigger does not support prepare statement now
drop table if exists t1;
create table t1(c1 int primary key, c2 int);
insert into t1 values(1,1),(2,2),(3,3);
drop table if exists t2;
create table t2(c1 int primary key, c2 int);
insert into t2 values(1,1),(2,2),(3,3);
set @a=1;
set @a=1,@b=1;
create trigger test after update on t1 for each row 
begin 
delete from t2 where c1=2;
if @a<0 then set @a=5;
end if;	
end|
update t1 set c2=11 where c1=3;
select c1, c2, @a from t2;
c1	c2	@a
1	1	1
3	3	1
