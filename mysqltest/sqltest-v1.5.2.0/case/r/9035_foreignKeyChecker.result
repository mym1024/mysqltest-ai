create table t1(c1 int, c2 varchar(20), c3 double, primary key(c1, c2));
create table tt1(c1 int primary key, c2 int, c3 varchar(20), constraint cst foreign key(c2, c3) references t1(c1,c2));
create table tt2(c1 int primary key, c2 int, c3 varchar(20), foreign key(c2, c3) references t1(c1,c2));
create table tt3(c1 int primary key, c2 int, c3 varchar(20), foreign key(c2, c3) references t1(c1));
ERROR HY000: YAO-16: foreign key type do not match
create table tt3(c1 int primary key, c2 int, c3 varchar(2), foreign key(c2, c3) references t1(c1,c2));
drop table tt3;
create table tt3(c1 int primary key, c2 int, c3 int, foreign key(c2, c3) references t1(c1,c2));
ERROR HY000: YAO-16: foreign key type do not match
create table tt3(c1 int primary key, c2 int, c3 varchar(20), constraint cst foreign key(c2, c3) references t1(c1,c2), constraint cst foreign key(c2, c3) references t1(c1,c2));
ERROR 42S21: YAO-5008: failed to push back foreign key arg
create table tt3(c1 int primary key, c2 int, c3 varchar(20), constraint cst foreign key(c2, c3) references t1(c1,c2), constraint cst1 foreign key(c2, c3) references t1(c1,c2));
create table tt4(c1 int primary key, c2 int, c3 varchar(20), foreign key(c2, c3) references t1(c1,c8));
ERROR HY000: YAO-16: foreign key type do not match
create table tt4(c1 int primary key, c2 int, c3 varchar(25), foreign key(c2, c3) references t1(c1,c2));
show create table tt1;
Table	Create Table
test.tt1	CREATE TABLE tt1 (
c1 INT(10),
c2 INT(10),
c3 VARCHAR (20) COLLATE 'utf8mb4_general_ci',
 PRIMARY KEY(c1),
 CONSTRAINT cst FOREIGN KEY (c2, c3) REFERENCES test.t1(c1, c2) ON UPDATE RESTRICT ON DELETE RESTRICT
) COLLATE = 'utf8mb4_general_ci', COMPRESS_METHOD = 'none', REPLICA_NUM = 3 ;
drop table tt1,tt2,tt3,tt4;
drop table t1;
create table t1(c1 int, c2 decimal(5,2), c3 double, primary key(c1, c2));
create table tt1(c1 int primary key, c2 int, c3 decimal(6,3), foreign key(c2, c3) references t1(c1,c2));
create table tt2(c1 int primary key, c2 int, c3 decimal(4,1), foreign key(c2, c3) references t1(c1,c2));
drop table tt1,tt2;
drop table t1;
create table tt1(c1 int primary key, c2 int, c3 varchar(20), foreign key(c2, c3) references t1(c1,c2));
ERROR HY000: YAO-18: parent table don't exists
create table tt1(c1 int primary key, c2 int, constraint cst foreign key(c2) references tt1(c1));
drop table tt1;
create table tt1(c1 int primary key, c2 int, constraint cst foreign key(c2) references tt1(c1));
alter table tt1 drop foreign key cst1;
ERROR HY000: YAO-16: can not alter an unexist foreign key[cst1]
alter table tt1 drop foreign key cst;
drop table tt1;
create table tt1(c1 int primary key, c2 int);
alter table tt1 add constraint cst foreign key(c2) references tt1(c1);
drop table tt1;
create table tt1(c1 int primary key, c2 int);
insert into tt1 values(1,1);
alter table tt1 add constraint cst foreign key(c2) references tt1(c1);
ERROR HY000: YAO-16: cannot add foreign key in a table which has data before!
drop table tt1;
create table t1(c1 int, c2 varchar(20), c3 double, primary key(c1, c2));
create table tt1(c1 int primary key, c2 int, c3 varchar(20), constraint cst foreign key(c2, c3) references t1(c1,c2));
alter table tt1 drop column c2;
ERROR HY000: YAO-5002: 'c2' : used in a foreign key constraint
alter table t1 drop column c2;
ERROR HY000: YAO-5002: Primary key column can not be dropped, column name = 'c2'
drop table tt1;
drop table t1;
create table t1(c1 int, c2 varchar(20), c3 double, primary key(c1, c2));
create table tt1(c1 int primary key, c2 int, c3 varchar(20), constraint cst foreign key(c2, c3) references t1(c1,c2));
create table tt2(c1 int primary key, c2 int, constraint cst foreign key(c2) references tt2(c1));
truncate table t1;
ERROR HY000: YAO-16: Cannot truncate a table referenced in a foreign key constraint, table_name=test.t1
truncate table tt1;
truncate table tt2;
drop table tt1,tt2;
drop table t1;
create table t1(c1 int, c2 varchar(20), c3 double, primary key(c1, c2));
create table tt1(c1 int primary key, c2 int, c3 varchar(20), constraint cst foreign key(c2, c3) references t1(c1,c2));
create table tt2(c1 int primary key, c2 int, constraint cst foreign key(c2) references tt2(c1));
insert into tt2 values(1,1);
insert into t1 values(1,'1',1);
insert into tt1 values(1,1,'1');
delete from tt1;
delete from t1;
delete from tt2;
insert into tt2 values(2,1),(1,2);
insert into t1 values(1,'1',1);
insert into tt1 values(1,1,'a');
ERROR HY000: YAO-5209: Cannot add or update this row: a foreign key constraint fails!, error code = -5209
delete from tt1;
delete from t1;
set foreign_key_checks=0;
insert into t1 values(1,'1',1);
insert into tt1 values(1,1,'a');
set foreign_key_checks=1;
delete from tt1;
delete from t1;
replace into t1 values(1,'1',1);
replace into tt1 values(1,1,'1');
delete from tt1;
delete from t1;
replace into t1 values(1,'1',1);
replace into tt1 values(1,1,'a');
ERROR HY000: YAO-5209: Cannot add or update this row: a foreign key constraint fails!, error code = -5209
delete from tt1;
delete from t1;
set foreign_key_checks=0;
replace into t1 values(1,'1',1);
replace into tt1 values(1,1,'a');
set foreign_key_checks=1;
delete from tt1;
delete from t1;
insert into t1 values(1,'1',1),(2,'2',2);
delete from t1;
select * from t1;
c1	c2	c3
delete from tt1;
delete from t1;
insert into t1 values(1,'1',1),(2,'2',2);
insert into tt1 values(1,1,'1');
delete from t1;
ERROR 25S03: YAO-119: Cannot add or update this row: a foreign key constraint fails!, error code = -5209
delete from tt1;
delete from t1;
insert into t1 values(1,'1',1),(2,'2',2);
insert into tt1 values(1,1,'1');
set foreign_key_checks=0;
delete from t1;
set foreign_key_checks=1;
delete from tt1;
delete from t1;
insert into t1 values(1,'1',1);
insert into tt1 values(1,1,'1'),(2,1,'1'),(3,1,'1');
delete from tt1 where c1=1;
select * from tt1;
c1	c2	c3
2	1	1
3	1	1
delete from tt1;
delete from t1;
insert into t1 values(1,'1',1),(2,'1',1);
update t1 set c2=2 where c2='1';
select * from t1;
c1	c2	c3
1	2	1
2	2	1
delete from tt1;
delete from t1;
insert into t1 values(1,'1',1),(2,'2',2);
insert into tt1 values(1,1,'1');
update t1 set c1=3;
ERROR 25S03: YAO-119: Cannot add or update this row: a foreign key constraint fails!, error code = -5209
delete from tt1;
delete from t1;
insert into t1 values(1,'1',1),(2,'2',2);
insert into tt1 values(1,1,'1');
set foreign_key_checks=0;
update t1 set c1=3;
set foreign_key_checks=1;
delete from tt1;
delete from t1;
insert into t1 values(1,'1',1),(3,'1',1);
insert into tt1 values(1,1,'1'),(2,1,'1');
update tt1 set c2=3;
select * from t1;
c1	c2	c3
1	1	1
3	1	1
delete from tt1;
delete from t1;
insert into t1 values(1,'1',1);
insert into tt1 values(1,1,'1');
set foreign_key_checks=0;
update tt1 set c2=3 where c1=1;
set foreign_key_checks=1;
replace into tt2 values(1,1),(2,1),(3,1);
update tt2 set c1=c1+1 where c1>1;
select * from tt2;
c1	c2
1	1
3	1
4	1
drop table tt1,tt2;
drop table t1;
create table t1(c1 int, c2 varchar(20), c3 double, primary key(c1, c2));
create table tt1(c1 int primary key, c2 int, c3 varchar(20), constraint cst foreign key(c2, c3) references t1(c1,c2) on update cascade on delete cascade);
insert into t1 values(1,'1',1);
insert into tt1 values(1,1,'1');
delete from tt1;
delete from t1;
replace into t1 values(1,'1',1);
replace into tt1 values(1,1,'1');
delete from tt1;
delete from t1;
insert into t1 values(1,'1',1);
insert into tt1 values(1,1,'1');
delete from t1 where c1=1 and c2='1';
select * from tt1;
c1	c2	c3
select * from t1;
c1	c2	c3
delete from tt1;
delete from t1;
insert into t1 values(1,'1',1);
insert into tt1 values(1,1,'1');
update t1 set c1=3 where c1=1 and c2='1';
select * from tt1;
c1	c2	c3
1	3	1
select * from t1;
c1	c2	c3
3	1	1
create table tt2(c1 int primary key, c2 int, constraint cst foreign key(c2) references tt2(c1) on update cascade on delete cascade);
insert into tt2 values(1,1);
delete from tt2;
replace into tt2 values(2,1),(1,2),(3,3);
delete from tt2 where c1=3;
select * from tt2;
c1	c2
1	2
2	1
delete from tt2;
replace into tt2 values(2,1),(1,1);
update tt2 set c2=c2+1;
select * from tt2;
c1	c2
1	2
2	2
drop table tt1,tt2;
drop table t1;
CREATE TABLE Categories (id INT PRIMARY KEY, name VARCHAR(50));
CREATE TABLE Products (id INT PRIMARY KEY,category_id INT,name VARCHAR(50),FOREIGN KEY (category_id) REFERENCES Categories(id) ON DELETE CASCADE);
INSERT INTO Categories (id, name) VALUES (1, 'Electronics');
INSERT INTO Products (id, category_id, name) VALUES (1, 1, 'Laptop');
DELETE FROM Categories WHERE id = 1;
select * from Categories;
id	name
select * from Products;
id	category_id	name
drop table Products,Categories;
CREATE TABLE Authors (id INT PRIMARY KEY, name VARCHAR(50));
CREATE TABLE Books (id INT PRIMARY KEY,author_id INT,title VARCHAR(50),FOREIGN KEY (author_id) REFERENCES Authors(id) ON DELETE RESTRICT);
INSERT INTO Authors (id, name) VALUES (1, 'Jane Doe');
INSERT INTO Books (id, author_id, title) VALUES (1, 1, 'Book 1');
DELETE FROM Authors WHERE id = 1;
ERROR HY000: YAO-5209: Cannot add or update this row: a foreign key constraint fails!, error code = -5209
select * from Authors;
id	name
1	Jane Doe
select * from Books;
id	author_id	title
1	1	Book 1
update Authors set id =9 where id =1;
ERROR 25S03: YAO-119: Cannot add or update this row: a foreign key constraint fails!, error code = -5209
select * from Authors;
id	name
1	Jane Doe
select * from Books;
id	author_id	title
1	1	Book 1
drop table Books,Authors;
CREATE TABLE Customers (id INT PRIMARY KEY, name VARCHAR(50));
CREATE TABLE Orders (id INT PRIMARY KEY, customer_id INT,order_date DATE, FOREIGN KEY (customer_id) REFERENCES Customers(id) ON UPDATE CASCADE ON DELETE RESTRICT);
INSERT INTO Customers (id, name) VALUES (1, 'John');
INSERT INTO Orders (id, customer_id, order_date) VALUES (1, 1, '2023-01-01');
UPDATE Customers SET name = 'John Smith' WHERE id = 1;
DELETE FROM Customers WHERE id = 1;
ERROR HY000: YAO-5209: Cannot add or update this row: a foreign key constraint fails!, error code = -5209
select * from Customers;
id	name
1	John Smith
select * from Orders;
id	customer_id	order_date
1	1	2023-01-01
drop table Orders,Customers;
drop table if exists t1;
drop table if exists tt1;
create table tt1(c1 int not null, c2 varchar(20) not null, c3 double primary key, unique(c1, c2));
create table t1(c1 int primary key, c2 int, c3 varchar(20), constraint cst foreign key(c2, c3) references tt1(c1,c2));
insert into tt1 values(1,'1',1);
insert into t1 values(1,1,'1');
delete from t1;
delete from tt1;
set foreign_key_checks=0;
insert into tt1 values(1,'1',1);
insert into t1 values(1,1,'a');
select * from t1;
c1	c2	c3
1	1	a
set foreign_key_checks=1;
delete from t1;
delete from tt1;
insert into tt1 values(1,'1',1);
insert into t1 values(1,1,'1');
delete from tt1 where c1=1 and c2='1';
ERROR 25S03: YAO-119: Cannot add or update this row: a foreign key constraint fails!, error code = -5209
select * from tt1;
c1	c2	c3
1	1	1
delete from t1;
delete from tt1;
insert into tt1 values(1,'1',1),(2,'1',2);
update tt1 set c2=2 where c2='1';
select * from tt1;
c1	c2	c3
1	2	1
2	2	2
drop table tt1;
drop table t1;
create table tt2(c1 int not null unique, c2 int, c3 int primary key,constraint cst foreign key(c2) references tt2(c1));
insert into tt2 values(2,1,1),(1,2,2),(3,3,3),(4,4,4),(5,4,5);
delete from tt2;
insert into tt2 values(2,1,1),(1,1,2);
update tt2 set c2=c2+1 ;
select * from tt2;
c1	c2	c3
2	2	1
1	2	2
drop table tt2;
CREATE TABLE t1 (pk INT PRIMARY KEY);
CREATE TABLE T2 (fk INT);
ALTER TABLE T2 ADD FOREIGN KEY (fk) REFERENCES t1 (pk);
RENAME TABLE T2 TO T3;
DROP TABLE T3, t1;
CREATE TABLE table1 (id INT PRIMARY KEY, name VARCHAR(50));
CREATE TABLE table2 (id INT PRIMARY KEY, table1_id INT);
ALTER TABLE table2 ADD  constraint test1 FOREIGN KEY (table1_id) REFERENCES table1 (id);
select * from __all_foreign_key;
gm_create	gm_modify	child_table_id	foreign_key_id	foreign_key_name	parent_table_id	update_action	delete_action	ref_cst_type	ref_cst_id	is_parent_table_mock
2023-12-01 14:17:12.949889	2023-12-01 14:17:12.949889	3039	25	test1	3038	1	1	1	-1	0
alter table table2 drop foreign key test1;
insert into table1 values(1,'aaa'),(2,'bbb');
insert into table2 values(1,11),(2,22);
ALTER TABLE table2 ADD  constraint test2 FOREIGN KEY (table1_id) REFERENCES table1 (id);
ERROR HY000: YAO-16: cannot add foreign key in a table which has data before!
select * from __all_foreign_key;
gm_create	gm_modify	child_table_id	foreign_key_id	foreign_key_name	parent_table_id	update_action	delete_action	ref_cst_type	ref_cst_id	is_parent_table_mock
drop table table2,table1;
create table t1(c1 int, c2 varchar(20), c3 double, primary key(c1, c2));
create table tt1(c1 int primary key, c2 int, c3 varchar(20));
insert into t1 values(1,'1',1);
insert into tt1 values(1,1,'a');
drop table tt1,t1;
CREATE TABLE table1 (id INT PRIMARY KEY, code VARCHAR(50), name VARCHAR(50), unique index idx_1(code));
drop table table1;
CREATE TABLE table1 (id INT PRIMARY KEY, code VARCHAR(50) not null, name VARCHAR(50) not null, unique index idx_1(code) storing(name));
CREATE TABLE table2 (id INT PRIMARY KEY,table1_code VARCHAR(50),FOREIGN KEY (table1_code) REFERENCES table1 (code));
drop table table2,table1;
CREATE TABLE table1 (id INT PRIMARY KEY, name VARCHAR(50));
CREATE TABLE table2 (id INT PRIMARY KEY,table1_id INT, FOREIGN KEY (table1_id) REFERENCES table1 (id));
CREATE TABLE table3 (id INT PRIMARY KEY,table1_id INT, FOREIGN KEY (table1_id) REFERENCES table1 (id));
SELECT * FROM table1 INNER JOIN table2 ON table1.id = table2.table1_id;
id	name	id	table1_id
SELECT * FROM table1 INNER JOIN table3 ON table1.id = table3.table1_id;
id	name	id	table1_id
INSERT INTO table1 (id, name) VALUES (1, 'Table1 Row');
INSERT INTO table2 (id, table1_id) VALUES (1, 1);
INSERT INTO table3 (id, table1_id) VALUES (1, 1);
DELETE FROM table1 WHERE id = 1;
ERROR HY000: YAO-5209: Cannot add or update this row: a foreign key constraint fails!, error code = -5209
select * from table1;
id	name
1	Table1 Row
select * from table2;
id	table1_id
1	1
select * from table3;
id	table1_id
1	1
drop table table3,table2,table1;
CREATE TABLE table1 ( id INT PRIMARY KEY, name VARCHAR(50));
CREATE TABLE table2 ( id INT PRIMARY KEY, table1_id INT, FOREIGN KEY (table1_id) REFERENCES table1 (id));
CREATE USER 'user' IDENTIFIED BY 'test@123';
GRANT SELECT, INSERT ON test.table2 TO 'user';
SELECT * FROM table2;
id	table1_id
INSERT INTO table1 (id,name) VALUES (1, 'aa');
ERROR HY000: YAO-5036: no privilege
INSERT INTO table2 (id, table1_id) VALUES (1, 1);
ERROR HY000: YAO-5036: No privilege, error code = -5036
GRANT SELECT, INSERT ON test.table1 TO 'user';
INSERT INTO table2 (id, table1_id) VALUES (1, 1);
ERROR HY000: YAO-5209: Cannot add or update this row: a foreign key constraint fails!, error code = -5209
update table2 set table1_id = 2;
ERROR HY000: YAO-5036: no privilege
drop table table2,table1;
CREATE TABLE customers (customer_id INT PRIMARY KEY,customer_name VARCHAR(50));
CREATE TABLE orders (order_id INT PRIMARY KEY,customer_id INT, order_date DATE, FOREIGN KEY (customer_id) REFERENCES customers (customer_id));
INSERT INTO customers (customer_id, customer_name) VALUES (1, 'John');
INSERT INTO orders (order_id, customer_id, order_date) VALUES (1, 1, '2021-01-01');
INSERT INTO orders (order_id, customer_id, order_date) VALUES (2, 1, '2021-02-01');
CREATE VIEW v AS
SELECT orders.order_id, customers.customer_name, orders.order_date FROM orders INNER JOIN customers ON orders.customer_id = customers.customer_id;
SELECT * FROM v;
order_id	customer_name	order_date
2	John	2021-02-01
1	John	2021-01-01
drop view v;
drop table customers,orders;
CREATE TABLE table1 (id INT PRIMARY KEY AUTO_INCREMENT,name VARCHAR(50));
CREATE TABLE table2 (id INT PRIMARY KEY AUTO_INCREMENT, table1_id INT, FOREIGN KEY (table1_id) REFERENCES table1 (id));
INSERT INTO table1 (name) VALUES ('Row 1');
INSERT INTO table2 (table1_id) VALUES (1);
select * from table2;
id	table1_id
1	1
drop table table2,table1;
