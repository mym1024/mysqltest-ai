###########################################################################################
###1.测试功能点：枚举分区函数下的批量更新，前后插入数据类型同与不同
##
#
###2.测试项：（每新添一测试项,需在添加前注明测试项,注释填写在新添sql前,不填在此处,如下样例）
###2.问题网址：xxx
###3.问题号：xxx
###4.预计运行时间：58s
###5.编写/修改人：hexiangsong
###6.编写/修改日期：2019-12-05
###7.其它（选填）：case格式规范化修改
###
##
#
###########################################################################################

####################################Do sql######################################################
#枚举函数分区
###2-1：对应列的数据类型相同
# Same data type
--disable_warnings
drop table if exists t1,t2;
--error 5077
drop partition function e;
--enable_warnings
create enum partition function e(x)'[(1)],[(2)],[(3)],[(4)],[(5)],[(6)],[(7)],[(8)],[(9)],[(10.25)]';
create table t1 (c1 int primary key ,c2 varchar(30),c3 datetime,c4 float ,c5 decimal(5,4),c6 bool) partition by(em,e,c1);
create table t2 (c1 int primary key ,c2 varchar(30),c3 datetime,c4 float ,c5 decimal(5,4),c6 bool) partition by(em,e,c1);
--real_sleep 3
insert into t2 values(1,'jiomn','2019-06-07 17:25:28',1.256,2.568,0),(2,'jiomn','2019-06-07 17:25:28',1.256,2.568,0),(3,'jiomn','2019-06-07 17:25:28',1.256,2.568,0),(4,'jiomn','2019-06-07 17:25:28',1.256,2.568,0),(5,'jiomn','2019-06-07 17:25:28',1.256,2.568,0),(6,'jiomn','2019-06-07 17:25:28',1.256,2.568,0),(7,'jiomn','2019-06-07 17:25:28',1.256,2.568,0),(8,'jiomn','2019-06-07 17:25:28',1.256,2.568,0),(9,'jiomn','2019-06-07 17:25:28',1.256,2.568,0);
--real_sleep 3

#--error 5702
insert into t2 (c1,c2,c5) values(10,'linfang',2.568);
--real_sleep 3
insert into t1(c1,c5) select c1,c5 from t2 where c1>10;
--real_sleep 3
select * from t1;
select * from t2;

#--error 5702
--error 2
insert into t1 (c1,c2,c3) values(11,14,5.2634);
--real_sleep 3
select * from t1;
#添加--error -119 -linfang
#--error 119
insert into t2 (c1,c2,c5) select c1,c2,c3 from t1 where c1=11;
--real_sleep 3
select * from t2;
--error 5702
insert into t2 (c1,c2,c6) values(15.345,16.35,'2015-07-09 12:45:56');
--real_sleep 3
select * from t2;
insert into t1 (c1 ,c5) select c1,c6 from t2 where c1>15;
--real_sleep 3
select * from t1;
insert into t1(c1,c2) select c6,c6 from t2 where c1>16;
--real_sleep 3
select * from t1;
show partition groups;

###2-2：对应列的数据类型不同
#Different data types
--disable_warnings
drop table if exists t1,t2;
--error 5077
drop partition function g;
--enable_warnings

create enum partition function g(x)'[(1)],[(2)],[(3)],[(4)],[(5)],[(6)],[(7)],[(8)],[(9)],[(10.25)]';
create table t1 (c1 int primary key ,c2 int ,c3 decimal(5,4),c4 bool ,c5 varchar(30)) partition by(em,g,c1);
create table t2 (c1 float ,c2 double,c3 bool ,c4 int ,c5 decimal(3,2),c6 datetime,primary key (c1,c2));
--real_sleep 3
insert into t2 (c1,c2,c3) values(1.56,2.87,2);
--real_sleep 3
select * from t2;
--error 119
insert into t1 (c1 ,c2) select c1,c2 from t2;
--real_sleep 3
select * from t1;

insert into t2(c1,c2) values(5.36,6.46);
--real_sleep 3
select * from t2;
--error 119
insert into t1 (c1,c3) select c1,c2 from t2 where c1>2;
--real_sleep 3
select * from t1;

--error 119
insert into t1(c1,c3) select c2,c1 from t2 where c1>2;
--real_sleep 3
select * from t1;

insert into t2 (c1,c2,c5) values(8.65,9.123,4.25);
--real_sleep 3
--error 119
insert into t1 (c1,c2 ) select c1,c5 from t2 where c1>6;
--real_sleep 3
select * from t1;
select * from t2;
--error 119
insert into t1(c1,c3) select c2,c5 from t2 where c1>6;
--real_sleep 3
select * from t1;

show partition groups;
