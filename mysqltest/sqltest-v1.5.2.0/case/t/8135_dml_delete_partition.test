##############################################################################################
###1.测试功能点：指定分区规则，对表进行delete操作
##
#
###2.测试项：(每新添一测试项，需在添加前注明测试项，注释填写在新添sq1前，不填在此处，如下样例）
###3.问题网址：xxx
###4.问题号：xxx
###5.预计运行时间：xxx
###6.编写/修改人：zhuyinying
###7.编写/修改日期：2019-12-23
###8.其他（选填）：case格式规范化修改
###
##
#
##############################################################################################

#####################################Do sql###################################################
--disable_warnings
drop table if exists t1;
drop table if exists t2;
drop table if exists t3;
drop table if exists t4;
--enable_warnings

###2-1:list分区规则，单主键
create table t1(a int primary key,b int) partition by list(a)(partition a1 values in(1,3),partition a2 values in(2,4));
insert into t1 values(1,0),(2,0),(3,0);
delete from t1;
delete from t1 where a =1 ;
delete from t1 where a =2 ;
delete from t1 where a =3 ;
--real_sleep 5
select * from t1;

insert into t1 values(1,0),(2,0),(3,0);
delete from t1 where a =1 ;
--real_sleep 5
select * from t1;

insert into t1 values(1,0);
replace into t1 values(2,0),(3,0);
delete from t1 where a =1 ;
delete from t1 where a =2 ;
--real_sleep 5
select * from t1 where a=1;
select * from t1 where a=1 or a=2;

select * from t1 where a=1 or a=2 or a=3;
delete from t1 where a=1 or a=2 or a=3;
--real_sleep 5
select * from t1;
insert into t1 values(1,0),(2,0);
delete from t1 where a =1 ;
delete from t1 where a =2 ;
delete from t1 where a =3 ;
--real_sleep 5
select * from t1;
drop table t1;

###2-2:hash分区规则，多主键
--error 5077
drop partition function h1;
create hash partition function h1(x,y,z) 'x+y+z+1';
create table t2 (p1 int,p2 int,p3 int,p4 int,primary key(p1,p2,p3))partition by(ta2,h1,p1,p2,p3);
--real_sleep 6
insert into t2 values(1,1,1,0),(2,2,2,0),(3,3,3,0),(4,4,4,0),(5,4,4,0),(6,4,4,0),(7,4,6,0),(8,4,6,0),(9,4,6,0),(10,4,6,0),(11,4,6,0),(12,4,6,0),(13,4,6,0);
delete from t2 where p1=1;
--real_sleep 5
--let $p=13
while($p)
{
      eval delete from t2 where p1=$p and p2=$p and p3=$p;
      dec $p;
}
--real_sleep 5
select * from t2;
select p1,p3 from t2;

replace into t2 values(1,1,1,0),(2,2,2,0),(3,3,3,0),(4,4,4,0),(5,4,4,0),(6,4,4,0),(7,4,6,0),(8,4,6,0),(9,4,6,0),(10,4,6,0),(11,4,6,0),(12,4,6,0),(13,4,6,0);
delete from t2 where p1=1 and p2=1 and p3=1;
--real_sleep 10
select * from t2;
select p1,p3 from t2;
replace into t2 values(1,1,1,0),(2,2,2,0),(3,3,3,0),(4,4,4,0),(5,4,4,0),(6,4,4,0),(7,4,6,0),(8,4,6,0),(9,4,6,0),(10,4,6,0),(11,4,6,0),(12,4,6,0),(13,4,6,0);
--real_sleep 5
#--error 119
delete from t2 where p1 in(1,2,3,6,13,0);
--real_sleep 10
select * from t2;
drop table t2;
drop partition function h1;

###2-3:range分区规则，多主键
create table t3 (p1 int,p2 int,p3 int,primary key(p1,p2))partition by range columns(p1,p2)(partition r1 values less than (5,5),partition r2 values less than (10,10),partition r3 values less than (15,15),partition r4 values less than (maxvalue,maxvalue));
--real_sleep 10
insert into t3 values(1,1,1),(2,2,2),(3,3,3),(4,4,4),(5,4,4),(6,4,4),(7,4,6),(8,4,6),(9,4,6),(10,4,6),(11,4,6),(12,4,6),(13,4,6);
delete from t3 where p1=1 and p2=1 and p3=1;
--real_sleep 10
select * from t3;
select p1,p3 from t3;

replace into t3 values(1,1,1),(2,2,2),(3,3,3),(4,4,4),(5,4,4),(6,4,4),(7,4,6),(8,4,6),(9,4,6),(10,4,6),(11,4,6),(12,4,6),(13,4,6);
--real_sleep 5
#--error 119
delete from t3 where p1>3 or p3>=6;
--real_sleep 10
select * from t3;
select p1,p3 from t3;
delete from t3 where p1=1 and p3=2;
--real_sleep 5
select * from t3;
select p1,p3 from t3;
delete from t3 where p1=1 and p2=1 and p3=1;
--real_sleep 5
select * from t3;
select p1,p3 from t3;

replace into t3 values(1,1,1),(2,2,2),(3,3,3),(4,4,4),(5,4,4),(6,4,4),(7,4,6),(8,4,6),(9,4,6),(10,4,6),(11,4,6),(12,4,6),(13,4,6);
--real_sleep 5
#--error 119
delete from t3 where p1 in(1,2,3,6,13,0);
--real_sleep 10
select * from t3;


###2-4:enum分区规则，多主键
--error 5077
drop partition function e4;
create enum partition function e4(x,y)'[(a,41)],[(b,42)],[(c,43)]';
create table t4 (p1 varchar(100),p2 int,p3 datetime,p4 int,primary key(p1,p2)) partition by(ta4,e4,p1,p2);

--real_sleep 3
insert into t4 values('a',41,'2012-10-23 17:14:00',0),('b',42,'2012-10-23 17:15:00',0),('c',43,'2012-10-23 17:16:00',0);
--real_sleep 10
select * from t4;
delete from t4 where p2='42';
--real_sleep 5
select * from t4;
delete from t4 where p2<'401' and p1='c';
delete from t4 where p1='a' and p2=41 and p3='2012-10-23 17:14:00';
--real_sleep 5
select * from t4;
drop table t4;
drop partition function e4;
###///新添测试项///###
###2-x:(新增测试项说明)
#do sql
########################################################################################################
