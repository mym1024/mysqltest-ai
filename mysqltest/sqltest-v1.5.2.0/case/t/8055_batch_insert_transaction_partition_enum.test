###########################################################################################
###1.测试功能点：partition_enum：批量带事务插入
##
#
###2.测试项：（每新添一测试项,需在添加前注明测试项,注释填写在新添sql前,不填在此处,如下样例）
###2.问题网址：xxx
###3.问题号：xxx
###4.预计运行时间：663.766943.s
###5.编写/修改人：lyy
###6.编写/修改日期：2019-11-01
###7.其它（选填）：case格式规范化修改
###
##
#
###########################################################################################

####################################Do sql######################################################

###2-1：单主键：非自动提交的选择性插入(commit)
--disable_warnings
drop table if exists t1,t2;
--error 5077
drop partition function h;
create enum partition function h(x)'[(1)],[(2)],[(3)]';
--enable_warnings
create table t1 (c1 int primary key ,c2 float ,c3 datetime,c4 decimal(5,3),c5 bool,c6 varchar(30)) partition by(em,h,c1);
create table t2 (c1 int primary key ,c2 float ,c3 datetime,c4 decimal(5,3),c5 bool,c6 varchar(30)) partition by(em,h,c1);
--real_sleep 3
insert into t2 values(1,1.232,'2015-07-07 12:00:00',2.33,0,'hahhaha'),(2,1.2582,'2015-07-09 21:00:00',2.33,0,'ha211haha'),(3,45.232,'2015-07-04 12:00:00',2.33,0,'hahhaha');
--real_sleep 3
--error 5702
insert into t2 values(4,44.444,'2017-03-03 12:00:00',4.33,0,'linf');
--real_sleep 3
set autocommit=0;
--real_sleep 3
#--error 5047
insert into t1 select * from t2;
--real_sleep 3
select * from t1;
commit;
--real_sleep 3
select * from t1;
set autocommit=1;
--real_sleep 3
select * from t2;

###2-2：单主键：非自动提交的选择性插入(rollback)
--disable_warnings
drop table if exists t1,t2;
--error 5077
drop partition function h2;
create enum partition function h2(x)'[(1)],[(2)],[(3)],[(4)]';
--real_sleep 3
--enable_warnings
create table t1 (c1 int primary key,c2 float ,c3 datetime,c4 decimal(5,3),c5 bool,c6 varchar(30)) partition by(em,h2,c1);
create table t2 (c1 int primary key,c2 float ,c3 datetime,c4 decimal(5,3),c5 bool,c6 varchar(30)) partition by(em,h2,c1);
--real_sleep 3
insert into t2 values(1,1.232,'2015-07-07 12:00:00',2.33,0,'hahhaha'),(2,1.2582,'2015-07-09 21:00:00',2.33,0,'ha211haha'),(3,45.232,'2015-07-04 12:00:00',2.33,0,'hahhaha');
insert into t2 values(4,45.232,'2015-07-04 12:00:00',2.33,0,'hahhaha');
--error 5702
insert into t2 values(5,55.555,'2015-05-05 12:00:00',5.55,0,'linf');
set autocommit=0;
select * from t2;
#--error 5047
insert into t1 select * from t2 where c1<4;
insert into t1 select * from t2 where c1=4;
select * from t1;
rollback;
select * from t1;
set autocommit=1;

###2-3:单主键：非自动提交的选择性插入（rollback）
--disable_warnings
drop table if exists t1,t2;
--error 5077
drop partition function h3;
create enum partition function h3(x)'[(1)],[(2)],[(3)],[(4)]';
--enable_warnings
create table t1 (c1 int primary key,c2 float ,c3 datetime,c4 decimal(5,3),c5 bool,c6 varchar(30)) partition by(em,h3,c1);
create table t2 (c1 int primary key,c2 float ,c3 datetime,c4 decimal(5,3),c5 bool,c6 varchar(30)) partition by(em,h3,c1);
--real_sleep 3
insert into t2 values(1,1.232,'2015-07-07 12:00:00',2.33,0,'hahhaha'),(2,1.2582,'2015-07-09 21:00:00',2.33,0,'ha211haha'),(3,45.232,'2015-07-04 12:00:00',2.33,0,'hahhaha');
insert into t2 values(4,45.232,'2015-07-04 12:00:00',2.33,0,'hahhaha');
--real_sleep 3
--error 5702
insert into t2 values(5,55.555,'2015-05-05 12:00:00',5.55,0,'linf');
--real_sleep 3
set autocommit=0;
select * from t2;
#--error 5047
insert into t1 select * from t2 where c1<4;
insert into t1 select * from t2 where c1=4;
select * from t1;
rollback;
select * from t1;
set autocommit=1;

###2-4：单主键：非自动提交的选择性插入(commit)
--disable_warnings
drop table if exists t1,t2;
--error 5077
drop partition function h4;
create enum partition function h4(x)'[(1)],[(2)],[(3)],[(4)]';
--enable_warnings
create table t1 (c1 int primary key ,c2 float ,c3 datetime,c4 decimal(5,3),c5 bool,c6 varchar(30)) partition by(em,h4,c1);
create table t2 (c1 int primary key ,c2 float ,c3 datetime,c4 decimal(5,3),c5 bool,c6 varchar(30)) partition by(em,h4,c1);
--real_sleep 3
insert into t2 values(1,1.232,'2015-07-07 12:00:00',2.33,0,'hahhaha'),(2,1.2582,'2015-07-09 21:00:00',2.33,0,'ha211haha'),(3,45.232,'2015-07-04 12:00:00',2.33,0,'hahhaha');
insert into t2 values(4,45.232,'2015-07-04 12:00:00',2.33,0,'hahhaha');
--error 5702
insert into t2 values(5,55.555,'2015-05-05 12:00:00',5.55,0,'linf');
set autocommit=0;
select * from t2;
--error 5001
insert into t1 select * from t2 where c1<4 multi_batch;
--error 5001
insert into t1 select * from t2 where c1=4 multi_batch;
select * from t1;
commit;
select * from t1;
set autocommit=1;

###2-5：单主键：非自动提交的选择性插入(multi_batch,rollback)
--disable_warnings
drop table if exists t1,t2;
--error 5077
drop partition function h5;
create enum partition function h5(x)'[(1)],[(2)],[(3)],[(4)]';
--enable_warnings
create table t1 (c1 int primary key ,c2 float ,c3 datetime,c4 decimal(5,3),c5 bool,c6 varchar(30)) partition by(em,h5,c1);
create table t2 (c1 int primary key ,c2 float ,c3 datetime,c4 decimal(5,3),c5 bool,c6 varchar(30)) partition by(em,h5,c1);
set autocommit=0;
--real_sleep 3
insert into t2 values(1,1.232,'2015-07-07 12:00:00',2.33,0,'hahhaha'),(2,1.2582,'2015-07-09 21:00:00',2.33,0,'ha211haha'),(3,45.232,'2015-07-04 12:00:00',2.33,0,'hahhaha');
insert into t1 select * from t2 multi_batch;
insert into t2 values(4,45.232,'2015-07-04 12:00:00',2.33,0,'hahhaha');
--error 5702
insert into t2 values(5,55.555,'2015-05-05 12:00:00',5.55,0,'linf');
--error 5001
insert into t1 select * from t2 where c1=4 multi_batch;
select * from t1;
rollback;
select * from t1;
set autocommit=1;
select * from t2;

###2-6：单主键：非自动提交的选择性插入(rollback,multi_batch)
--disable_warnings
drop table if exists t1,t2;
--error 5077
drop partition function h6;
create enum partition function h6(x)'[(1)],[(2)],[(3)],[(4)]';
--enable_warnings
create table t1 (c1 int primary key ,c2 float ,c3 datetime,c4 decimal(5,3),c5 bool,c6 varchar(30)) partition by(em,h6,c1);
create table t2 (c1 int primary key ,c2 float ,c3 datetime,c4 decimal(5,3),c5 bool,c6 varchar(30)) partition by(em,h6,c1);
set autocommit=0;
--real_sleep 3
insert into t2 values(1,1.232,'2015-07-07 12:00:00',2.33,0,'hahhaha'),(2,1.2582,'2015-07-09 21:00:00',2.33,0,'ha211haha'),(3,45.232,'2015-07-04 12:00:00',2.33,0,'hahhaha');
insert into t1 select * from t2;
insert into t2 values(4,45.232,'2015-07-04 12:00:00',2.33,0,'hahhaha');
--error 5702
insert into t2 values(5,55.555,'2015-05-05 12:00:00',5.55,0,'linf');
--error 5001
insert into t1 select * from t2 where c1=4 multi_batch;
select * from t1;
rollback;
select * from t1;
set autocommit=1;
select * from t2;
