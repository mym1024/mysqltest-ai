####################################必填######################################################
###1.测试功能点：不指定分区规则，测试count distinct的使用
##
#
###2.测试项：(每新添一测试项，需在添加前注明测试项，注释填写在新添sq1前，不填在此处，如下样例）
###3.问题网址：xxx
###4.问题号：xxx
###5.预计运行时间：xxx
###6.编写/修改人：zhuyinying
###7.编写/修改日期：2019-12-23
###8.其他（选填）：case格式规范化修改
###
##
#
##############################################################################################

#####################################Do sql###################################################


###2-1:count distinct
--disable_warnings
drop table if exists t1,t2,t3;
--enable_warnings

create table t1(libname varchar(21) not null,city varchar(256), primary key(libname));
create table t2(isbn varchar(21) not null,author varchar(256),title varchar(256), primary key(isbn));
create table t3(isbn varchar(21) not null,libname varchar(21) not null,quantity int, primary key(isbn,libname));

insert into t2 values('001','Daffy','A duck''s life');
insert into t2 values('002','Bugs','A rabbit\'s life');
insert into t2 values('003','Cowboy','Life on the range');
insert into t2 values('000','Anonymous','Wanna buy this book?');
insert into t2 values('004','Best Seller','One Heckuva book');
insert into t2 values('005','EveryoneBuys','This very book');
insert into t2 values('006','San Fran','It is a san fran lifestyle');
insert into t2 values('007','BerkAuthor','Cool.Berkley.the.book');
insert into t3 values('000','New York Public Libra','1');
insert into t3 values('001','New York Public Libra','2');
insert into t3 values('002','New York Public Libra','3');
insert into t3 values('003','New York Public Libra','4');
insert into t3 values('004','New York Public Libra','5');
insert into t3 values('005','New York Public Libra','6');
insert into t3 values('006','San Fransisco Public','5');
insert into t3 values('007','Berkeley Public1','3');
insert into t3 values('007','Berkeley Public2','3');
insert into t3 values('001','NYC Lib','8');
insert into t1 values('New York Public Libra','New York');
insert into t1 values('San Fransisco Public','San Fran');
insert into t1 values('Berkeley Public1','Berkeley');
insert into t1 values('Berkeley Public2','Berkeley');
insert into t1 values('NYC Lib','New York');

select t2.isbn,city,t1.libname,count(t1.libname) as a from t3 left join t1 on t3.libname=t1.libname left join t2 on t3.isbn=t2.isbn group by city,t1.libname;
select t2.isbn,city,count(distinct t1.libname) as a from t3 left join t1 on t3.libname=t1.libname left join t2 on t3.isbn=t2.isbn group by city having count(distinct t1.libname)>1;
#select t2.isbn,city,t1.libname,count(distinct t1.libname) as a from t3 left join t1 on t3.libname=t1.libname left join t2 on t3.isbn=t2.isbn group by city having count(distinct concat(t1.libname,'a'))>1;
#
#select t2.isbn,city,@bar:=t1.libname,count(distinct t1.libname) as a 
#       from t3 left join t1 on t3.libname=t1.libname left join t2
#    	on t3.isbn=t2.isbn group by city having count(distinct
#   	t1.libname) >1;
##
##wrong result,see bug#49872
##
#select @bar
#
#select t2.isbn,city,concat(@bar:=t1.libname),count(distinct t1.libname) as a 
#       from t3 left join t1 on t3.libname=t1.libname left join t2
#    	on t3.isbn=t2.isbn group by city having count(distinct
#   	t1.libname) >1;
##
##wrong result,see bug#49872
##
#select @bar
#
drop table t1,t2,t3;


create table t1(f1 int primary key,f2 int);
insert into t1 values(1,1);
create table t2(f1 int primary key,f2 int);
#select t1.f1,count(distinct t2.f2),count(distinct 1,NULL) from t1 left join t2 on t1.f1=t2.f1 group by t1.f1;
drop table t1,t2;

create table t1(f int primary key,f2 int);
select count(distinct f) from t1;
drop table t1;


create table t1(a char(3),b char(20),c int,primary key(a,b));
insert into t1(a,b) values('ABW','Dutch'),('ABW','English');
select count(distinct a) from t1 group by b;
drop table t1;


###///新添测试项///###
###2-x:(新增测试项说明)
#do sql
########################################################################################################
