##############################################################################################
###1.测试功能点：测试:= 赋值、&&运算符、子查询变量赋值
#                 
#
###2.测试项：(每新添一测试项，需在添加前注明测试项，注释填写在新添sq1前，不填在此处，如下样例）
###3.问题网址：
###4.问题号：
###5.预计运行时间：
###6.编写/修改人：zhangt
###7.编写/修改日期：2024-02
###8.其他（选填）：新增
###
##
#
##############################################################################################

#####################################Do sql###################################################
set character_set_results='utf8mb4';
set character_set_connection='utf8mb4';
set character_set_client='utf8mb4';
###2-1：测试:= 赋值
create table t1(c1 int primary key, c2 int);
insert into t1 values (1,1),(2,2),(3,3);
update t1 set c1:=4 where c1=1;
#--error 119
--error 7
UPDATE t1 SET c2 = 2 WHERE c1 = @var1:= 3;
--error 5001
update t1 set c1:=c2:=5 where c1=2;
set @arg1:=1;
set @arg1:=@arg2:=1;
SELECT @var1 := 1, @var2 := 2;
SELECT @var1, @var2 := @var1;
SELECT @var1:=COUNT(*) FROM t1;
SELECT @var1, @var2 := @var1 := 3, @var1;
SELECT @var1, @var1:=@var1+1;
select @var1:=c1 from t1;
select @var1:=c1+1 from t1;
select (@var1:=c1)+1, @var1 from t1;
select concat('123', @var1:='yaobase'), @var1;
select @var1:=(select count(*) from t1), @var1;
ALTER TABLE t1 ADD new_column INT DEFAULT 100;
SHOW COLUMNS FROM t1;
UPDATE t1 SET new_column := c1 + 10;
SELECT * FROM t1;
--error 5001
DELETE FROM t1 WHERE new_column := 13;
SELECT @new_column1 := c2 + new_column  FROM t1;
drop table t1;

create table t1(c1 int primary key,c2 float,c3 varchar(20));
create table t2(c1 int primary key,c2 float,c3 varchar(20));
insert into t1 values(1,1,'西安'),(2,2,'北京'),(3,3,'');
insert into t2 values(1,2,'下雨'),(2,3,'晴天');
#set常值
set @var1:= NULL;
set @var1:= 'yaobase';
#set基本运算
set @var1:= (2!=1);
set @var1:= 1 in (2,3,4);
set @var1:= 0 or 3;
set @var1:= 14/3;
set @var1:=1+1;
set @var1:=@var1+1;
set @var1:=@var2:=2*2;
set @var1:=@var2:=@var1*2+@var2;
#set单表多表查询
set @var1:=(select c1+c2 from t1 where c2 =1);
set @var1:=(select c1*c2 from t1 where c2 =1);
#--error 78
set @var1:=(select c1/(c2-1) from t1 where c2 =1);
--error 5601
set @var1:=(select c1 from t1 where c1 >1);
set @var1:=(2 in (select c1 from t1));
--error 5601
set @var1:=(select c1 from t1 where c1 in(2,3,4));
set @var1:=not(select c1 from t1 where c1 >5);
set @var1:=(select max(c1) from t1);
--error 5007
set @var1:= (select *,rank() over (partition by c1 order by c2 desc) as ranking from t1);
set @var1:=(select avg(c1) from t1);
set @var1=(select max(t1.c1)+max(t2.c2) from t1,t2);
set @var1:=(select count(*) from t1 inner join t2 on t1.c1=t2.c1);
set @var1:=(select count(*) from t1 left join t2 on t1.c1=t2.c1);
set @var1:=(select count(*) from t1 right join t2 on t1.c1=t2.c1);
--error 5601
set @var1:=(select count(*) from t1 left join t2 on t1.c1=t2.c1 union select count(*) from t1 right join t2 on t1.c1=t2.c1);
#update常值
update t1 set c2 :=2 where c1=3;
update t2 set c2 :=NULL where c1=1;
update t2 set c3 :='yaobase' where c1=1;
#update赋值运算
update t1 set c2 :=2*2 where c1=3;
update t1 set c2 :=@var1*2 where c1=3;
--error 5001
update t1 set c2:=@var1:=1 where c1=3;
--error 7
update t1 set c2 := 1 where c1=@var1:=3;
update t1 set c2:= (2!=1)where c1 =1;
update t1 set c2:=@var1 in (2,3,4) where c1=1;
update t1 set c2:= 0 or 3 where c1=1;
update t1 set c2:= @var1/3 where c1=3;
update t1 set c2:= (@var1+5)*3 where c1=3;
#不查表赋值
select @var1:=1,@var2:=2;
select @var1,@var2:=@var1;
select @var1,@var2:=@var1*2;
select @var1:=5*4,@var2:=10-4;
select @var1:=count(*) from t1;
select @var1,@var2:=@var1:=3,@var1;
select ceil(@var1:=1.1);
select ceil(@var1:=@var2:=1.1);
select round(@var1:=@var2/@var1+1.2);
select @var1,@var1:=@var1+1;
#group by having
set @var3:=1;
select c2,count(*) from t1 group by c2 having c2 =@var1:=@var2:=@var3;
--error 5001
select * from t1 limit 4 offset @var1:=3;
--error 7
delete from t1 where c1= @var1:=1;
#select单表多表查询
select @var1:=c1 from t1;
select @var1:=c2*2 from t1 where c1 =3;
select (@var1:= c2)+1,@var1 from t1 where c1 = 3;
select concat('123',@var1:='yao'),@var1;
select @var1:=(select count(*) from t1),@var1;
select @var1:=@var2:=1;
select @var1:=@var2:=c2 from t1 where c1 =3;
select @var1:=@var2:=count(*) from t1;
select @var1:=(select c1+c2 from t1 where c1 =1);
select @var1:=(select c1+c2 from t1 where c1  in (1,2,3) limit 1);
select @var1:=not(select c2 from t1 where c2<2);
select count(*) from t1 left join t2 on t1.c1=t2.c1 union select count(*) from t1 right join t2 on t1.c1=t2.c1;
select @var1:=(select max(t1.c1)+max(t2.c2)from t1,t2);
#用户变量赋值
select c2, case when c1>@var1:=1 then 'yes' else'no' end from t1;
select c2, case when c1=@var1:=NULL then 'yes' else'no' end from t1;
select c1,c2, case when c3=@var1:='yaobase' then 'yes' else'no' end from t2;
#插入列值为用户变量赋值表达式
insert into t1 values(111,1,@var1:=1);
insert into t1 values(112,4,@var1:=NULL);
insert into t1 values(113,2,@var1:=@var2);
insert into t1 values(114,3,@var1:=@var2:=3);
insert into t1 values(115,@var1:=5,@var2:=5);
insert into t1 values(116,@var1:=@var2:=6,@var2:=@var1);
insert into t1 values(117,@var1:=@var1+@var2,@var2:=@var2/@var1);

###2-2：测试&&运算符
drop table t1,t2;
create table t1(c1 int primary key,c2 float,c3 varchar(20));
create table t2(c1 int primary key,c2 float,c3 varchar(20));
insert into t1 values(1,1,'西安'),(2,2,'北京'),(3,3,'');
insert into t2 values(1,2,'下雨'),(2,3,'晴天');
select 1 && 0;
select 0 && 0;
select 1.2 && 1;
select 1.2 && 0.1;
select -1.2 && 2.2;
select -1.2 && 0.2;
select -1.2 && 0;
select '1' && '0';
select '0' && '0';
select 'a' && 'b';
select '1.2' && '0.1';
select '1.2' && '0';
select 1+2 && 0+0;
select 1-2 && 2-2;
select 1.2*2 && 2*0;
#--error 78
select 1.2/2 && 2/0;
select 1=2 && 0=0;
select 1<2 && 0.2<2;
select 2>2 && 0.2>2;
select 2<=2 && 0.2<=2;
select 2>=2 && 0.2>=2;
select 2!=2 && 0.2!=2;
select t1.c1 = 2 && t2.c1 from t1,t2;
select t1.c2 = 2 && t2.c2 = 1 from t1,t2;
select t1.c3 = '西安' && t2.c3 = '下雨' from t1,t2;
select c3 != '' && c1 is not null from t1;
select * from t1 where c1 = 1 && c2 = 1;
select * from t1 where c1 < 2 && c2 < 4;
select * from t1 where c1 > 2 && c2 > 4;
select * from t1 where c1 <= 2 && c2 <= 4;
select * from t1 where c1 >= 2 && c2 >= 4;
select * from t1 where c1 != 2 && c2 != 4;
select * from t1 where c1 = 1 && c3 = '西安';
select c1 between 1 && 3 from t1;
select c3 from t1 where c1 in (select c1 from t2 where c2<2) && c2 = 2;
select c3 from t1 where c1 in (select c1 from t2 where c2<2) && (select 1);
select char_length(c1) = 1 && char_length(c2) = 1 from t1;
select concat(c1,'') = 1 &&  concat(c2,'1') = 1 from t1;
select 2<=2 && 0.2<=2 and 3>2;
select 2<=2 && 0.2<=2 or 3>2;
select 2<=2 && 0.2 !=2 && 3>2;
select 2<=2 && 0.2 !=2 || 3>2;
drop table t1,t2;

###2-3：测试子查询变量赋值功能
#常量
set @s1=null;
select @s1;
set @s1=3;
select @s1;
set @s1=2.3456789;
select @s1;
set @s1='yaobase';
select @s1;
set @s1=(7,8,9);
select @s1;

#常量计算表达式
set @s1=(12+5);
select @s1;
set @s1=(16-3);
select @s1;
set @s1=(7*8);
select @s1;
set @s1=(14/5);
select @s1;
set @s1=(14%5);
select @s1;
set @s1=('b'>'a');
select @s1;
set @s1=(2=(1+3));
select @s1;
set @s1=(1.1!=1);
select @s1;
set @s1=(4 is NULL);
select @s1;
set @s1=(12 is not NULL);
select @s1;
set @s1=(2 between 4 and 6);
select @s1;
set @s1=(1 in (2,3,4));
select @s1;
set @s1=('abc' like '%b%');
select @s1;
set @s1=(0 and 3);
select @s1;
set @s1=(0 or 3);
select @s1;
set @s1=((0 and 3) or (0 or 3));
select @s1;

#单个子查询
set @s1=(select NULL);
select @s1;
create table t1(c1 int,c2 float,c3 char(20),c4 float);
insert into t1 values(1,2,3,4),(2,3,4,5),(3,4,5,6),(4,5,6,7),(5,6,7,8),(6,7,'x',9),(7,8,'dd',10),(8,9,'ddd',11);
set @s1=(select c1+c3 from t1 where c2=2);
select @s1;
set @s1=(select c1-c3 from t1 where c2=2);
select @s1;
set @s1=(select c1*c3 from t1 where c2=2);
select @s1;
set @s1=(select c1/(c2-1) from t1 where c2=2);
select @s1;
set @s1=(select c1%c2 from t1 where c2=2);
select @s1;
set @s1=(select c1 from t1 where c1>10);
select @s1;
set @s1=(select c1 from t1 where c2=4);
select @s1;
--error 5601
set @s1=(select c1 from t1 where c1<10);
--error 5007
set @s1=(select c1,c2 from t1 where c2=4);
set @s1=(select c1 from t1 where c3 like '%x%');
select @s1;
set @s1=(select c1 from t1 where c3 like '%ddd%');
select @s1;
--error 5601
set @s1=(select c1 from t1 where c3 like '%d%');
set @s1=(select c1 from t1 where c1 in (11,12,13));
select @s1;
set @s1=(select c1 from t1 where c1 in (8,9,10));
select @s1;
set @s1=(select c1 from t1 where c2 not in (2,3,4,5,6,7,8));
select @s1;
set @s1=(2 in (select c1 from t1));
select @s1;
--error 5601
set @s1=(select c1 from t1 where c1 in(1,2,3,4));
set @s1=(select c1 from t1 where c4 between 13 and 15);
select @s1;
set @s1=(select c1 from t1 where c4 between 11 and 12);
select @s1;
--error 5601
set @s1=(select c1 from t1 where c4 between 8 and 10);
set @s1=not(select c1 from t1 where c2>10);
select @s1;
set @s1=not(select c1 from t1 where c2=0);
select @s1;
--error 5601
set @s1=not(select c1 from t1 where c2!=0);
set @s1=(select max(c1) from t1);
select @s1;
set @s1=(select min(c1) from t1);
select @s1;
set @s1=(select avg(c3) from t1);
select @s1;
set @s1=(select count(c1) from t1 where c2>2);
select @s1;
set @s1=(select sum(c1) from t1 where c2>2);
select @s1;
create table t2(c1 int,c2 varchar(10),c3 float);
insert into t2 values (1,2,3),(2,3,4),(4,5,6);
set @s1=(select max(t1.c1)+max(t2.c2) from t1,t2);
select @s1;
set @s1=(select max(t1.c1) from t1 inner join t2 on t1.c2=t2.c1);
select @s1;
set @s1=(select t1.c1 from t1 inner join t2 on t1.c4=t2.c2);
select @s1;
set @s1=(select t1.c1 from t1 inner join t2 on t1.c2=t2.c2 where t1.c3 like '%x%');
select @s1;
--error 5601
set @s1=(select t1.c1 from t1 inner join t2 on t1.c2=t2.c2);
set @s1=(select t1.c1 from t1 inner join t2 on t1.c2=t2.c2 limit 1);
select @s1;
set @s1=(select max(t1.c1) from t1 left join t2 on t1.c2=t2.c1);
select @s1;
--error 5601
set @s1=(select t1.c1 from t1 left join t2 on t1.c2=t2.c3);
set @s1=(select t1.c1 from t1 left join t2 on t1.c2=t2.c2 where t1.c3 like '%x%');
select @s1;
--error 5601
set @s1=(select t1.c1 from t1 left join t2 on t1.c2=t2.c2);
set @s1=(select max(t1.c1) from t1 right join t2 on t1.c2=t2.c1);
select @s1;
--error 5601
set @s1=(select t1.c1 from t1 right join t2 on t1.c2=t2.c3);
set @s1=(select t1.c1 from t1 right join t2 on t1.c2=t2.c2 where t1.c3 like '%x%');
select @s1;
--error 5601
set @s1=(select t1.c1 from t1 right join t2 on t1.c2=t2.c2);
set @s1=(select max(t1.c1) from t1 full join t2 on t1.c2=t2.c1);
select @s1;
--error 5601
set @s1=(select t1.c1 from t1 full join t2 on t1.c2=t2.c3);
set @s1=(select t1.c1 from t1 full join t2 on t1.c2=t2.c2 where t1.c3 like '%x%');
select @s1;
--error 5601
set @s1=(select t1.c1 from t1 full join t2 on t1.c2=t2.c2);

#多个子查询
set @s1=(select sum(c3) from t1 where c2+(select max(c2) from t2)>8);
select @s1;
set @s1=((select max(c2) from t1)+(select min(c3) from t1));
select @s1;
set @s1=(select c2 from t1 where c1=(select min(c1) from t2));
select @s1;
set @s1=(select c2 from t1 where c1<(select min(c1) from t2));
select @s1;
--error 5601
set @s1=(select c2 from t1 where c1 between (select min(c3) from t2) and (select max(c3) from t2));
set @s1=(select max(c2) from t1 where c1 between (select min(c3) from t2) and (select max(c3) from t2));
select @s1;
--error 5601
set @s1=(select c1 from t1 where c2 in (select c1 from t2));
set @s1=(select c1 from t1 where c2 in (select c1 from t2) limit 1);
select @s1;
--error 5601 
set @s1=(select c2 from t1 where c1 and (select min(c1) from t2));
--error 5601
set @s1=(select c2 from t1 where c1 or (select min(c1) from t2));
set @s1=((select c1 from t1 where c2=3) and (select c2 from t1 where c2=6));
select @s1;
set @s1=((select c1 from t1 where c2=3) and (select c2 from t1 where c2=0));
select @s1;
--error 5601
set @s1=(select c1 from t1 where c2=3) and (select c2 from t1 where c2!=3);
set @s1=((select c1 from t1 where c2=7) or (select c2 from t1 where c2=8));
select @s1;
set @s1=((select c1 from t1 where c2=3) or (select c2 from t1 where c2=6));
select @s1;
--error 5601
set @s1=((select c1 from t1 where c2>3) or (select c2 from t1 where c2=6));
set @s1=(select max(t1.c1) from t1 inner join (select c2 from t2) as t2_ on t1.c2=t2_.c2);
select @s1;
set @s1=(select max(t1.c1) from t1 inner join (select c2 from t2 where c2>10) as t2_ on t1.c2=t2_.c2);
select @s1; 

###///新添测试项///###
###2-x:(新增测试项说明)
#do sql
########################################################################################################
