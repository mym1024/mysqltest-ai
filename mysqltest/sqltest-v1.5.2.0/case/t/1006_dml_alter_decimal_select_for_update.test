####################################必填######################################################
###1.测试功能点：测试decimal类型作为主键列与非主键列时，select..for update的使用
##
#
###2.测试项：(每新添一测试项，需在添加前注明测试项，注释填写在新添sq1前，不填在此处，如下样例）
###3.问题网址：xxx
###4.问题号：xxx
###5.预计运行时间：xxx
###6.编写/修改人：zhuyinying
###7.编写/修改日期：2019-12-18
###8.其他（选填）：case格式规范化修改
###
##
#
##############################################################################################

#####################################Do sql###################################################
create database test_decimal;
using database test_decimal;
sleep 5;


###2-1：decimal作为非主键列，进行select for update操作，并重新定义decimal的范围
#do sql
create table if not exists t1(c1 int primary key, c2 decimal(5,2), c3 decimal(10,2),c4 varchar(10));
desc t1;
insert into t1 values(1, 1, 1.2, '1.325o');
insert into t1 values(2, 1.2, 1.3, '1.32');
insert into t1 values(3, 1.23, 1.36, 'a.asd');
insert into t1 values(4, 123.234, 1.35, '1.36f');
select * from t1;
select * from t1 where c1=3 for update;

select *,c1+c2 from t1 where c1=4 for update;
select c2*c3 from t1;
select c2*c3 from t1 where c1=2 for update;
select c2/c3 from t1;
select c2/c3 from t1 where c1=2 for update;
select c2-c3 from t1;
select c2-c3 from t1 where c1=2 for update;
select c2+c3 from t1;
select c2+c3 from t1 where c1=2 for update;
##--error 153
select c4*c3 from t1;
##--error 153
select c4*c3 from t1 where c1=4;
##--error 153
select c4+c3 from t1 where c1=4;
##--error 153
select c4-c3 from t1 where c1=4;
##--error 153
select c4/c3 from t1 where c1=4;
##--error 153
select c4*c3 from t1 where c1=1;
##--error 153
select c4+c3 from t1 where c1=1;
##--error 153
select c4-c3 from t1 where c1=1;
##--error 153
select c4/c3 from t1 where c1=1;
select c4*c3 from t1 where c1=2 for update;
select c1*c3 from t1;
select c1*c3 from t1 where c1=2 for update;
##--error 153
select c4/c3 from t1;
select c4/c3 from t1 where c1=2 for update;
select c1/c3 from t1;
select c1/c3 from t1 where c1=2 for update;
##--error 153
select c4+c3 from t1;
select c4+c3 from t1 where c1=2 for update;
select c1+c3 from t1;
select c1+c3 from t1 where c1=2 for update;
##--error 153
select c4-c3 from t1;
select c4-c3 from t1 where c1=2 for update;
select c1-c3 from t1;
select c1-c3 from t1 where c1=2 for update;
select sum(c2) from t1;
select avg(c2) from t1;


--error 58
insert into t1 values(5, 1234.12, 1.36, '1.36');
alter table t1 alter column c2 set data type decimal(8,2);
desc t1;
insert into t1 values(6, 1234.12, 1.36, '13.654');
insert into t1 values(7, 12345.123, 1.63, '15.36');
insert into t1 values(8, 123456.123, 1.54, '12.36');

select * from t1;
select *,c1+c2 from t1 where c1=8 for update;
select * from t1;
select * from t1 where c1=3 for update;
select *,c1+c2 from t1 where c1=4 for update;
select c2*c3 from t1;
select c2*c3 from t1 where c1=2 for update;
select c2/c3 from t1;
select c2/c3 from t1 where c1=2 for update;
select c2-c3 from t1;
select c2-c3 from t1 where c1=2 for update;
select c2+c3 from t1;
select c2+c3 from t1 where c1=2 for update;

##--error 153
select c4*c3 from t1;
select c4*c3 from t1 where c1=2 for update;
select c1*c3 from t1;
select c1*c3 from t1 where c1=2 for update;

##--error 153
select c4/c3 from t1;
select c4/c3 from t1 where c1=2 for update;
select c1/c3 from t1;
select c1/c3 from t1 where c1=2 for update;

##--error 153
select c4+c3 from t1;
select c4+c3 from t1 where c1=2 for update;
select c1+c3 from t1;
select c1+c3 from t1 where c1=2 for update;

##--error 153
select c4-c3 from t1;

##--error 153
select c4*c3 from t1 where c1=4;
##--error 153
select c4+c3 from t1 where c1=4;
##--error 153
select c4-c3 from t1 where c1=4;
##--error 153
select c4/c3 from t1 where c1=4;
##--error 153
select c4*c3 from t1 where c1=1;
##--error 153
select c4+c3 from t1 where c1=1;
##--error 153
select c4-c3 from t1 where c1=1;
##--error 153
select c4/c3 from t1 where c1=1;

select c4-c3 from t1 where c1=2 for update;
select c1-c3 from t1;
select c1-c3 from t1 where c1=2 for update;
select sum(c2) from t1;
select avg(c2) from t1;


--error 58
insert into t1 values(9, 1234567.12, 15.23, '145.265');
alter table t1 alter column c2 set data type decimal(9,2);
desc t1;
insert into t1 values(10, 1234567.1, 12.36, '12.35');
insert into t1 values(11, 1234567.12, 14.25, '12.02');

select * from t1;
select * from t1 where c1=11 for update;
select * from t1 where c1=3 for update;
select *,c1+c2 from t1 where c1=4 for update;

select c2*c3 from t1;
select c2*c3 from t1 where c1=2 for update;
select c2/c3 from t1;
select c2/c3 from t1 where c1=2 for update;
select c2-c3 from t1;
select c2-c3 from t1 where c1=2 for update;
select c2+c3 from t1;
select c2+c3 from t1 where c1=2 for update;

##--error 153
select c4*c3 from t1;
select c4*c3 from t1 where c1=2 for update;
select c1*c3 from t1;
select c1*c3 from t1 where c1=2 for update;
##--error 153
select c4/c3 from t1;
select c4/c3 from t1 where c1=2 for update;
select c1/c3 from t1;
select c1/c3 from t1 where c1=2 for update;
##--error 153
select c4+c3 from t1;
select c4+c3 from t1 where c1=2 for update;
select c1+c3 from t1;
select c1+c3 from t1 where c1=2 for update;
##--error 153
select c4-c3 from t1;
select c4-c3 from t1 where c1=2 for update;
select c1-c3 from t1;
select c1-c3 from t1 where c1=2 for update;
select sum(c2) from t1;
select avg(c2) from t1;


alter table t1 alter column c2 set data type decimal(12,2);
desc t1;
insert into t1 values(13, 123456789.1, 12.36, '145.62');
insert into t1 values(14, 1234567890.12, 14.25, '147.21');
select * from t1;
select * from t1 where c1=14 for update;
select * from t1 where c1=13 for update;

--error 58
insert into t1 values(15, 12345678901.12, 124.53, '1475.21');
select * from t1;
select * from t1 where c1=3 for update;
select *,c1+c2 from t1 where c1=4 for update;

select c2*c3 from t1;
select c2*c3 from t1 where c1=2 for update;
select c2/c3 from t1;
select c2/c3 from t1 where c1=2 for update;
select c2-c3 from t1;
select c2-c3 from t1 where c1=2 for update;
select c2+c3 from t1;
select c2+c3 from t1 where c1=2 for update;

##--error 153
select c4*c3 from t1;
select c4*c3 from t1 where c1=2 for update;
select c1*c3 from t1;
select c1*c3 from t1 where c1=2 for update;
##--error 153
select c4/c3 from t1;
select c4/c3 from t1 where c1=2 for update;
select c1/c3 from t1;
select c1/c3 from t1 where c1=2 for update;
##--error 153
select c4+c3 from t1;
select c4+c3 from t1 where c1=2 for update;
select c1+c3 from t1;
select c1+c3 from t1 where c1=2 for update;
##--error 153
select c4-c3 from t1;
select c4-c3 from t1 where c1=2 for update;
select c1-c3 from t1;
select c1-c3 from t1 where c1=2 for update;
select sum(c2) from t1;
select avg(c2) from t1;

drop table if exists t1;


###2-2：decimal作为主键列，进行select for update操作，并重新定义decimal的范围
#do sql
create table if not exists t2(c1 int, c2 decimal(5,2) primary key, c3 decimal(10,2),c4 varchar(10));
desc t2;
insert into t2 values(1, 1, 1.2, '1.325o');
insert into t2 values(2, 1.2, 1.3, '1.325');
insert into t2 values(3, 1.23, 1.36, 'a.asd');
insert into t2 values(4, 123.234, 1.35, '1.369f');
select * from t2;
select * from t2 where c2=1.23 for update;
select *,c1+c2 from t2 where c2=1.2 for update;

select c2*c3 from t2;
select c2*c3 from t2 where c2=1.2 for update;
select c2/c3 from t2;
select c2/c3 from t2 where c2=1.2 for update;
select c2-c3 from t2;
select c2-c3 from t2 where c2=1.2 for update;
select c2+c3 from t2;
select c2+c3 from t2 where c2=1.2 for update;

#--error 153
select c4*c3 from t2;
#--error 153
select c4*c3 from t2 where c1=4;
#--error 153
select c4+c3 from t2 where c1=4;
#--error 153
select c4-c3 from t2 where c1=4;
#--error 153
select c4/c3 from t2 where c1=4;
#--error 153
select c4*c3 from t2 where c1=1;
#--error 153
select c4+c3 from t2 where c1=1;
#--error 153
select c4-c3 from t2 where c1=1;
#--error 153
select c4/c3 from t2 where c1=1;

select c4*c3 from t2 where c2=1.2 for update;
select c1*c3 from t2;
select c1*c3 from t2 where c2=1.2 for update;
#--error 153
select c4/c3 from t2;
select c4/c3 from t2 where c2=1.2 for update;
select c1/c3 from t2;
select c1/c3 from t2 where c2=1.2 for update;
#--error 153
select c4+c3 from t2;
select c4+c3 from t2 where c2=1.2 for update;
select c1+c3 from t2;
select c1+c3 from t2 where c2=1.2 for update;
#--error 153
select c4-c3 from t2;
select c4-c3 from t2 where c2=1.2 for update;
select c1-c3 from t2;
select c1-c3 from t2 where c2=1.2 for update;
select sum(c2) from t2;
select avg(c2) from t2;

--error 58
insert into t2 values(5, 1234.12, 1.32, '1.36');

alter table t2 alter column c2 set data type decimal(6,3);
desc t2;
insert into t2 values(7, 123.234, 1.36, '2.365');
insert into t2 values(8, 1.239, 1.36, '2.365');
insert into t2 values(9, 1.231, 1.21, '1.365');
insert into t2 values(10, 1.232, 1.54, '5.64');

select * from t2;
select * from t2 where c2=1.23 for update;
select *,c1+c2 from t2 where c2=1.2 for update;
select c2*c3 from t2;
select c2*c3 from t2 where c2=1.2 for update;
select c2/c3 from t2;
select c2/c3 from t2 where c2=1.2 for update;
select c2-c3 from t2;
select c2-c3 from t2 where c2=1.2 for update;
select c2+c3 from t2;
select c2+c3 from t2 where c2=1.2 for update;
select c4*c3 from t2 where c2=1.2 for update;
select c1*c3 from t2;
select c1*c3 from t2 where c2=1.2 for update;

#--error 153
select c4*c3 from t2 where c1=4;
#--error 153
select c4+c3 from t2 where c1=4;
#--error 153
select c4-c3 from t2 where c1=4;
#--error 153
select c4/c3 from t2 where c1=4;
#--error 153
select c4*c3 from t2 where c1=1;
#--error 153
select c4+c3 from t2 where c1=1;
#--error 153
select c4-c3 from t2 where c1=1;
#--error 153
select c4/c3 from t2 where c1=1;

select c4/c3 from t2 where c2=1.2 for update;
select c1/c3 from t2;
select c1/c3 from t2 where c2=1.2 for update;
#--error 153
select c4+c3 from t2;
select c4+c3 from t2 where c2=1.2 for update;
select c1+c3 from t2;
select c1+c3 from t2 where c2=1.2 for update;
#--error 153
select c4-c3 from t2;
select c4-c3 from t2 where c2=1.2 for update;
select c1-c3 from t2;
select c1-c3 from t2 where c2=1.2 for update;
select sum(c2) from t2;
select avg(c2) from t2;


alter table t2 alter column c2 set data type decimal(10,4);
desc t2;
insert into t2 values(11, 1.2341, 1.65, '1.62');
insert into t2 values(12, 12.234, 1.65, '1.62');
insert into t2 values(13, 13.26, 1.65, '1.62');
insert into t2 values(14, 1234.1, 1.52, '1.85');

select * from t2;
select * from t2 where c2=1.23 for update;
select *,c1+c2 from t2 where c2=1.2 for update;

select c2*c3 from t2;
select c2*c3 from t2 where c2=1.2 for update;
select c2/c3 from t2;
select c2/c3 from t2 where c2=1.2 for update;
select c2-c3 from t2;
select c2-c3 from t2 where c2=1.2 for update;
select c2+c3 from t2;
select c2+c3 from t2 where c2=1.2 for update;

#--error 153
select c4*c3 from t2 where c1=4;
#--error 153
select c4+c3 from t2 where c1=4;
#--error 153
select c4-c3 from t2 where c1=4;
#--error 153
select c4/c3 from t2 where c1=4;
#--error 153
select c4*c3 from t2 where c1=1;
#--error 153
select c4+c3 from t2 where c1=1;
#--error 153
select c4-c3 from t2 where c1=1;
#--error 153
select c4/c3 from t2 where c1=1;

select c4*c3 from t2 where c2=1.2 for update;
select c1*c3 from t2;
select c1*c3 from t2 where c2=1.2 for update;
select c4/c3 from t2 where c2=1.2 for update;
select c1/c3 from t2;
select c1/c3 from t2 where c2=1.2 for update;
#--error 153
select c4+c3 from t2;
select c4+c3 from t2 where c2=1.2 for update;
select c1+c3 from t2;
select c1+c3 from t2 where c2=1.2 for update;
#--error 153
select c4-c3 from t2;
select c4-c3 from t2 where c2=1.2 for update;
select c1-c3 from t2;
select c1-c3 from t2 where c2=1.2 for update;
select sum(c2) from t2;
select avg(c2) from t2;

--error 58
insert into t2 values(15, 1234567.12, 1.65, '5.36');

drop table if exists t2;
drop database test_decimal;


###///新添测试项///###
###2-x:(新增测试项说明)
#do sql
########################################################################################################
