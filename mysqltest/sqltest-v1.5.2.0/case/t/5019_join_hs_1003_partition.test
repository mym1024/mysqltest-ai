####################################必填######################################################
###1.测试功能点：指定分区规则下，测试bloomfilter_join和merge_join
##
#
###2.测试项：
###3.问题网址：xxx
###4.问题号：xxx
###5.预计运行时间：96 s
###6.编写/修改人：machen
###7.编写/修改日期：2019-11-28
###8.其他（选填）：
###
##
#
##############################################################################################

#####################################Do sql###################################################
create database b;
using database b;
sleep 5;
--disable_warnings
drop table if exists t1,t2,t3,t4;
--enable_warnings

###2-1:指定分区规则下，测试bloomfilter_join和merge_join
create table t1 (id bigint primary key, i2 int) partition by range(id)(partition id0 values less than(50),partition id1 values less than(100),partition id2 values less than (150),partition id3 values less than maxvalue);
create table t2 (id bigint primary key, i2 int) partition by range(id)(partition id0 values less than(50),partition id1 values less than(100),partition id2 values less than (150),partition id3 values less than maxvalue);
--real_sleep 3
insert into t1(id) values (75);
insert into t1(id) values (79);
insert into t1(id) values (78);
insert into t1(id) values (77);

insert into t1(id) values (104);
insert into t1(id) values (103);
insert into t1(id) values (102);
insert into t1(id) values (101);
insert into t1(id) values (105);
insert into t1(id) values (106);
insert into t1(id) values (107);

insert into t2(id) values (107),(75),(143);

select /*+ join(bloomfilter_join) */ t1.id, count(t2.id) from t1,t2 where t2.id = t1.id group by t1.id;
select /*+ join(bloomfilter_join) */ t1.id, count(t2.id) from t1,t2 where t2.id = t1.id group by t1.id;
select /*+ join(bloomfilter_join) */ t1.id, count(t2.id) from t1,t2 where t2.id = t1.id group by t1.id;
select /*+ join(bloomfilter_join) */ t1.id, count(t2.id) from t1 left join t2 on t1.i2=t2.i2 where t2.id = t1.id group by t2.id;
select /*+ join(bloomfilter_join) */ t1.id, count(t2.id) from t1 right join t2 on t1.i2=t2.i2 where t2.id = t1.id group by t2.id;
select /*+ join(bloomfilter_join) */ t1.id, count(t2.id) from t1 inner join t2 on t1.i2=t2.i2 where t2.id = t1.id group by t2.id;
select /*+ join(bloomfilter_join) */ t1.id, count(t2.id) from t1 full join t2 on t1.i2=t2.i2 where t2.id = t1.id group by t2.id;

select /*+ join(merge_join) */ t1.id, count(t2.id) from t1,t2 where t2.id = t1.id group by t1.id;
select /*+ join(merge_join) */ t1.id, count(t2.id) from t1,t2 where t2.id = t1.id group by t1.id;
select /*+ join(merge_join) */ t1.id, count(t2.id) from t1,t2 where t2.id = t1.id group by t1.id;
select /*+ join(merge_join) */ t1.id, count(t2.id) from t1 left join t2 on t1.i2=t2.i2 where t2.id = t1.id group by t2.id;
select /*+ join(merge_join) */ t1.id, count(t2.id) from t1 right join t2 on t1.i2=t2.i2 where t2.id = t1.id group by t2.id;
select /*+ join(merge_join) */ t1.id, count(t2.id) from t1 inner join t2 on t1.i2=t2.i2 where t2.id = t1.id group by t2.id;
select /*+ join(merge_join) */ t1.id, count(t2.id) from t1 full join t2 on t1.i2=t2.i2 where t2.id = t1.id group by t2.id;

CREATE TABLE t3 (
  t1_id bigint default NULL,
  t2_id int default NULL,
  type varchar(20),
  cost_unit varchar(20),
  min_value double default NULL,
  max_value double default NULL,
  t3_id int default NULL,
  item_id int default NULL,
  primary key(t1_id)
)partition by range(t1_id)(partition t1_id values less than(15),partition id1 values less than(25),partition id2 values less than (35),partition id3 values less than(100),partition id4 values less than maxvalue);
--real_sleep 3
INSERT INTO t3 VALUES (12,5,'Percent','Cost',-1,0,-1,-1),(14,4,'Percent','Cost',-1,0,-1,-1),(18,5,'Percent','Cost',-1,0,-1,-1),(19,4,'Percent','Cost',-1,0,-1,-1),(20,5,'Percent','Cost',-1,0,-1,-1),(21,5,'Percent','Cost',-1,0,-1,-1),(22,1,'Percent','Cost',-1,0,-1,-1),(23,1,'Percent','Cost',-1,0,-1,-1),(24,1,'Percent','Cost',-1,0,-1,-1),(25,1,'Percent','Cost',-1,0,-1,-1),(26,1,'Percent','Cost',-1,0,-1,-1),(27,4,'Percent','Cost',-1,0,-1,-1),(28,1,'Percent','Cost',-1,0,-1,-1),(29,2,'Percent','Cost',-1,0,-1,-1),(30,2,'Percent','Cost',-1,0,-1,-1),(93,2,'Cost','Cost',-1,10000000,-1,-1);
CREATE TABLE t4 (
  id bigint,
  name varchar(255) default NULL,
  PRIMARY KEY  (id)
)partition by range(id)(partition id0 values less than(5),partition id1 values less than(10),partition id2 values less than (15),partition id3 values less than maxvalue);
--real_sleep 3
INSERT INTO t4 VALUES (1,'s1'),(2,'s2'),(3,'s3'),(4,'s4'),(5,'s5');

select /*+ join(bloomfilter_join) */ t3.*, t4.* from t3,t4 where t4.id = t3.t2_id limit 2;
select /*+ join(bloomfilter_join) */ t3.*, t4.* from t3 left join t4 on t4.id=t3.t2_id limit 2;

drop table t1,t2,t3,t4;

###///新添测试项///###
###2-x:(新增测试项说明)
#do sql
########################################################################################################
