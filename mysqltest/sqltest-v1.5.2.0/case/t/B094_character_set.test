--disable_query_log
set sql_quote_show_create=0;
--enable_query_log
##############################################################################################
###1.测试功能点：字符集功能
##
#
###2.测试项：(每新添一测试项，需在添加前注明测试项，注释填写在新添sq1前，不填在此处，如下样例）
###3.问题网址：xxx
###4.问题号：xxx
###5.预计运行时间：xxx
###6.编写/修改人：zhangt
###7.编写/修改日期：2024-06
###8.其他（选填）：1.4.0.0新增
###
##
#
##############################################################################################

#####################################Do sql###################################################
#目前支持以下7种字符集共有18个字符序
#binary:binary
#gbk:gbk_chinese_ci gbk_bin 
#gb18030:gb18030_chinese_ci gb18030_bin
#utf16:utf16_general_ci utf16_bin
#utf8mb4:utf8mb4_general_ci utf8mb4_bin 
#latin1：latin1_swedish_ci latin1_bin
#gb18030_2022：gb18030_2022_bin gb18030_2022_chinese_ci gb18030_2022_chinese_cs gb18030_2022_radical_ci gb18030_2022_radical_cs gb18030_2022_stroke_ci gb18030_2022_stroke_cs

set names utf8mb4;
###2-1:数据库级字符集和字符序
create database db1;
show create database db1;
show create database yao;

create database db2 charset 'gbk' collate 'gbk_bin';
show create database db2;
alter database db2 charset 'utf8mb4' collate 'utf8mb4_general_ci';
show create database db2;

create database db3 character set 'gbk';
show create database db3;

create database db4 collate 'gbk_bin';
show create database db4;
alter database db4 collate utf8mb4_bin;
show create database db4;

create database db5 character set gb18030_2022 collate gb18030_2022_stroke_ci;
show create database db5;

CREATE DATABASE db6 CHARSET utf16;
show create database db6;

CREATE DATABASE db7 CHARSET = binary;
ALTER DATABASE db7 collate gb18030_bin;
show create database db7;

CREATE DATABASE db8 collate = gb18030_2022_stroke_ci;
ALTER DATABASE db8 CHARSET latin1;
show create database db8;

create database d1 character set binary;
create database d2 character set utf8mb4 collate utf8mb4_general_ci;
create database d3 character set utf8mb4 collate utf8mb4_bin;
create database d4 character set gbk collate gbk_chinese_ci;
create database d5 character set utf16 collate utf16_general_ci;
create database d6 character set utf16 collate utf16_bin;
create database d7 character set gb18030 collate gb18030_chinese_ci;
create database d8 character set gb18030 collate gb18030_bin;
create database d9 character set latin1 collate latin1_swedish_ci;
create database d10 character set latin1 collate latin1_bin;
create database d11 character set gb18030_2022 collate gb18030_2022_bin;
create database d12 character set gb18030_2022 collate gb18030_2022_chinese_ci;
create database d13 character set gb18030_2022 collate gb18030_2022_chinese_cs;
create database d14 character set gb18030_2022 collate gb18030_2022_radical_ci;
create database d15 character set gb18030_2022 collate gb18030_2022_radical_cs;
create database d16 character set gb18030_2022 collate gb18030_2022_stroke_cs;
drop database d1;

#不合法字符集字符序名称
--error 5143
create database db5 collate 'gbk';
--error 5143
create database db character set utf16 collate utf16_unicode_ci;
--error 5142
create database db character set 'gbka' collate 'gbk_bina';
--error 5144
create database db character set =binary collate = utf16_general_ci;
--error 5001
create database db character set binary collate binary;
--error 5602
alter database db10 charset 'gbk';

###2-2:表级字符集和字符序
create table t1(c1 int,c2 varchar(255)) character set binary;
create table t2(c1 int,c2 varchar(255)) character set utf8mb4 collate utf8mb4_general_ci;
create table t3(c1 int,c2 varchar(255)) character set utf8mb4 collate utf8mb4_bin;
create table t5(c1 int,c2 varchar(255)) character set gbk collate gbk_bin;
create table t6(c1 int,c2 varchar(255)) character set utf16 collate utf16_general_ci;
create table t7(c1 int,c2 varchar(255)) character set utf16 collate utf16_bin;
create table t8(c1 int,c2 varchar(255)) character set gb18030 collate gb18030_chinese_ci;
create table t9(c1 int,c2 varchar(255)) character set gb18030 collate gb18030_bin;
create table t10(c1 int,c2 varchar(255)) character set latin1 collate latin1_swedish_ci;
create table t11(c1 int,c2 varchar(255)) character set latin1 collate latin1_bin;
create table t12(c1 int,c2 varchar(255)) character set gb18030_2022 collate gb18030_2022_bin;
create table t13(c1 int,c2 varchar(255)) character set gb18030_2022 collate gb18030_2022_chinese_ci;
create table t14(c1 int,c2 varchar(255)) character set gb18030_2022 collate gb18030_2022_chinese_cs;
create table t15(c1 int,c2 varchar(255)) character set gb18030_2022 collate gb18030_2022_radical_ci;
create table t16(c1 int,c2 varchar(255)) character set gb18030_2022 collate gb18030_2022_radical_cs;
create table t17(c1 int,c2 varchar(255)) character set gb18030_2022 collate gb18030_2022_stroke_ci;
create table t18(c1 int,c2 varchar(255)) character set gb18030_2022 collate gb18030_2022_stroke_cs;
drop table t1,t2,t3,t5,t6,t7,t8,t9,t10,t11,t12,t13,t14,t15,t16,t17,t18;

create table tb1(name varchar(255), age int, addr varchar(255));
show create table tb1;
ALTER TABLE tb1 CHARACTER SET utf8;
show create table tb1;

create table tb2(col1 varchar(255))charset 'gbk' collate 'gbk_bin';
alter table tb2 character set 'utf8mb4' collate 'utf8mb4_general_ci';
show create table tb2;

CREATE TABLE tb3 (c1 INT, c2 VARCHAR(32), c3 VARCHAR(32),c4 bit(1),c5 json, PRIMARY KEY (c1),UNIQUE KEY idx_tb3_c2(c2));
ALTER TABLE tb3 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_bin;
ALTER TABLE tb3 CONVERT TO CHARACTER SET gbk COLLATE gbk_bin;
show create table tb3;

ALTER TABLE tb3 CHARACTER SET gb18030_2022;
show create table tb3;
ALTER TABLE tb3 COLLATE latin1_bin;
show create table tb3;

create table tb4(name varchar(255), age int, addr varchar(255))charset 'gbk';
show create  table tb4;
alter table tb4 convert to character set 'utf8mb4';
show create table tb4;

create table tb5(name varchar(255), age int, addr varchar(255)) collate 'gbk_bin';
show create table tb5;
alter table tb5 collate 'gbk_bin';
show create table tb5;

alter database test charset 'gbk';
create table tb6(name varchar(255), age int, addr varchar(255));
show create table tb1;
show create table tb6;

--error 5142
ALTER TABLE tb1 CHARACTER SET utf8 COLLATE latin1_danish_ci;
--error 16
create table tb7(name varchar(255), age int, addr varchar(255)) charset 'gbk' collate 'utf8mb4_bin';
--error 16
alter table tb4 convert to character set 'gbk' collate'utf8mb4_bin';

CREATE TABLE t1 ( a CHAR(1) ) CHARACTER SET utf8;
CREATE TABLE t2 ( a CHAR(1) ) CHARACTER SET "utf8";
CREATE TABLE t3 ( a CHAR(1) ) CHARACTER SET 'utf8';
CREATE TABLE t4 ( a CHAR(1) ) CHARACTER SET `utf8`;
DROP TABLE t1, t2, t3, t4;

###2-3:列级字符集和字符序
create table tab(
	c1 VARCHAR(5) character set binary,
	c2 VARCHAR(5) character set utf8mb4 collate utf8mb4_general_ci comment 'utf8mb4',
	c3 VARCHAR(5) character set utf8mb4 collate utf8mb4_bin,
	c4 VARCHAR(5) character set gbk collate gbk_chinese_ci,
	c5 VARCHAR(5) character set gbk collate gbk_bin,
	c6 VARCHAR(5) character set utf16 collate utf16_general_ci,
	c7 VARCHAR(5) character set utf16 collate utf16_bin,
	c8 VARCHAR(5) character set gb18030 collate gb18030_chinese_ci,
	c9 VARCHAR(5) character set gb18030 collate gb18030_bin,
	c10 VARCHAR(5) character set latin1 collate latin1_swedish_ci,
	c11 VARCHAR(5) character set latin1 collate latin1_bin,
	c12 VARCHAR(5) character set gb18030_2022 collate gb18030_2022_bin,
	c13 VARCHAR(5) character set gb18030_2022 collate gb18030_2022_chinese_ci,
	c14 VARCHAR(5) character set gb18030_2022 collate gb18030_2022_chinese_cs,
	c15 VARCHAR(5) character set gb18030_2022 collate gb18030_2022_radical_ci,
	c16 VARCHAR(5) character set gb18030_2022 collate gb18030_2022_radical_cs,
	c17 VARCHAR(5) character set gb18030_2022 collate gb18030_2022_stroke_ci,
	c18 VARCHAR(5) character set gb18030_2022 collate gb18030_2022_stroke_cs);
show create table tab;

create table t(c1 int);
SHOW CREATE TABLE t;
ALTER TABLE t ADD c2 int COLLATE 'binary';
SHOW CREATE TABLE t;

create table t1(col1 varchar(255) character set 'gbk' collate 'gbk_bin');
alter table t1 modify col1 varchar(255)  character set 'utf8mb4' collate 'utf8mb4_bin';
SHOW CREATE TABLE t1;

CREATE TABLE t2 (f1 CHAR(20) COLLATE 'binary');
SHOW CREATE TABLE t2;

CREATE TABLE t3 (col1 VARCHAR(5) CHARACTER SET gb18030 COLLATE 'gb18030_chinese_ci');
SHOW CREATE TABLE t3;
ALTER TABLE t3 MODIFY col1 VARCHAR(5) CHARACTER SET gbk COLLATE gbk_chinese_ci;
SHOW CREATE TABLE t3;

--error 5001
CREATE TABLE t4(c1 json CHARACTER SET 'gb18030_2022' COLLATE 'gb18030_2022_chinese_ci');
#SHOW CREATE TABLE t4;

create table t5(name varchar(255) charset 'utf8mb4', age int, addr varchar(255));
show create table t5;
alter table t5 modify name varchar(255) collate 'gbk_bin';
show create table t5;

create table t6(name varchar(255) collate 'gbk_bin', age int, addr varchar(255));
show create table t6;

--error 5177
CREATE TABLE t7 (col1 VARCHAR(5) CHARACTER SET utf8mb4 COLLATE 'gb18030_chinese_ci');

drop table t1,t2,t3,t5,t6;

#表中的增删改查
create database test1;
use test1;
create table t1(str_def varchar(255), str_utf8 varchar(255) charset 'utf8mb4', str_gbk varchar(255) charset 'gbk', str_latin varchar(255) charset 'latin1', str_utf16 varchar(255) charset 'utf16', str_binary varchar(255) charset 'binary', str_gb varchar(255) charset 'gb18030');
insert into t1 values(_utf8mb4'中文字符', _utf8mb4'中文字符', _gbk'中文字符', _latin1'中文字符', _utf16'中文字符', _binary'中文字符', _gb18030'中文字符');
select * from t1;
alter table t1 add column str_def2 varchar(255);
show create table t1;
select * from t1;

insert into t1(str_def2) values(_utf8mb4'中文字符');
select * from t1;
update t1 set str_def2=_utf8mb4'英文字符';
select * from t1;
delete from t1;
select * from t1;

insert into t1 values(_utf8mb4'中文字符', _utf8mb4'中文字符', _gbk'中文字符', _latin1'中文字符', _utf16'中文字符', _binary'中文字符', _gb18030'中文字符',_utf8mb4'中文字符');
alter table t1 add column str_gbk2 varchar(255) charset 'gbk'; 
show create table t1;
select * from t1;
insert into t1(str_gbk2) values(_gbk'中文字符');
select * from t1;
update t1 set str_gbk2=_gbk'英文字符';
select * from t1;
delete from t1;
select * from t1;
alter table t1 drop column str_gbk2;
show create table t1;

insert into t1 values(_utf8mb4'中文字符', _utf8mb4'中文字符', _gbk'中文字符', _latin1'中文字符', _utf16'中文字符', _binary'中文字符', _gb18030'中文字符',_utf8mb4'中文字符');
alter table t1 add column str_gb2 varchar(255) charset 'gb18030'; 
show create table t1;
select * from t1;
insert into t1(str_gb2) values(_gb18030'中文字符');
select * from t1;
update t1 set str_gb2=_gb18030'英文字符';
select * from t1;
delete from t1;
select * from t1;
alter table t1 drop column str_gb2;
show create table t1;

delete from t1;
alter table t1 modify str_def varchar(255) charset 'binary';
insert into t1 values(_binary'中文字符', _utf8mb4'中文字符', _gbk'中文字符', _latin1'中文字符', _utf16'中文字符', _binary'中文字符',  _gb18030'中文字符',_binary'中文字符');
select * from t1;

drop table t1;
###2-4:库表列组合
#库表列分别设置不同字符集和字符序
create table t1(col1 varchar(255) character set 'gbk' collate 'gbk_bin')character set 'latin1' collate 'latin1_bin'; 
create table t2(col1 varchar(255) character set 'gbk')character set 'latin1';
show create table t1;
show create table t2;

create database test2 character set utf16 collate utf16_bin;
use test2;
create table t3(col1 varchar(255) character set 'gbk')COLLATE 'gb18030_2022_bin';
show create table t3;

#通过表级控制列的字符
create table t2(str_def varchar(255));
insert into t2(str_def) values(_utf8mb4'中文字符');
select * from t2;
update t2 set str_def=_utf8mb4'英文字符';
select * from t2;

delete from t2; 
select * from t2;
alter table t2 charset 'utf8mb4';
alter table t2 add column str_utf8 varchar(255);
insert into t2(str_utf8) values(_utf8mb4'中文字符');
select * from t2;
update t2 set str_utf8=_utf8mb4'英文字符';
select * from t2;

#删除通过表控制的列
alter table t2 drop column str_utf8;
insert into t2(str_def) values(_utf8mb4'中文字符');
select * from t2;
update t2 set str_def=_utf8mb4'英文字符';
select * from t2;
delete from t2; 
select * from t2;

#通过库级控制列的字符
create database db_test;
use db_test;
create table t1 (str_def varchar(255));
insert into t1 values(_utf8mb4'中文字符');
select * from t1;

alter database db_test charset 'utf16';
create table t2 (str_utf16 varchar(255));
insert into t2 values(_utf16'中文字符');
select * from t2;
update t2 set str_utf16=_utf16'英文字符';
select * from t2;
delete from t2;

alter database db_test charset 'gb18030_2022';
create table t3 (str_gb20 varchar(255));
insert into t3 values(_gb18030_2022'中文字符');
select * from t3;
update t3 set str_gb20=_gb18030_2022'英文字符';
select * from t3;
delete from t3;
select * from t3;

###2-5：查看相关信息
#查看可用字符集
SHOW CHARACTER SET;
#查看可用字符序
SHOW COLLATION;
#查看所有字符集的系统变量
SHOW SESSION VARIABLES LIKE 'character\_set\_%';
#查看所有字符序的系统变量
SHOW SESSION VARIABLES LIKE 'collation\_%';
#设置客户端与服务器之间字符集
SET NAMES utf8mb4;
#指定字符表达式的字符集和字符序
select _gbk'中文' collate 'gbk_bin';

###2-6：函数中使用字符集和字符序
select concat(_latin1'中文',_latin1'中文');
select concat_ws(',',_latin1'中文',_latin1'中文');
select substring(_gbk'中文字符',3);
select length(_gbk'中文字符');
select replace(_gbk'中文字符',_gbk'中文',_gbk'测试');
select left(_gbk'中文字符',2);
select right(_gbk'中文字符',2);
select instr(_gbk'中文字符',_gbk'字符');
select ord(_gbk'中');
select convert(_utf8mb4'中文',char character set gbk);
select cast(_utf16'中文' as char);
select cast(_gbk'中文'as char character set gbk);
select char_length(_gbk'中文');
select substring_index(_utf16'测试,中文,字符',',',2);
select find_in_set(_gbk'测试',_gbk'中文,测试,字符');
select substr(_gbk'中文字符', 3);
select lower(_utf8mb4'中文字符');
select trim(_gbk' 中文字符 ');
select replace(_gbk'中文字符', _gbk'中文', _gbk'测试');
select locate(_gbk'字符', _gbk'中文字符', 2);
#--error 153
select ceil(_utf8mb4'中文');
#--error 153
select floor(_gbk'中文');

#操作符等使用
create database db_dml; 
use db_dml; 
create table t1(data_binary varchar(255) charset 'binary', data_gbk varchar(255) charset 'gbk', data_gb18030 varchar(255) charset 'gb18030', data_utf16 varchar(255) charset 'utf16', data_utf8mb4 varchar(255) charset 'utf8mb4', data_latin1 varchar(255) charset 'latin1'); 
insert into t1 values(_binary'中文字符', _gbk'中文字符', _gb18030'中文字符', _utf16'中文字符', _utf8mb4'中文字符', _latin1'中文字符'); 
insert into t1 values(_binary'中文', _gbk'中文', _gb18030'中文', _utf16'中文', _utf8mb4'中文', _latin1'中文'); 
insert into t1 values(_binary'中国', _gbk'中国', _gb18030'中国', _utf16'中国', _utf8mb4'中国', _latin1'中国'); 
update t1 set data_binary = _binary'英文字符' where data_binary = _binary'中文字符'; 
select * from t1;

update t1 set data_utf8mb4 = _utf8mb4'英文' where data_utf8mb4 = _utf8mb4'中文'; 
select * from t1;
update t1 set data_latin1 = _latin1'英文' where data_latin1 = _latin1'中文'; 
select * from t1;

update t1 set data_gbk = _gbk'中文' where data_gbk > _gbk'中文'; 
select * from t1;

update t1 set data_utf8mb4 = _utf8mb4'中特' where data_utf8mb4 < _utf8mb4'中文'; 
select * from t1;

update t1 set data_binary = _binary'中文' where data_binary like _binary'中国%'; 
select * from t1;

update t1 set data_utf16 = _utf16'测试' where data_utf16 <= _utf16'中文字符' and data_utf16 >= _utf16'中文';
select * from t1;

update t1 set data_gb18030 = _gb18030'分布' where  data_gb18030 between _gb18030'中' and _gb18030'中文';
select * from t1;

update t1 set data_utf8mb4 = _utf8mb4'中投靓仔' where data_utf8mb4 in(_utf8mb4'英', _utf8mb4'英文'); 
select * from t1;

select * from t1 where data_gbk = _gbk'中文';
select * from t1 where data_utf8mb4 not in(_utf8mb4'英', _utf8mb4'英文'); 

--error 119
update t1 set data_gbk = _gbk'测试文字' where data_gbk = _utf16'测试字符';select * from t1 where data_gbk = _gbk'测试文字';

delete from t1 where data_gb18030 = _gb18030'分布'; 
select * from t1;

create table t2(data_binary varchar(255) charset 'binary', data_gbk varchar(255) charset 'gbk', data_gb18030 varchar(255) charset 'gb18030', data_utf16 varchar(255) charset 'utf16', data_utf8mb4 varchar(255) charset 'utf8mb4', data_latin1 varchar(255) charset 'latin1'); 
insert into t2 values(_binary'中投', _gbk'中投', _gb18030'中投', _utf16'中投', _utf8mb4'中投', _latin1'中投');
insert into t2 values(_binary'中投靓仔', _gbk'中投靓仔', _gb18030'中投靓仔', _utf16'中投靓仔', _utf8mb4'中投靓仔', _latin1'中投靓仔'); 
insert into t2 values(_binary'中投靓仔大师', _gbk'中投靓仔大师', _gb18030'中投靓仔大师', _utf16'中投靓仔大师', _utf8mb4'中投靓仔大师', _latin1'中投靓仔大师'); 
delete from t2 where data_gbk < _gbk'中投靓仔'; 
select * from t2;

select * from t1 join t2 on t1.data_utf8mb4 = t2.data_utf8mb4;

###2-7：排序规则
create database db_coll;
use db_coll;
create table t1 (data_general_ci varchar(255) collate 'utf8mb4_general_ci', data_bin varchar(255) collate 'utf8mb4_bin');
insert into t1 (data_general_ci, data_bin) values ('apple', 'apple'), ('Apple', 'Apple'), ('banana', 'banana'), ('Orange', 'Orange'), ('orange', 'orange');
select data_general_ci from t1 order by data_general_ci collate utf8mb4_general_ci;
select data_general_ci from t1 group by data_general_ci collate utf8mb4_general_ci;
select data_bin from t1 order by data_bin;
select distinct binary data_general_ci from t1;
select distinct data_general_ci collate utf8mb4_general_ci from t1;
select max(data_bin collate utf8mb4_bin) from t1;

create table t2 (data_swedish_ci varchar(255)) collate 'latin1_swedish_ci'; 
alter table t2 collate 'latin1_bin'; 
alter table t2 add column data_bin varchar(255); 
insert into t2(data_swedish_ci, data_bin) values ('apple', 'apple'), ('Banana', 'Banana'), ('Orange', 'Orange'), ('grape', 'grape'), ('Grape', 'Grape');
select data_swedish_ci from t2 order by data_swedish_ci ;
select data_bin from t2 order by data_bin;
select distinct binary data_swedish_ci from t2;
select * from t2 where data_bin='apple' collate utf8mb4_bin;

###2-8；聚合函数
create table t11(data_binary varchar(255) charset 'binary', data_gbk varchar(255) charset 'gbk', data_gb18030 varchar(255) charset 'gb18030', data_utf16 varchar(255) charset 'utf16', data_utf8mb4 varchar(255) charset 'utf8mb4', data_latin1 varchar(255) charset 'latin1'); 
insert into t11 values(_binary'中文', _gbk'中文', _gb18030'中文', _utf16'中文', _utf8mb4'中文', _latin1'中文'); 
insert into t11 values(_binary'中文字符', _gbk'中文字符', _gb18030'中文字符', _utf16'中文字符', _utf8mb4'中文字符', _latin1'中文字符'); 
insert into t11 values(_binary'测试', _gbk'测试', _gb18030'测试', _utf16'测试', _utf8mb4'测试', _latin1'测试'); 
insert into t11 values(_binary'中文', _gbk'中文', _gb18030'中文', _utf16'中文', _utf8mb4'中文', _latin1'中文'); 
select sum(data_gbk) from t11;
select avg(data_gbk) from t11;
select min(data_gbk) from t11;
select max(data_gbk) from t11;
select count(data_gbk) from t11;
select data_gbk as data1 from t11 order by data_gbk;
select data_gbk from t11 group by data_gbk;
select data_gbk from t11 group by data_gbk order by data_gbk asc;
select distinct data_gbk from t11 order by data_gbk desc;
select data_gbk from t11 group by data_gbk having data_gbk = _gbk'中文字符' order by data_gbk desc;
select * from t11 where data_binary='中文' collate utf8mb4_bin;
set names gb18030; 
select * from t11;
set names latin1; 
select * from t11;
set names utf8mb4; 
select * from t11;
select charset('abc');
select collation('abc');
select coercibility('abc');

###2-9：索引
create table test_table (id int, name varchar(50), description varchar(255)) charset 'utf8mb4' collate 'utf8mb4_general_ci'; 
create index idx_name on test_table(name); 
insert into test_table (id, name, description) values(1, 'Apple', 'Fruit'), (2, 'banana', 'Fruit'), (3, 'Orange', 'Fruit'), (4, 'Grapes', 'Fruit');
set names utf8mb4;
select * from test_table where name like 'A%' collate utf8mb4_general_ci;
select * from test_table order by name collate utf8mb4_general_ci;
select * from test_table order by name collate utf8mb4_bin;

create table test_c (id int, name varchar(255), description varchar(255)) charset 'utf8mb4' collate 'utf8mb4_general_ci'; 
create index idx_chinese_name on test_c(name);
insert into test_c (id, name, description) values (1, _gbk'张三',  _gbk'这是张三'), (2, _utf16'李四', _utf16'这是李四'), (3, _latin1'王五', _latin1'这是王五'), (4, _utf8mb4'赵六', _utf8mb4'这是赵六');
select * from test_c where name=_latin1'王五';
select * from test_c where name=_utf16'王五';
select * from test_c where name=_utf8mb4'赵六';
select * from test_c where name=_gbk'赵六';

###///新添测试项///###
###2-x:(新增测试项说明)
#do sql
########################################################################################################
