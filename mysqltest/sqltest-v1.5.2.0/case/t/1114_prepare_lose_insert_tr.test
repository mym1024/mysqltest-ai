####################################必填######################################################
###1.测试功能点：通过设置autocommit来控制事务，使用prepare执行insert操作
##
#
###2.测试项：(每新添一测试项，需在添加前注明测试项，注释填写在新添sq1前，不填在此处，如下样例）
###3.问题网址：xxx
###4.问题号：xxx
###5.预计运行时间：xxx
###6.编写/修改人：zhuyinying
###7.编写/修改日期：2020-01-13
###8.其他（选填）：case格式规范化修改
###
##
#
##############################################################################################

#####################################Do sql###################################################
--disable_abort_on_error
--disable_warnings
drop table if exists t1,t2; 
--enable_warnings

create table t1(a int primary key,b varchar(255),c int);
# --real_sleep 10
# insert into t1 values(1,'a',2),(2,'b',3),(3,'c',4),(4,'a',2);


###2-1:add a new column
prepare stmt1 from insert into t1 values(?,'d',3),(?,'f',6);
set @x=1;
set @y=2;
execute stmt1 using @x,@y;
alter table t1 add d int;
--real_sleep 3
set autocommit=0;
set @x=3;
set @y=4;
execute stmt1 using @x,@y;
commit;
set autocommit=1;
select * from t1;
deallocate prepare stmt1;

drop table t1;
create table t1(a int primary key,b varchar(255),c int);
insert into t1 values(1,'a',2),(2,'b',3);


###2-2:drop a no exist column
prepare stmt1 from insert into t1 values(?,'d',3),(?,'f',6);
set @x=3;
set @y=4;
execute stmt1 using @x,@y;
alter table t1 drop q;
set autocommit=0;
set @x=55;
set @y=66;
execute stmt1 using @x,@y;
commit;
set autocommit=1;
select * from t1;
deallocate prepare stmt2;


###2-3:drop a exist column
prepare stmt1 from insert into t1 values(?,'d',3),(?,'f',2);
set @x=7;
set @y=8;
execute stmt1 using @x,@y;
alter table t1 drop c;
set autocommit=0;
set @x=9;
set @y=10;
execute stmt1 using @x,@y;
rollback;
commit;
set autocommit=1;
select * from t1;
deallocate prepare stmt3;

drop table t1;
create table t1(a int primary key,b varchar(255),c int);
insert into t1 values(1,'a',2),(2,'b',3),(3,'c',4);


###2-4:add a new column and drop it
prepare stmt4 from insert into t1 values(?,'d',2),(?,'a',2);
set @x=11;
set @y=12;
execute stmt4 using @x,@y;
alter table t1 add d int;
alter table t1 drop d;
set autocommit=0;
set @x=9;
set @y=10;
execute stmt4 using @x,@y;
commit;
set autocommit=1;
select * from t1;
deallocate prepare stmt4;

drop table t1;
create table t1(a int primary key,b varchar(255),c int);
insert into t1 values(1,'a',2),(2,'b',3),(3,'c',4);


###2-5:drop a exist column,and add it which have same type with before
prepare stmt5 from insert into t1 values(?,'d',2),(?,'a',2);
set @x=5;
set @y=4;
execute stmt5 using @x,@y;
alter table t1 drop b;
alter table t1 add b varchar(255);
set autocommit=0;
set @x=6;
set @y=7;
execute stmt5 using @x,@y;
commit;
set autocommit=1;
select * from t1;
deallocate prepare stmt5;


###2-6:drop a exist column,and it which have difference type with before
prepare stmt6 from insert into t1 values(?,'d',2),(?,'a',2);
set @x=8;
set @y=9;
execute stmt6 using @x,@y;
alter table t1 drop b;
alter table t1 add b int;
set autocommit=0;
set @x=10;
set @y=11;
execute stmt6 using @x,@y;
commit;
set autocommit=1;
select * from t1;
deallocate prepare stmt6;

drop table t1;
create table t1(a int primary key,b varchar(255),c int);
insert into t1 values(1,'a',2),(2,'b',3),(3,'c',4);
prepare stmt7 from insert into t1 values(?,2,1);
set @x=4;
set autocommit=0;
execute stmt7 using @x;
commit;
set autocommit=1;
select * from t1;
deallocate prepare stmt7;


###2-7:drop table and create it again;
drop table t1;
create table t1(a int primary key,b varchar(255),c int);

prepare stmt8 from insert into t1 values(?,2,2);
set @x=4;
execute stmt8 using @x;
drop table t1;
create table t1(a int primary key,b varchar(255),c int);
insert into t1 values(1,'a',2),(2,'b',3),(3,'c',4);
set autocommit=0;
set @x=6;
execute stmt8 using @x;
commit;
set autocommit=1;
select * from t1;
deallocate prepare stmt8;


###2-8:drop table and create it with diff shecma 
prepare stmt9 from insert into t1 values(?,2,1)(?,5,1);
set @x=8;
set @y=9;
execute stmt9 using @x,@y;
drop table t1;
create table t1(a int primary key,b varchar(255));
set autocommit=0;
set @x=10;
set @y=11;
execute stmt9 using @x,@y;
commit;
set autocommit=1;
select * from t1;
deallocate prepare stmt9;

drop tablee t1;
create table t1(a int primary key,b varchar(255),c int);

# add column

prepare stmt10 from insert into t1(a,b,c) values(?,'d',2),(?,'f',6);
set @x=1;
set @y=2;
execute stmt10 using @x,@y;
alter table t1 add d int;
set autocommit=0;
set @x=3;
set @y=4;
execute stmt10 using @x,@y;
commit;
set autocommit=1;
select * from t1;
deallocate prepare stmt10;

drop tablee t1;
create table t1(a int primary key,b varchar(255),c int,d int);
insert into t1 values(1,'a',2,2);


###2-9:drop no use column
prepare stmt11 from insert into t1(a,b,c) values(?,'d',2);
set @x=2;
execute stmt11 using @x;
alter table t1 drop d;
set autocommit=0;
set @x=3;
execute stmt11 using @x;
commit;
set autocommit=1;
select * from t1;
deallocate prepare stmt11;

drop tablee t1;
create table t1(a int primary key,b varchar(255),c int);
insert into t1 values(1,'a',2),(2,'b',3),(3,'c',4);
alter table t1 add d int;


###2-11:drop use column
prepare stmt12 from insert into t1(a,b,c) values(?,'d',4);
set @x=4;
execute stmt12 using @x;
alter table t1 drop c;
set autocommit=0;
set @x=4;
execute stmt12 using @x;
commit;
set autocommit=1;
select * from t1;
deallocate prepare stmt12;

drop tablee t1;
create table t1(a int primary key,b varchar(255),c int);
insert into t1 values(1,'a',2),(2,'b',3),(3,'c',4);


###2-11:have problem
prepare stmt13 from insert into t1(a,b) values(?,'d');
set @x=4;
execute stmt13 using @x;
alter table t1 drop c;
set autocommit=0;
set @x=555;
execute stmt13 using @x;
commit;
set autocommit=1;
select * from t1;
deallocate prepare stmt13;

drop tablee t1;
create table t1(a int primary key,b varchar(255),c int);


###2-12:drop column add it again with same type
prepare stmt14 from insert into t1(a,b,c) values(?,'d',1);
set @x=1;
execute stmt14 using @x;
alter table t1 drop c;
alter table t1 add c int;
set autocommit=0;
set @x=2;
##--error 18
execute stmt14 using @x;
commit;
set autocommit=1;
select * from t1;
deallocate prepare stmt14;

drop tablee t1;
create table t1(a int primary key,b varchar(255),c int);
insert into t1 values(1,'a',2),(2,'b',3),(3,'c',4);


###2-13:drop column add it again with diff type
prepare stmt15 from insert into t1(a,b,c) values(?,'d',1);
set @x=5;
execute stmt15 using @x;
alter table t1 drop b;
alter table t1 add b int;
set autocommit=0;
set @x=6;
execute stmt15 using @x;
commit;
set autocommit=1;
select * from t1;
deallocate prepare stmt15;

drop tablee t1;
create table t1(a int primary key,b varchar(255),c int);
insert into t1 values(1,'a',2),(2,'b',3),(3,'c',4);


###2-14:add column drop it again
prepare stmt16 from insert into t1(a,b,c) values(?,'d',1);
set @x=4;
execute stmt16 using @x;
alter table t1 add d int;
alter table t1 drop d;
set autocommit=0;
set @x=5;
execute stmt16 using @x;
commit;
set autocommit=1;
select * from t1;
deallocate prepare stmt16;


###///新添测试项///###
###2-x:(新增测试项说明)
#do sql
########################################################################################################























































































































































































































































































































































































































































































































































































































































































