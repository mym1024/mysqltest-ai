--source merge.sql
####################################必填######################################################
###1.测试功能点：range分区，复杂prepare
##
#
###2.测试项：(每新添一测试项，需在添加前注明测试项，注释填写在新添sq1前，不填在此处，如下样例）
###3.问题网址：xxx
###4.问题号：xxx
###5.预计运行时间：191.67 s
###6.编写/修改人：pantong
###7.编写/修改日期：2019-11-5
###8.其他（选填）：新编case
###
##
#
##############################################################################################

#####################################Do sql###################################################
--disable_warnings
drop table if exists t1,t2,t3;
alter system set min_drop_cache_wait_time='10s' server_type=yaodatasvr;
alter system set each_tablet_sync_meta=False server_type=yaodatasvr;
--real_sleep 10


###2-1：range分区，复杂prepare
create table t1(i1 int,f1 float,s1 char(30),d1 datetime,i2 int,f2 float,s2 char(30),d2 datetime, primary key(i1,f1,s1,d1))partition by range(i1)(partition r0 values less than(5),partition r1 values less than(10),partition r2 values less than(15),partition r3 values less than (maxvalue));

prepare stmt_replace from replace into t1 values(?,?,?,?,?,?,?,?);
prepare stmt_insert from insert into t1 values(?,?,?,?,?,?,?,?);
prepare stmt_update from update t1 set i2=?,f2=?,s2=?,d2=? where i1=? and f1=? and s1=? and d1=?;
prepare stmt_update_with_other_column from update t1 set i2=?,f2=?,s2=?,d2=? where i1=? and f1=? and s1=? and d1=? and i2=? and f2=? and s2=? and d2=?;
prepare stmt_delete from delete from t1 where i1=? and f1=? and s1=? and d1=?;
prepare stmt_delete_with_other_column from delete from t1 where i1=? and f1=? and s1=? and d1=? and i2=? and f2=? and s2=? and d2=?;
prepare stmt_select from select * from t1 where i1=? and f1=? and s1=? and d1=?;
prepare stmt_select_with_all_column from select * from t1 where i1=? and f1=? and s1=? and d1=? and i2=? and f2=? and s2=? and d2=?;

--let $1=99

--let $i1=1
--let $f1=1.5
--let $s1='s1'
--let $d1='2012-02-20 12:00:01'

--let $i2=100
--let $f2=100.5
--let $s2='s100'
--let $d2='2012-02-20 12:00:01'

set @i1=1;
set @f1=1.5;
set @s1='abcdefghijklmnopqrstuvwxyz';
set @d1=timestamp'2012-02-20 12:00:01';

set @i2=100;
set @f2=100.5;
set @s2='s100';
set @d2=timestamp'2012-02-20 12:01:00';

set @i3=1000;
set @f3=1000.5;
set @s3='s1000';
set @d3=timestamp'2012-02-20 13:01:00';

execute stmt_insert using @i1,@f1,@s1,@d1,@i2,@f2,@s2,@d2;
sleep 5;
select * from t1;
--real_sleep 100

execute stmt_replace using @i1,@f1,@s1,@d1,@i2,@f2,@s2,@d2;
select * from t1;
--real_sleep 10
execute stmt_replace using @i1,@f1,@s1,@d1,@i2,@f2,@s2,@d2;
select * from t1;
--real_sleep 10

execute stmt_update_with_other_column using @i3,@f3,@s3,@d3,@i1,@f1,@s1,@d1,@i2,@f2,@s2,@d2;
select * from t1;
--real_sleep 10
execute stmt_update using @i3,@f3,@s3,@d3,@i1,@f1,@s1,@d1;
select * from t1;
--real_sleep 10

execute stmt_select using @i1,@f1,@s1,@d1;
select * from t1;
--real_sleep 10
execute stmt_select_with_all_column using @i1,@f1,@s1,@d1,@i3,@f3,@s3,@d3;
select * from t1;
--real_sleep 10

execute stmt_delete_with_other_column using @i1,@f1,@s1,@d1,@i2,@f2,@s2,@d2;
select * from t1;
--real_sleep 10
execute stmt_delete using @i1,@f1,@s1,@d1;
select * from t1;
--real_sleep 10


###///新添测试项///###
###2-x:(新增测试项说明)
#do sql
########################################################################################################
