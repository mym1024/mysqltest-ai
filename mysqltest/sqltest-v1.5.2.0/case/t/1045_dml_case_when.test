####################################必填######################################################
###1.测试功能点：不指定分区，测试case when的用法
##
#
###2.测试项：(每新添一测试项，需在添加前注明测试项，注释填写在新添sq1前，不填在此处，如下样例）
###3.问题网址：xxx
###4.问题号：xxx
###5.预计运行时间：xxx
###6.编写/修改人：zhuyinying
###7.编写/修改日期：2019-12-23
###8.其他（选填）：case格式规范化修改
###
##
#
##############################################################################################

#####################################Do sql###################################################
--disable_warnings
drop table if exists a1,a2;
--enable_warnings

###2-1:Test bug when using GROUP BY on CASE
#
create table a1(rowkey_suffix int primary key,price int);
insert into a1(rowkey_suffix,price) values(1,1);
insert into a1(rowkey_suffix,price) values(2,2);
insert into a1(rowkey_suffix,price) values(3,3);
insert into a1(rowkey_suffix,price) values(4,4);

select case price when 1 then 2 when 2 then 3 else 0 end as fcase,count(*) from a1 group by fcase;
select case price when 1 then 'one' when 2 then 'two' else 'nothing' end as fcase,count(*) from a1 group by fcase;
drop table a1;


#
###2-2:Test MAX(CASE ...) that can return null
#
create table a1(rowkey_suffix int primary key,price int);
select max(case price when 1 then rowkey_suffix else null end) as color from a1 group by price;
drop table a1;

create table t1(a float primary key,b int);
insert into t1(a) values(2),(11),(8);
select min(a),min(case when 1=1 then a else NULL end),
  min(case when 1!=1 then NULL else a end)
from t1 where b=3 group by b;
drop table t1;


#
###2-3:30782:Truncated UNSIGNED BIGINT columns
#
create table t1(a bigint primary key,b bigint);
create table t2(c bigint primary key,d bigint);
insert into t1(a,b) values(1,4572794622775114594),(2,18196094287899841997),
  (3,11120436154190595086);
insert into t2(c) values(1),(2),(3);
select t1.a,(case t1.a when 0 then 0 else t1.b end) d from t1 
  join t2 on t1.a=t2.c order by d;
select t1.a,(case t1.a when 0 then 0 else t1.b end) d from t1 
  join t2 on t1.a=t2.c where b=11120436154190595086 order by d;
drop table t1,t2;

--echo End of 5.0 tests


###///新添测试项///###
###2-x:(新增测试项说明)
#do sql
########################################################################################################
