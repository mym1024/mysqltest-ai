####################################必填######################################################
###1.测试功能点：类型转换函数验证
##
#
###2.测试项：(每新添一测试项，需在添加前注明测试项，注释填写在新添sq1前，不填在此处，如下样例）
###3.问题网址：xxx
###4.问题号：xxx
###5.预计运行时间：xxx
###6.编写/修改人：zhuyinying;zhangtong
###7.编写/修改日期：2019-12-23;2023-07-25(追加convert)
###8.其他（选填）：case格式规范化修改
###
##
#
##############################################################################################

#####################################Do sql###################################################
set names utf8mb4;
set yao_decimal_add_zero=true;

select cast(null as decimal(10,5));

drop table if exists t1;
create table t1(k int primary key,c1 decimal(10,5),c2 int,c3 double,c4 bool,c5 varchar(100),c6 datetime);
insert into t1 values(1,1234.1234,1234,123.123,true,'986.123','2017-08-16 14:44:00');
insert into t1 values(2,1234.123401,1234,1.23123e2,true,'986.123a','2017-08-16 14:44:00');
select * from t1;


###2-1:其他类型转换为decimal类型
#cast other to decimal
select cast(c1 as decimal(15,5)) from t1;
select cast(c2 as decimal(15,5)) from t1;
select cast(c3 as decimal(15,5)) from t1;
select cast(c4 as decimal(15,5)) from t1;
select cast(c5 as decimal(15,5)) from t1;
--error 58
select cast(c6 as decimal(15,5)) from t1;

select cast(c1 as decimal(20,10)) from t1;
select cast(c2 as decimal(20,10)) from t1;
select cast(c3 as decimal(20,10)) from t1;
select cast(c4 as decimal(20,10)) from t1;
select cast(c5 as decimal(20,10)) from t1;
--error 58
select cast(c6 as decimal(20,10)) from t1;


###2-2:calc
drop table if exists t1;
create table t1(k int primary key,c1 decimal(10,5),c2 int,c3 double,c4 bool,c5 varchar(100),c6 datetime);
insert into t1 values(1,1234,1234,123.123,true,'986.123','2017-08-16 14:44:00');
insert into t1 values(2,1.234567e2,1234,123.123,true,'986.123','2017-08-16 14:44:00');
insert into t1 values(3,'1234.1234',1234,123.123,true,'986.123','2017-08-16 14:44:00');
insert into t1 values(4,true,1234,123.123,true,'986.123','2017-08-16 14:44:00');
--error 153
insert into t1 values(5,'2017-08-16 14:44:00',1234,1.23123e2,true,'986.123a','2017-08-16 14:44:00');
select * from t1;

replace into t1 values(1,1234,1234,123.123,true,'986.123','2017-08-16 14:44:00');
replace into t1 values(2,1.234567e2,1234,123.123,true,'986.123','2017-08-16 14:44:00');
replace into t1 values(3,'1234.1234',1234,123.123,true,'986.123','2017-08-16 14:44:00');
replace into t1 values(4,true,1234,123.123,true,'986.123','2017-08-16 14:44:00');
--error 153
replace into t1 values(5,'2017-08-16 14:44:00',1234,1.23123e2,true,'986.123a','2017-08-16 14:44:00');
select * from t1;
delete from t1 where k=5;
select * from t1;


###2-3:更新操作
update t1 set c1=c2;
select * from t1;
update t1 set c1=c3;
select * from t1;
update t1 set c1=c4;
select * from t1;
update t1 set c1=c5;
select * from t1;
--error 119
update t1 set c1=c6;
select * from t1;


###2-4:带计算的更新操作
update t1 set c1=c2+100.123;
select * from t1;
update t1 set c1=c3+100.123;
select * from t1;
update t1 set c1=c4+100.123;
select * from t1;
update t1 set c1=c5+100.123;
select * from t1;
--error 119
update t1 set c1=c6+100.123;
select * from t1;

update t1 set c1=c2+100;
select * from t1;
update t1 set c1=c3+100;
select * from t1;
update t1 set c1=c4+100;
select * from t1;
update t1 set c1=c5+100;
select * from t1;
--error 119
update t1 set c1=c6+100;
select * from t1;

###2-5:转换函数convert测试
create table t2(c_int int primary key not null,c_varchar varchar(20) not null,c_bool bool not null,c_datetime datetime not null,c_double double not null,c_float float not null);
create table t3(c1 number(10)  not null primary key, c2 varchar(20) not null);
create table t4(c1 number(10)  not null primary key, c2 varchar(20) not null);

insert into t2 values(1,'jing',true,'2020-04-21',10324.83,12439.9);
insert into t3 values(1,'abcbcbc');
insert into t4 values(1,'bc');

##参数不同
select convert(null,float);
--error 5001
select convert(3,null);
select convert(10,int);
#--error 7
select convert(10,time);
select convert(10,datetime);
#--error 5102
select convert('12.1234',datetime);
select convert(2.475,bool);
select convert(-2.47512345678923456,double);
select convert('-0.2e4',double);
select convert('a',char);
--error 5001
select convert(12,float(null));
select convert(null,varchar(10));
select convert('124',float(5));
select convert(null,decimal(10,2));
select convert(true,decimal(8,2));
##issue39
select convert(10,datetime);
select convert(20220526123456,datetime);
select convert(10,timestamp);
select convert(20220526123456,timestamp);
#--error 5103
select convert('20220812123456',date);
select convert('20220812',date);
#--error 5104
select convert('123456',time);
select convert('12:34:56',time);

##位置不同
update t2 set c_int = 7,c_varchar='天气真好' where convert(c_int,double)=1;
update t2 set c_float=convert(3>=2,float),c_varchar=convert(1.34,char) where c_int=7;
insert into t2 values(3,1.34,0,'2021-04-21 00:00:00.000000',convert(true,char),7.55);
select c_varchar from t2 group by c_int having c_int < (convert('3.22',float));
select c_varchar from t2 where c_int=(convert('2',float)) union select c_varchar from t2 where c_int=3;
select convert(concat(c_int,'23'),float) from t2;
delete from t2 where c_double=convert(10324.83,char) and c_bool = convert(true,float);
select * from t2;
select t3.c1,t4.c1 from t3,t4 where convert(t3.c1,char)=convert(t4.c1,char);

##四则运算、逻辑运算
select convert(2+3*2/2.5,float(10));
select convert(2+3*2/2.5-10,double);
select convert('5mod2',decimal(8,2));
select convert('1=1',float);
select convert('0>1',double);
select convert('3<1',char);
select convert('1+2*(0.5*2)/1)>=(10+2*1.5)',float);
select convert(3!=2,char);
select convert(3<>2,double);
select convert(1||2,char);

##参数为列
select convert(c_varchar,float) from t2;
select convert(c_float,double) from t2;
select convert(c_float*2,double) from t2;
select * from t2 where c_int between convert('2',float) and 5;

##视图
create view v1 as select convert(2,char);
create view v2 as select convert(2.123456789,decimal(5, 2));
create view v3 as select convert('5.2345',decimal(5, 2));
create view v4 as select convert(convert(3.1456783,char),decimal(5,2));
select * from __all_view;

drop view v1,v2,v3,v4;
drop table t1,t2,t3,t4;

###///新添测试项///###
###2-x:(新增测试项说明)
#do sql
########################################################################################################
