####################################必填######################################################
###1.测试功能点：测试批量插入数据后，将事务回滚
##
#
###2.测试项：(每新添一测试项，需在添加前注明测试项，注释填写在新添sq1前，不填在此处，如下样例）
###3.问题网址：xxx
###4.问题号：xxx
###5.预计运行时间：xxx
###6.编写/修改人：zhuyinying
###7.编写/修改日期：2019-12-23
###8.其他（选填）：case格式规范化修改
###
##
#
##############################################################################################

#####################################Do sql###################################################
--disable_warnings
drop table if exists t1,t2;
--disable_warnings

##create table t1
#--echo set yao_query_timeout=90000000000
set yao_query_timeout=900000000;
create table t1(c1 int primary key,c2 int,c3 int,c4 int);
create table t2(c1 int primary key,c2 int,c3 int,c4 int);


###2-1：批量插入大量数据，在多session中将事务回滚
#do sql
#1-10000
--let $insert_head=insert into t1 values(1,1,1,1)
--let $insert_sql=
--let $m=(
--let $n=)
--let $d=,
--let $id_int=5000

while($id_int!=1)
{
--let $insert_sql=$insert_sql$d$m$id_int$d$id_int$d$id_int$d$id_int$n
dec $id_int;
}
eval $insert_head$insert_sql;


--let $insert_head=insert into t1 values(5001,5001,5001,5001)
--let $insert_sql=
--let $m=(
--let $n=)
--let $d=,
--let $id_int=10000

while($id_int!=5001)
{
--let $insert_sql=$insert_sql$d$m$id_int$d$id_int$d$id_int$d$id_int$n
dec $id_int;
}
eval $insert_head$insert_sql;


#10001-20000
--let $insert_head=insert into t1 values(10001,10001,10001,10001)
--let $insert_sql=
--let $m=(
--let $n=)
--let $d=,
--let $id_int=15000

while($id_int!=10001)
{
--let $insert_sql=$insert_sql$d$m$id_int$d$id_int$d$id_int$d$id_int$n
dec $id_int;
}
eval $insert_head$insert_sql;


--let $insert_head=insert into t1 values(15001,15001,15001,15001)
--let $insert_sql=
--let $m=(
--let $n=)
--let $d=,
--let $id_int=20000

while($id_int!=15001)
{
--let $insert_sql=$insert_sql$d$m$id_int$d$id_int$d$id_int$d$id_int$n
dec $id_int;
}
eval $insert_head$insert_sql;


#20001-30000
--let $insert_head=insert into t1 values(20001,20001,20001,20001)
--let $insert_sql=
--let $m=(
--let $n=)
--let $d=,
--let $id_int=25000

while($id_int!=20001)
{
--let $insert_sql=$insert_sql$d$m$id_int$d$id_int$d$id_int$d$id_int$n
dec $id_int;
}
eval $insert_head$insert_sql;


--let $insert_head=insert into t1 values(25001,25001,25001,25001)
--let $insert_sql=
--let $m=(
--let $n=)
--let $d=,
--let $id_int=30000

while($id_int!=25001)
{
--let $insert_sql=$insert_sql$d$m$id_int$d$id_int$d$id_int$d$id_int$n
dec $id_int;
}
eval $insert_head$insert_sql;


#30001-40000
--let $insert_head=insert into t1 values(30001,30001,30001,30001)
--let $insert_sql=
--let $m=(
--let $n=)
--let $d=,
--let $id_int=35000

while($id_int!=30001)
{
--let $insert_sql=$insert_sql$d$m$id_int$d$id_int$d$id_int$d$id_int$n
dec $id_int;
}
eval $insert_head$insert_sql;


--let $insert_head=insert into t1 values(35001,35001,35001,35001)
--let $insert_sql=
--let $m=(
--let $n=)
--let $d=,
--let $id_int=40000

while($id_int!=35001)
{
--let $insert_sql=$insert_sql$d$m$id_int$d$id_int$d$id_int$d$id_int$n
dec $id_int;
}
eval $insert_head$insert_sql;


#40001-50000
--let $insert_head=insert into t1 values(40001,40001,40001,40001)
--let $insert_sql=
--let $m=(
--let $n=)
--let $d=,
--let $id_int=45000

while($id_int!=40001)
{
--let $insert_sql=$insert_sql$d$m$id_int$d$id_int$d$id_int$d$id_int$n
dec $id_int;
}
eval $insert_head$insert_sql;


--let $insert_head=insert into t1 values(45001,45001,45001,45001)
--let $insert_sql=
--let $m=(
--let $n=)
--let $d=,
--let $id_int=50000

while($id_int!=45001)
{
--let $insert_sql=$insert_sql$d$m$id_int$d$id_int$d$id_int$d$id_int$n
dec $id_int;
}
eval $insert_head$insert_sql;


#50001-60000
--let $insert_head=insert into t1 values(50001,50001,50001,50001)
--let $insert_sql=
--let $m=(
--let $n=)
--let $d=,
--let $id_int=55000

while($id_int!=50001)
{
--let $insert_sql=$insert_sql$d$m$id_int$d$id_int$d$id_int$d$id_int$n
dec $id_int;
}
eval $insert_head$insert_sql;


--let $insert_head=insert into t1 values(55001,55001,55001,55001)
--let $insert_sql=
--let $m=(
--let $n=)
--let $d=,
--let $id_int=60000

while($id_int!=55001)
{
--let $insert_sql=$insert_sql$d$m$id_int$d$id_int$d$id_int$d$id_int$n
dec $id_int;
}
eval $insert_head$insert_sql;


#60001-70000
--let $insert_head=insert into t1 values(60001,60001,60001,60001)
--let $insert_sql=
--let $m=(
--let $n=)
--let $d=,
--let $id_int=65000

while($id_int!=60001)
{
--let $insert_sql=$insert_sql$d$m$id_int$d$id_int$d$id_int$d$id_int$n
dec $id_int;
}
eval $insert_head$insert_sql;


--let $insert_head=insert into t1 values(65001,65001,65001,65001)
--let $insert_sql=
--let $m=(
--let $n=)
--let $d=,
--let $id_int=70000

while($id_int!=65001)
{
--let $insert_sql=$insert_sql$d$m$id_int$d$id_int$d$id_int$d$id_int$n
dec $id_int;
}
eval $insert_head$insert_sql;


#70001-80000
--let $insert_head=insert into t1 values(70001,70001,70001,70001)
--let $insert_sql=
--let $m=(
--let $n=)
--let $d=,
--let $id_int=75000

while($id_int!=70001)
{
--let $insert_sql=$insert_sql$d$m$id_int$d$id_int$d$id_int$d$id_int$n
dec $id_int;
}
eval $insert_head$insert_sql;


#--let $insert_head=insert into t1 values(65001,65001,65001,65001)
#--let $insert_sql=
#--let $m=(
#--let $n=)
#--let $d=,
#--let $id_int=70000

#while($id_int!=65001)
#{
#--let $insert_sql=$insert_sql$d$m$id_int$d$id_int$d$id_int$d$id_int$n
#dec $id_int;
#}
#eval $insert_head$insert_sql;


#70001-80000
#--let $insert_head=insert into t1 values(70001,70001,70001,70001)
#--let $insert_sql=
#--let $m=(
#--let $n=)
#--let $d=,
#--let $id_int=75000

#while($id_int!=70001)
#{
#--let $insert_sql=$insert_sql$d$m$id_int$d$id_int$d$id_int$d$id_int$n
#dec $id_int;
#}
#eval $insert_head$insert_sql;


--let $insert_head=insert into t1 values(75001,75001,75001,75001)
--let $insert_sql=
--let $m=(
--let $n=)
--let $d=,
--let $id_int=80000

while($id_int!=75001)
{
--let $insert_sql=$insert_sql$d$m$id_int$d$id_int$d$id_int$d$id_int$n
dec $id_int;
}
eval $insert_head$insert_sql;


#80001-90000
--let $insert_head=insert into t1 values(80001,80001,80001,80001)
--let $insert_sql=
--let $m=(
--let $n=)
--let $d=,
--let $id_int=85000

while($id_int!=80001)
{
--let $insert_sql=$insert_sql$d$m$id_int$d$id_int$d$id_int$d$id_int$n
dec $id_int;
}
eval $insert_head$insert_sql;


--let $insert_head=insert into t1 values(85001,85001,85001,85001)
--let $insert_sql=
--let $m=(
--let $n=)
--let $d=,
--let $id_int=90000

while($id_int!=85001)
{
--let $insert_sql=$insert_sql$d$m$id_int$d$id_int$d$id_int$d$id_int$n
dec $id_int;
}
eval $insert_head$insert_sql;


#90001-100000
--let $insert_head=insert into t1 values(90001,90001,90001,90001)
--let $insert_sql=
--let $m=(
--let $n=)
--let $d=,
--let $id_int=95000

while($id_int!=90001)
{
--let $insert_sql=$insert_sql$d$m$id_int$d$id_int$d$id_int$d$id_int$n
dec $id_int;
}
eval $insert_head$insert_sql;


--let $insert_head=insert into t1 values(95001,95001,95001,95001)
--let $insert_sql=
--let $m=(
--let $n=)
--let $d=,
--let $id_int=100000

while($id_int!=95001)
{
--let $insert_sql=$insert_sql$d$m$id_int$d$id_int$d$id_int$d$id_int$n
dec $id_int;
}
eval $insert_head$insert_sql;

#--error 12
insert into t2 select * from t1;
#batch_rollback_case
set @@global.yao_query_timeout=1500000000;
set @@global.yao_tx_timeout=1500000000;
alter system set lock_wait_time='1000s' server_type=yaotxnsvr;

connect (conn1,$OBMYSQL_MS0,admin,admin,test,$OBMYSQL_PORT);
connect (conn2,$OBMYSQL_MS0,admin,admin,test,$OBMYSQL_PORT);

connection conn1;
begin;
delete from t1 where c1<10000;

--real_sleep 5
connection conn2;
delete from t1 where c1<10000;

connection conn1;
#--real_sleep 10
--error 119
commit;
connection conn2;
rollback;


connect (conn3,$OBMYSQL_MS0,admin,admin,test,$OBMYSQL_PORT);
connect (conn4,$OBMYSQL_MS0,admin,admin,test,$OBMYSQL_PORT);

connection conn3;
begin;
insert into t1 select * from t2 where c1<10000;

connection conn4;
--error 119
--real_sleep 10
insert into t1 select * from t2 where c1<10000;

connection conn3;
--real_sleep 10
--error 119
commit;
connection conn4;
rollback;


connect (conn5,$OBMYSQL_MS0,admin,admin,test,$OBMYSQL_PORT);
connect (conn6,$OBMYSQL_MS0,admin,admin,test,$OBMYSQL_PORT);

connection conn5;
begin;
--error 119
update t1 set c1=-1*c1 where c1<=100000;

connection conn6;
begin;
--error 119
update t1 set c1=-1*c1 where c1<=100000;

connection conn5;
rollback;
connection conn6;
rollback;


connect (conn7,$OBMYSQL_MS0,admin,admin,test,$OBMYSQL_PORT);
connect (conn8,$OBMYSQL_MS0,admin,admin,test,$OBMYSQL_PORT);

connection conn7;
begin;
update t1 set c3=3 where c1<=100000;

connection conn8;
begin;
--real_sleep 10
update t1 set c3=33 where c1<=100000;

connection conn7;
rollback;
connection conn8;
rollback;

set @@global.yao_tx_timeout=3000000;
set @@global.yao_query_timeout=3000000;
alter system set lock_wait_time='3s' server_type=yaotxnsvr;


###///新添测试项///###
###2-x:(新增测试项说明)
#do sql
########################################################################################################
