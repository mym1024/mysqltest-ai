####################################必填######################################################
###1.测试功能点：在多session下执行prepare操作
##
#
###2.测试项：(每新添一测试项，需在添加前注明测试项，注释填写在新添sq1前，不填在此处，如下样例）
###3.问题网址：xxx
###4.问题号：xxx
###5.预计运行时间：xxx
###6.编写/修改人：zhuyinying
###7.编写/修改日期：2020-01-13
###8.其他（选填）：case格式规范化修改
###
##
#
##############################################################################################

#####################################Do sql###################################################
--disable_warnings
drop table if exists t1; 
--enable_warnings

connect(conn1,$OBMYSQL_MS0,admin,admin,test,$OBMYSQL_PORT);
connect(conn2,$OBMYSQL_MS0,admin,admin,test,$OBMYSQL_PORT);
connect(conn3,$OBMYSQL_MS0,admin,admin,test,$OBMYSQL_PORT);


###2-1:muti conn each execute
connection conn1;
create table t1(a int primary key,b varchar(255),c int)partition by list(a)(partition q0 values in(1,3),partition q1 values in(2,4,5));
--real_sleep 1
insert into t1 values(1,'a',2),(2,'b',3),(3,'c',4);
--real_sleep 1
prepare stmt1 from select a from t1 where a=?;
set @a=2;
execute stmt1 using @a;
deallocate prepare stmt1;

connection conn2;
prepare stmt2 from select a from t1 where a=?;
set @a=2;
execute stmt2 using @a;
deallocate prepare stmt2;

disconnect conn1;
disconnect conn2;
disconnect conn3;


###2-2:muti conn share stmt
connect(conn1,$OBMYSQL_MS0,admin,admin,test,$OBMYSQL_PORT);
connect(conn2,$OBMYSQL_MS0,admin,admin,test,$OBMYSQL_PORT);
connect(conn3,$OBMYSQL_MS0,admin,admin,test,$OBMYSQL_PORT);

connection conn1;
prepare stmt3 from select a,b from t1 where a=?;
set @a=2;
execute stmt3 using @a;

connection conn2;
prepare stmt3 from select a,b from t1 where a=?;
set @a=2;
execute stmt3 using @a;

connection conn3;
prepare stmt3 from select a,b from t1 where a=?;
set @a=2;
execute stmt3 using @a;
set @a=3;
execute stmt3 using @a;


connection conn1;
deallocate prepare stmt3;

connection conn2;
prepare stmt4 from select a,b from t1 where a=?;
set @a=2;
execute stmt4 using @a;
deallocate prepare stmt4;

connection conn3;
prepare stmt5 from select a,b from t1 where a=?;
set @a=2;
execute stmt5 using @a;
set @a=3;
execute stmt5 using @a;
deallocate prepare stmt5;

disconnect conn1;
disconnect conn2;
disconnect conn3;


###2-3:muti conn shcema shange 
connect(conn1,$OBMYSQL_MS0,admin,admin,test,$OBMYSQL_PORT);
connect(conn2,$OBMYSQL_MS0,admin,admin,test,$OBMYSQL_PORT);
connect(conn3,$OBMYSQL_MS0,admin,admin,test,$OBMYSQL_PORT);

connection conn1;
prepare stmt6 from select a,b from t1 where a=? and b='b';
set @a=2;
execute stmt6 using @a;

connection conn2;
prepare stmt6 from select a,b from t1 where a=? and b='b';
set @a=2;
execute stmt6 using @a;

# add new column
connection conn1;
alter table t1 add d int;
set @a=2;
execute stmt6 using @a;

connection conn2;
set @a=2;
execute stmt6 using @a;
deallocate prepare stmt6;

disconnect conn1;
disconnect conn2;
disconnect conn3;


# drop  no use column
connect(conn1,$OBMYSQL_MS0,admin,admin,test,$OBMYSQL_PORT);
connect(conn2,$OBMYSQL_MS0,admin,admin,test,$OBMYSQL_PORT);

connection conn1;
prepare stmt7 from select a,b from t1 where a=? and b='b';
set @a=2;
execute stmt7 using @a;

connection conn2;
prepare stmt7 from select a,b from t1 where a=? and b='b';
set @a=2;
execute stmt7 using @a;

connection conn1;
alter table t1 drop d;
set @b=2;
execute stmt7 using @b;

connection conn2;
set @b=2;
execute stmt7 using @b;
deallocate prepare stmt7;

disconnect conn1;
disconnect conn2;


# drop use column
connect(conn1,$OBMYSQL_MS0,admin,admin,test,$OBMYSQL_PORT);
connect(conn2,$OBMYSQL_MS0,admin,admin,test,$OBMYSQL_PORT);

connection conn1;
prepare stmt8 from select a,b from t1 where a=? and b='b';
set @a=2;
execute stmt8 using @a;

connection conn2;
prepare stmt8 from select a,b from t1 where a=? and b='b';
set @a=2;
execute stmt8 using @a;

connection conn1;
alter table t1 drop b;
set @a=2;
#--error 65535
--error 5009
execute stmt8 using @a;

connection conn2;
set @a=2;
--error 5009 
execute stmt8 using @a;
deallocate prepare stmt8;

disconnect conn1;
disconnect conn2;


# add new column and drop it
connect(conn1,$OBMYSQL_MS0,admin,admin,test,$OBMYSQL_PORT);
connect(conn2,$OBMYSQL_MS0,admin,admin,test,$OBMYSQL_PORT);

connection conn1;
drop table t1;
create table t1(a int primary key,b varchar(255),c int)partition by range(a)(partition r0 values less than(5),partition r1 values less than(10),partition r2 values less than maxvalue);
--real_sleep 5
insert into t1 values(1,'a',2),(2,'b',3),(3,'c',4);
 
prepare stmt9 from select a,b from t1 where b=? and a=1;
set @b='a';
execute stmt9 using @b;

connection conn2;
prepare stmt9 from select a,b from t1 where b=? and a=1;
set @b='a';
execute stmt9 using @b;

connection conn1;
alter table t1 add d int;
alter table t1 drop d;
set @b='a';
execute stmt9 using @b;

connection conn2;
set @b='a';
execute stmt9 using @b;
deallocate prepare stmt9;

disconnect conn1;
disconnect conn2;


# add drop no new column and add it with same type
connect(conn1,$OBMYSQL_MS0,admin,admin,test,$OBMYSQL_PORT);
connect(conn2,$OBMYSQL_MS0,admin,admin,test,$OBMYSQL_PORT);

connection conn1;
drop table t1;
create table t1(a int primary key,b varchar(255),c int)partition by range(a)(partition r0 values less than(5),partition r1 values less than(10),partition r2 values less than maxvalue);
--real_sleep 5
insert into t1 values(1,'a',2),(2,'b',3),(3,'c',4);
 
prepare stmt10 from select a,b from t1 where b=? and a=2;
set @b='b';
execute stmt10 using @b;

connection conn2;
prepare stmt10 from select a,b from t1 where b=? and a=2;
set @b='b';
execute stmt10 using @b;

connection conn1;
alter table t1 drop c;
alter table t1 add c int;
set @b='b';
execute stmt10 using @b;

connection conn2;
set @b='b';
execute stmt10 using @b;
deallocate prepare stmt10;

disconnect conn1;
disconnect conn2;


# add no new column and add it with diff type
connect(conn1,$OBMYSQL_MS0,admin,admin,test,$OBMYSQL_PORT);
connect(conn2,$OBMYSQL_MS0,admin,admin,test,$OBMYSQL_PORT);

connection conn1;
drop table t1;
--error 5077
drop partition function h;
create hash partition function h(x) 'x+1';
create table t1(a int primary key,b varchar(255),c int)partition by(hs,h,a);
--real_sleep 5
insert into t1 values(1,'a',2),(2,'b',3),(3,'c',4);
 
prepare stmt11 from select a,b from t1 where b=? and a=2;
set @b='b';
execute stmt11 using @b;

connection conn2;
prepare stmt11 from select a,b from t1 where b=? and a=2;
set @b='b';
execute stmt11 using @b;

connection conn1;
alter table t1 drop c;
alter table t1 add c varchar(255);
set @b='b';
execute stmt11 using @b;

connection conn2;
set @b='b';
execute stmt11 using @b;
deallocate prepare stmt11;

disconnect conn1;
disconnect conn2;


# drop use column and add it with same type
connect(conn1,$OBMYSQL_MS0,admin,admin,test,$OBMYSQL_PORT);
connect(conn2,$OBMYSQL_MS0,admin,admin,test,$OBMYSQL_PORT);

connection conn1;
drop table t1;
--error 5077
drop partition function e;
create enum partition function e(x) '[(1)],[(2)],[(3)]';
create table t1(a int primary key,b varchar(255),c int)partition by(em,e,a);
--real_sleep 1
insert into t1 values(1,'a',2),(2,'b',3),(3,'c',4);
 
prepare stmt12 from select a,b from t1 where b=? and a=2;
set @b='b';
--real_sleep 1
execute stmt12 using @b;

connection conn2;
prepare stmt12 from select a,b from t1 where b=? and a=2;
set @b='b';
--real_sleep 1
execute stmt12 using @b;

connection conn1;
alter table t1 drop b;
alter table t1 add b varchar(255);
set @b='b';
#--error 65535
execute stmt12 using @b;

connection conn2;
set @b='hah';
#--error 65535
execute stmt12 using @b;
deallocate prepare stmt12;

disconnect conn1;
disconnect conn2;


# drop use column and add it with same type
connect(conn1,$OBMYSQL_MS0,admin,admin,test,$OBMYSQL_PORT);
connect(conn2,$OBMYSQL_MS0,admin,admin,test,$OBMYSQL_PORT);

connection conn1;
drop table t1;
create table t1(a int primary key,b varchar(255),c int)partition by range(a)(partition r0 values less than(5),partition r1 values less than(10),partition r2 values less than maxvalue);
--real_sleep 5
insert into t1 values(1,'a',2),(2,'b',3),(3,'c',4);
 
prepare stmt13 from select a,b from t1 where b=? and a=2;
set @b='b';
execute stmt13 using @b;

connection conn2;
prepare stmt13 from select a,b from t1 where b=? and a=2;
set @b='b';
execute stmt13 using @b;

connection conn1;
alter table t1 drop b;
alter table t1 add b int;
set @b='b';
#--error 65535
execute stmt13 using @b;

connection conn2;
set @b='hah';
#--error 65535
execute stmt13 using @b;
deallocate prepare stmt13;

disconnect conn1;
disconnect conn2;


# drop table
connect(conn1,$OBMYSQL_MS0,admin,admin,test,$OBMYSQL_PORT);
connect(conn2,$OBMYSQL_MS0,admin,admin,test,$OBMYSQL_PORT);

connection conn1;
drop table t1;
create table t1(a int primary key,b varchar(255),c int)partition by range(a)(partition r0 values less than(5),partition r1 values less than(10),partition r2 values less than maxvalue);
--real_sleep 5
insert into t1 values(1,'a',2),(2,'b',3),(3,'c',4);
 
prepare stmt14 from select a,b from t1 where b=? and a=2;
set @b='b';
execute stmt14 using @b;

connection conn2;
prepare stmt14 from select a,b from t1 where b=? and a=2;
set @b='b';
execute stmt14 using @b;

connection conn1;
drop table t1;
set @b='b';
#--error 65535
--error 5019
execute stmt14 using @b;

connection conn2;
set @b='b';
#--error 65535
--error 5019
execute stmt14 using @b;
deallocate prepare stmt14;

disconnect conn1;
disconnect conn2;


# drop table and add it again
connect(conn1,$OBMYSQL_MS0,admin,admin,test,$OBMYSQL_PORT);
connect(conn2,$OBMYSQL_MS0,admin,admin,test,$OBMYSQL_PORT);

connection conn1;
create table t1(a int primary key,b varchar(255),c int);
--real_sleep 5
insert into t1 values(1,'a',2),(2,'b',3),(3,'c',4);
 
prepare stmt15 from select a,b from t1 where b=? and a=2;
set @b='b';
execute stmt15 using @b;

connection conn2;
prepare stmt15 from select a,b from t1 where b=? and a=2;
set @b='b';
execute stmt15 using @b;

connection conn1;
drop table t1;
create table t1(a int primary key,b varchar(255),c int)partition by list(a)(partition q0 values in(1,3),partition q1 values in(2,4,5));
--real_sleep 2
insert into t1 values(1,'a',2),(2,'b',3),(3,'c',4);
--real_sleep 2
set @b='b';
#--error 65535
execute stmt15 using @b;

connection conn2;
set @b='b';
#--error 65535
execute stmt15 using @b;
deallocate prepare stmt15;

disconnect conn1;
disconnect conn2;


# drop table and add it again with diff shecma
connect(conn1,$OBMYSQL_MS0,admin,admin,test,$OBMYSQL_PORT);
connect(conn2,$OBMYSQL_MS0,admin,admin,test,$OBMYSQL_PORT);

connection conn1;
drop table t1;
create table t1(a int primary key,b varchar(255),c int);
--real_sleep 5
insert into t1 values(1,'a',2),(2,'b',3),(3,'c',4);
 
prepare stmt16 from select a,b from t1 where b=? and a=2;
set @b='b';
execute stmt16 using @b;

connection conn2;
prepare stmt16 from select a,b from t1 where b=? and a=2;
set @b='b';
execute stmt16 using @b;

connection conn1;
drop table t1;
create table t1(a int primary key,b varchar(255));

set @b='b';
#--error 65535
execute stmt16 using @b;

connection conn2;
set @b='b';
#--error 65535
execute stmt16 using @b;
deallocate prepare stmt16;

disconnect conn1;
disconnect conn2;


# drop table and add it again with diff shecma
connect(conn1,$OBMYSQL_MS0,admin,admin,test,$OBMYSQL_PORT);
connect(conn2,$OBMYSQL_MS0,admin,admin,test,$OBMYSQL_PORT);

connection conn1;
drop table t1;
create table t1(a int primary key,b varchar(255),c int,d int);
--real_sleep 5
insert into t1 values(1,'a',2,1),(2,'b',3,3),(3,'c',4,2);
 
prepare stmt17 from select a,b from t1 where b=? and a=2;
set @b='b';
execute stmt17 using @b;

connection conn2;
prepare stmt17 from select a,b from t1 where b=? and a=2;
set @b='b';
execute stmt17 using @b;

connection conn1;
drop table t1;
create table t1(a int primary key,c varchar(255));
--real_sleep 5

set @b='b';
#--error 65535
--error 5009
execute stmt17 using @b;

connection conn2;
set @b='b';
#--error 65535
--error 5009
execute stmt17 using @b;
deallocate prepare stmt17;

disconnect conn1;
disconnect conn2;


# muti conn by turn
# add new column and drop it
connect(conn1,$OBMYSQL_MS0,admin,admin,test,$OBMYSQL_PORT);
connect(conn2,$OBMYSQL_MS0,admin,admin,test,$OBMYSQL_PORT);

connection conn1;
drop table t1;
create table t1(a int primary key,b varchar(255),c int);
--real_sleep 5
insert into t1 values(1,'a',2),(2,'b',3),(3,'c',4);
 
prepare stmt18 from select a,b from t1 where b=? and a=1;
set @b='a';
execute stmt18 using @b;

connection conn2;
prepare stmt18 from select a,b from t1 where b=? and a=1;
set @b='a';
execute stmt18 using @b;

connection conn1;
alter table t1 add d int;

connection conn2;
alter table t1 drop d ;

connection conn1;
set @b='a';
execute stmt18 using @b;

connection conn2;
set @b='a';
execute stmt18 using @b;
deallocate prepare stmt18;

disconnect conn1;
disconnect conn2;


# add drop no use column and add it with same type
connect(conn1,$OBMYSQL_MS0,admin,admin,test,$OBMYSQL_PORT);
connect(conn2,$OBMYSQL_MS0,admin,admin,test,$OBMYSQL_PORT);

connection conn1;
drop table t1;
create table t1(a int primary key,b varchar(255),c int);
--real_sleep 5
prepare stmt19 from select a,b from t1 where b=? and a=2;
set @b=2;
execute stmt19 using @b;

connection conn2;
prepare stmt19 from select a,b from t1 where b=? and a=2;
set @b='b';
execute stmt19 using @b;

connection conn1;
alter table t1 drop c;

connection conn2;
alter table t1 add c int;

connection conn1;
set @b='b';
execute stmt19 using @b;

connection conn2;
set @b='b';
execute stmt19 using @b;
deallocate prepare stmt19;

disconnect conn1;
disconnect conn2;


# drop no use column and add it with diff type
connect(conn1,$OBMYSQL_MS0,admin,admin,test,$OBMYSQL_PORT);
connect(conn2,$OBMYSQL_MS0,admin,admin,test,$OBMYSQL_PORT);

connection conn1;
drop table t1;
create table t1(a int primary key,b varchar(255),c int);
--real_sleep 5
insert into t1 values(1,'a',2),(2,'b',3),(3,'c',4);

prepare stmt20 from select a,b from t1 where b=? and a=2;
set @b='b';
execute stmt20 using @b;

connection conn2;
prepare stmt20 from select a,b from t1 where b=? and a=2;
set @b='b';
execute stmt20 using @b;

connection conn1;
alter table t1 drop c;

connection conn2;
alter table t1 add c varchar(255);

connection conn1;
set @b='b';
execute stmt20 using @b;

connection conn2;
set @b='b';
execute stmt20 using @b;
deallocate prepare stmt20;

disconnect conn1;
disconnect conn2;



connect(conn1,$OBMYSQL_MS0,admin,admin,test,$OBMYSQL_PORT);
connect(conn2,$OBMYSQL_MS0,admin,admin,test,$OBMYSQL_PORT);

connection conn1;
drop table t1;
create table t1(a int primary key,b varchar(255),c int);
--real_sleep 5
insert into t1 values(1,'a',2),(2,'b',3),(3,'c',4);

prepare stmt21 from select a,b from t1 where b=? and a=2;
set @b='b';
execute stmt21 using @b;

connection conn2;
prepare stmt21 from select a,b from t1 where b=? and a=2;
set @b='b';
execute stmt21 using @b;

connection conn1;
alter table t1 drop b;

connection conn2;
alter table t1 add b varchar(255);

connection conn1;
set @b='b';
#--error 65535
execute stmt21 using @b;

connection conn2;
set @b='b';
#--error 65535
execute stmt21 using @b;
deallocate prepare stmt21;

disconnect conn1;
disconnect conn2;


connect(conn1,$OBMYSQL_MS0,admin,admin,test,$OBMYSQL_PORT);
connect(conn2,$OBMYSQL_MS0,admin,admin,test,$OBMYSQL_PORT);

connection conn1;
drop table t1;
create table t1(a int primary key,b varchar(255),c int);
--real_sleep 5
insert into t1 values(1,'a',2),(2,'b',3),(3,'c',4);

prepare stmt22 from select a,b from t1 where b=? and a=2;
set @b='b';
execute stmt22 using @b;

connection conn2;
prepare stmt22 from select a,b from t1 where b=? and a=2;
set @b=2;
#--error 5023
execute stmt22 using @b;

connection conn1;
alter table t1 drop b;

connection conn2;
alter table t1 add b int;

connection conn1;
set @b='b';
#--error 65535
execute stmt22 using @b;

connection conn2;
set @b='b';
#--error 65535
execute stmt22 using @b;
deallocate prepare stmt22;

disconnect conn1;
disconnect conn2;



###///新添测试项///###
###2-x:(新增测试项说明)
#do sql
########################################################################################################




















































































































































































































































































































































































































































































































































































































































































