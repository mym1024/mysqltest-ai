##############################################################################################
###1.测试功能点：测试truncate后，对同一行数据进行操作，主备数据是否一致
#                         
#                 
#
###2.测试项：(每新添一测试项，需在添加前注明测试项，注释填写在新添sq1前，不填在此处，如下样例）
###3.问题网址：http://182.119.80.93/cbase_dev/cbase/issues/526
###4.问题号：526
###5.预计运行时间：12s
###6.编写/修改人： yuanzhuping
###7.编写/修改日期：2020-09-11
###8.其他（选填）：case格式规范化修改
###
##
#
##############################################################################################

#####################################Do sql###################################################

#开3个客户端
connect (conn1,$OBMYSQL_MS0,admin,admin,test,$OBMYSQL_PORT);
connect (conn2,$OBMYSQL_MS0,admin,admin,test,$OBMYSQL_PORT);
#连接客户端1
connection conn1;
echo 'conn1';

alter system set max_row_cell_num = 3 server_type=yaotxnsvr;
--real_sleep 10
create table t1 (c1 int primary key,c2 int,c3 int,c4 int,c5 int);
create table t2 (c1 int primary key,c2 int,c3 int,c4 int,c5 int);

truncate table t1;
begin;
replace into t2 values(1,1,1,1,1);

#连接客户端2
connection conn2;
echo 'conn2';
replace into t1 values(1,2,3,4,5);
replace into t1 values(1,20,30,40,50);

#连接客户端1
connection conn1;
echo 'conn1';
update t1 set c2 = 200 where c1 = 1;
commit;


#查询表看每次结果是否一致
select /*+READ_CONSISTENCY(STRONG)*/ * from t1;
select /*+READ_CONSISTENCY(WEAK)*/ * from t1;
select /*+READ_CONSISTENCY(WEAK)*/ * from t1;
select /*+READ_CONSISTENCY(WEAK)*/ * from t1;
select /*+READ_CONSISTENCY(WEAK)*/ * from t1;
select /*+READ_CONSISTENCY(WEAK)*/ * from t1;
select /*+READ_CONSISTENCY(WEAK)*/ * from t1;
select /*+READ_CONSISTENCY(WEAK)*/ * from t1;
select /*+READ_CONSISTENCY(WEAK)*/ * from t1;
select /*+READ_CONSISTENCY(WEAK)*/ * from t1;
select /*+READ_CONSISTENCY(WEAK)*/ * from t1;
select /*+READ_CONSISTENCY(WEAK)*/ * from t1;
select /*+READ_CONSISTENCY(WEAK)*/ * from t1;
select /*+READ_CONSISTENCY(WEAK)*/ * from t1;
select /*+READ_CONSISTENCY(WEAK)*/ * from t1;


truncate table t2;
begin;
replace into t1 values(1,1,1,1,1);

#连接客户端2
connection conn2;
echo 'conn2';
replace into t2 values(10,2,3,4,5);
replace into t2 values(10,20,30,40,50);

#连接客户端1
connection conn1;
echo 'conn1';
update t2 set c2 = 200 where c1 = 10;
commit;

#查询表看每次结果是否一致
select /*+READ_CONSISTENCY(STRONG)*/ * from t2;
select /*+READ_CONSISTENCY(WEAK)*/ * from t2;
select /*+READ_CONSISTENCY(WEAK)*/ * from t2;
select /*+READ_CONSISTENCY(WEAK)*/ * from t2;
select /*+READ_CONSISTENCY(WEAK)*/ * from t2;
select /*+READ_CONSISTENCY(WEAK)*/ * from t2;
select /*+READ_CONSISTENCY(WEAK)*/ * from t2;
select /*+READ_CONSISTENCY(WEAK)*/ * from t2;
select /*+READ_CONSISTENCY(WEAK)*/ * from t2;
select /*+READ_CONSISTENCY(WEAK)*/ * from t2;
select /*+READ_CONSISTENCY(WEAK)*/ * from t2;
select /*+READ_CONSISTENCY(WEAK)*/ * from t2;
select /*+READ_CONSISTENCY(WEAK)*/ * from t2;
select /*+READ_CONSISTENCY(WEAK)*/ * from t2;
select /*+READ_CONSISTENCY(WEAK)*/ * from t2;

alter system set max_row_cell_num = 32 server_type=yaotxnsvr;

###///新添测试项///###
###2-x:(新增测试项说明)
#do sql
########################################################################################################
