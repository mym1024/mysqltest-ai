###1.测试功能点：hash分区、range分区、list分区和listagg功能结合测试
##
#
###2.测试项：
###2.问题网址：
###3.问题号：
###4.预计运行时间：30 s
###5.编写/修改人：chensy
###6.编写/修改日期：2019-11-04
###7.其他（选填）：case格式规范化修改
###
##
#
##############################################################################################

#####################################Do sql####################################################

###2-1 分区功能和listagg功能结合的测试
--disable_warnings
drop table if exists test_sy,test_s,test_y;
--real_sleep 3
--enable_warnings
create hash partition function h1(x)'x*2+5-3';
create table test_sy(id int primary key,age int ,name varchar(30))partition by(h1t,h1,id);
exec $LOCAL_DIR/tools/as_admin -r $RS0_IP -p $RS0_PORT refresh_schema | tail -1;
--real_sleep 3
insert into test_sy values(1,1,'a'),(2,2,'b'),(3,3,'c'),(4,4,'d'),(5,5,'e');
--real_sleep 3
create table test_s(id int primary key,age int ,name varchar(30),sex char(1))partition by range(id)(partition r1 values less than(2),partition r2 values less than(5),partition r3 values less than maxvalue);
exec $LOCAL_DIR/tools/as_admin -r $RS0_IP -p $RS0_PORT refresh_schema | tail -1;
--real_sleep 3
insert into test_s values(1,10,'aa','0'),(2,22,'bb','1');
create table test_y(id int primary key,age int ,name varchar(30),sex char(1))partition by list(id)(partition z1 values in(1,3),partition z2 values in(2,4));
exec $LOCAL_DIR/tools/as_admin -r $RS0_IP -p $RS0_PORT refresh_schema | tail -1;
--real_sleep 3
insert into test_y values(1,100,'aaa','0'),(2,222,'bbb','1');
--real_sleep 3
select * from test_sy;
select * from test_s;
select * from test_y;
select listagg(name, ',')within group (order by id) as NAMES from test_sy;
select listagg(name, ',')as NAMES from test_sy;
select listagg(name, ',')within group (order by id) as NAMES from test_sy;
select listagg(name, ',') as NAMES from test_sy;
select listagg(name, '\n')within group (order by id) as NAMES from test_sy;
select listagg(name, '\n') as NAMES from test_sy;
select listagg(name, '\n')within group (order by id) as NAMES from test_sy group by age;
select listagg(name, '\n') as NAMES from test_sy group by age;
select listagg(name, '\n')within group (order by age) as NAMES from test_sy order by id;
select listagg(name, '\n')as NAMES from test_sy order by id;
select listagg(name, ',')within group (order by age) as NAMES,sum(id) from test_sy ;
select listagg(name, ',')as NAMES,sum(id) from test_sy ;
select listagg(name, ',')within group (order by id) as NAMES, avg(age) from test_sy ;
select listagg(name, ',')as NAMES, avg(age) from test_sy;
select listagg(name, ',')within group (order by id) as NAMES, max(age) from test_sy ;
select listagg(name, ',')as NAMES, max(age) from test_sy;
select listagg(name, ',')within group (order by id) as NAMES, count(*) from test_sy ;
select listagg(name, ',')as NAMES, count(*) from test_sy;
select listagg(name)within group (order by id) as NAMES from test_sy ;
select listagg(name) as NAMES from test_sy;
select listagg(name,'/')within group (order by id desc) as NAMES ,listagg(age,'s')within group (order by age) as AGES from test_sy ;
select listagg(name,'/')as NAMES ,listagg(age,'s')as AGES from test_sy;
select listagg(name,'/')as NAMES ,listagg(age,'s')within group (order by age) as AGES from test_sy ;
select listagg(name,'/')as NAMES ,listagg(age,'s')as AGES from test_sy order by id;
select listagg(name, '\t')within group (order by id) as NAMES from test_sy ;
select listagg(name, '\t') from test_sy;
select listagg(name,'/')within group (order by age,id) from test_sy order by id;
select listagg(name,'/')  from test_sy order by age,id desc;
--error 5001
select listagg(distinct age,',')within group (order by id)from test_sy;
--error 5001
select listagg(distinct age,',') from test_sy;
select id, listagg(age,',')within group (order by id)from test_sy  group by age having age>1;
select id, listagg(age,',') from test_sy  group by age having age>1;
#select listagg(age,',')within group (order by id) from test_sy for update;
#select listagg(age,',') from test_sy for update;
select listagg(age,',')within group (order by id) from test_sy where id in (1,2,3,4,5);
select listagg(age,',') from test_sy where id in (1,2,3,4,5);
select listagg(name,',')within group (order by id desc) from test_sy where age=2 or age =1;
select listagg(name,',')from test_sy where age=2 or age =1;
select listagg(id,',')within group (order by id desc) from test_sy limit 1,2;
select listagg(id,',')from test_sy limit 1,2;
select listagg(test_sy.name ,',')within group (order by test_s.id desc) as NAME from test_sy inner join test_s on test_sy.id=test_s.id;
select listagg(test_sy.name ,',') as NAME from test_sy inner join test_s on test_sy.id=test_s.id;
select listagg(name ,',')within group (order by id desc) as NAMES ,listagg(name,','),listagg(name,',')from test_sy;
select listagg(name ,',')as NAMES ,listagg(name,','),listagg(name,',')from test_sy ;
select listagg(test_sy.name ,',')within group (order by test_sy.id desc) as NAME from test_sy left outer join test_s on test_sy.id=test_s.id;
select listagg(test_sy.name ,',')within group (order by test_sy.id asc) as NAME from test_sy left outer join test_s on test_sy.id=test_s.id;
select listagg(test_sy.name ,',')within group (order by test_s.id desc) as NAME from test_sy right outer join test_s on test_sy.id=test_s.id;
select listagg(test_sy.name ,',') as NAME from test_sy right outer join test_s on test_sy.id=test_s.id;
select listagg(test_sy.id ,',')within group (order by test_sy.id desc) as NAME from test_sy full join test_s on test_sy.id=test_s.id;
select listagg(test_sy.id ,',')within group (order by test_sy.id asc) as NAME from test_sy full join test_s on test_sy.id=test_s.id;
select listagg(name ,',')within group (order by id)from test_sy;
select listagg(name ,',')from test_sy;
select listagg(name ,',')within group (order by id)from test_sy;
select listagg(name ,',')from test_sy;
select listagg(name ,',')within group (order by id),listagg(age,',')as NAMES  from test_sy group by age;
select listagg(name ,','),listagg(age,',')as NAMES  from test_sy group by age;
--error 5054
select listagg(name ,',',',',',')within group (order by id)from test_sy;
--error 5054
select listagg(name ,',',',',',')from test_sy;
select listagg(name ,',')within group (order by id)as NAMES  from test_sy;
select listagg(name ,',')from test_sy;
select listagg(test_sy.name ,',')within group (order by test_s.id desc)as NAME from test_sy inner join test_s on test_sy.id=test_s.id group by test_sy.age;
select listagg(test_sy.name ,',')as NAME from test_sy inner join test_s on test_sy.id=test_s.id group by test_sy.age ;
select listagg(test_sy.name ,',')within group (order by test_s.id desc)as NAME from test_sy left outer join test_s on test_sy.id=test_s.id group by test_s.age limit 2;
select listagg(test_sy.name ,',')as NAME from test_sy left outer join test_s on test_sy.id=test_s.id group by test_sy.age ;
select listagg(test_sy.name ,',')within group (order by test_s.id desc)as NAME from test_sy right outer join test_s on test_sy.id=test_s.id group by test_s.sex;
select listagg(test_sy.age ,',')as NAMES,listagg(test_s.sex,',')as SEXS from test_sy,test_s where test_sy.id=test_s.id;
select listagg(test_sy.name ,',')within group (order by test_sy.id desc) from test_sy  where test_sy.age =test_sy.age;
select listagg(test_sy.name ,',')as NAME from test_sy right outer join test_s on test_sy.id=test_s.id group by test_s.sex;
select listagg(test_sy.id ,',')within group (order by test_s.id desc)as NAME from test_sy full join test_s on test_sy.id=test_s.id group by test_sy.age;
select listagg(test_sy.id ,',')as NAME from test_sy full join test_s on test_sy.id=test_s.id group by test_sy.age ;
select listagg(test_sy.age,',')within group (order by test_sy.id desc) as NAMES,listagg(test_s.sex,',')as SEXS from test_sy,test_s where test_sy.id=test_s.id ;
select listagg(test_sy.name ,',')from test_sy  where test_sy.age =test_sy.age;
select listagg(name,',')within group (order by id desc) from test_sy where name like '%y';
select listagg(name,',')from test_sy where name like '%y';
select listagg(name,',')within group (order by id desc) as NAMES from test_sy where id>=2 union select listagg(name,';') within group (order by id desc) as NAMES from test_sy where age<10;
select listagg(name,',')as NAMES from test_sy where id>=2 union select listagg(name,';') as NAMES from test_sy where age<10;
select listagg(name,',')within group (order by id desc) as NAMES from test_sy where id>=2 intersect select listagg(name,';') within group (order by id desc) as NAMES from test_sy where age<10;
select listagg(name,',')as NAMES from test_sy where id>=2 intersect select listagg(name,';') as NAMES from test_sy where age<10;
select listagg(name,',')within group (order by id desc) as NAMES from test_sy where id>=2 except select listagg(name,';') within group (order by id desc) as NAMES from test_sy where age<10;
select listagg(name,',')as NAMES from test_sy where id>=2 except select listagg(name,';') as NAMES from test_sy where age<10;
(select listagg(name,',')from test_sy order by id) union( select listagg(name ,';') from test_sy order by id desc);
select listagg(age-1,',')within group (order by id ) from test_sy;
select listagg(age-1,',') from test_sy;
select listagg(name,'?')within group (order by id)from test_sy where id not in (1,2,3);
select listagg(name,'?')from test_sy where id not in (1,2,3);
select listagg(name,',') within group (order by id) from test_sy where id>8;
select listagg(name,',') from test_sy where id>8;
select listagg(name,',')within group (order by id desc) from test_sy where id>1 and age<4;
select listagg(name,',')from test_sy where id>1 and age<4;
select listagg(name,',')within group (order by id desc) from test_sy group by age having count(*)>1;
select listagg(name,',')from test_sy group by age having count(*)>1;
select listagg(name,';') within group (order by id desc) from test_sy where age between 1 and 4;
select listagg(name,';') from test_sy where age between 1 and 4;
select listagg(name,';')within group (order by id desc) from test_sy where name not like '%y';
select listagg(id,',')within group (order by id DESC) from test_sy where age IS NULL;
select listagg(id,',')from test_sy where age IS NULL;
select listagg(name,',') within group (order by id desc)from test_sy where id>1 and id <10 or age>3;
select listagg(name,',')within group(order by id)from test_y;
select listagg(name,',')from test_y;
select listagg(id,';')within group(order by name)from test_y;
select listagg(id,';')from test_y;
select listagg(2015-id ,',')within group (order by id)from test_y;
select listagg(2015-id ,',')from test_y;
select listagg(name,',')within group(order by id desc) as NAMES from test_sy where age is not null;
select listagg(name,',')as NAMES from test_sy where age is not null;
select listagg(name,',')within group (order by id desc)from test_sy where id not between 3 and 10;
select listagg(name,',')from test_sy where id not between 3 and 10;
select listagg(test_sy.id ,',') within group (order by test_s.id desc) as NAME from test_sy ,test_s;
select listagg(test_sy.id ,',')  as NAMES from test_sy ,test_s where test_sy.id>=test_s.id;
select listagg(test_sy.name ,',')within group (order by test_s.id desc) from test_sy,test_s where test_sy.id=test_s.id and test_sy.id>1;
select listagg(test_sy.name ,',') from test_sy,test_s where test_sy.id=test_s.id and test_sy.id>1;
select listagg(name,',')within group (order by id desc)from test_sy where id>1 group by (age) having count(*)>1 order by id desc;
select listagg(name,',')from test_sy where id>1 group by (age) having count(*)>1 order by id desc;

drop table if exists test_sy,test_s,test_y;
--real_sleep 3
drop partition function h1;

###///新添测试项///###
###2-x：（新增测试项说明）
#do sql
#####################################Do sql####################################################
