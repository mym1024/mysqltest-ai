#######################################################
#1.���Թ��ܵ㣺��������ִ���йر���DDL����
#######################################################

using database test;
sleep 5;

###2-1:������������ʱִ��DDL����create table, alter table, rename table, drop table
create table t1(c1 int,c2 int, c3 int,primary key(c1));
show tables;
insert into t1 values(1,2,3);
select * from t1;
alter table t1 add column c4 int;
desc t1;
rename table t1 to t11;
show tables;
drop table t11;
show tables;

###2-2:������������ִ��DDL����create table, alter table, rename table, drop table
###��ʽһ: set autocommit =0 + insert
create table t1(c1 int, c2 int, primary key(c1));
create table t2(c1 int, c2 int, primary key(c1));

set autocommit=0;
insert into t1 values(1,1);
--error 5060
create table t3(c1 int, c2 int,c3 int,primary key(c1,c2));
commit;
select * from t1;
show tables;

set autocommit=0;
insert into t1 values(2,1);
--error 5060
create table t3(c1 int, c2 int, primary key(c1));
rollback;
select * from t1;
show tables;

set autocommit=0;
insert into t1 values(3,1);
--error 5060
alter table t2 add column c3 int;
commit;
select * from t1;
desc t2;

set autocommit=0;
insert into t1 values(4,1);
--error 5060
alter table t2 add column c3 int;
rollback;
select * from t1;
desc t2;

set autocommit=0;
insert into t1 values(5,1);
--error 5060
rename table t2 to t22;
commit;
select * from t1;
show tables;

set autocommit=0;
insert into t1 values(6,1);
--error 5060
rename table t2 to t22;
rollback;
select * from t1;
show tables;

set autocommit=0;
insert into t1 values(7,1);
--error 5060
drop table t2;
commit;
select * from t1;
show tables;

set autocommit=0;
insert into t1 values(8,1);
--error 5060
drop table t2;
rollback;
select * from t1;
show tables;

set autocommit=1;
drop table t1;
drop table t2;

###��ʽ��:begin
create table t1(c1 int, c2 int, primary key(c1));
create table t2(c1 int, c2 int, primary key(c1));
insert into t2 values(1,1),(2,1),(3,1);

begin;
--error 5060
create table t3(c1 int, c2 int,c3 int,primary key(c1,c2));
insert into t1 values(1,1);
commit;
select * from t1;
show tables;

begin;
--error 5060
create table t3(c1 int, c2 int, primary key(c1));
insert into t1 values(2,1);
rollback;
select * from t1;
show tables;

begin;
--error 5060
alter table t2 add column c3 int;
insert into t1 values(3,1);
commit;
select * from t1;
desc t2;

begin;
--error 5060
alter table t2 add column c3 int;
insert into t1 values(4,1);
rollback;
select * from t1;
desc t2;

begin;
--error 5060
rename table t2 to t22;
insert into t1 values(5,1);
commit;
select * from t1;
show tables;

begin;
--error 5060
rename table t2 to t22;
insert into t1 values(6,1);
rollback;
select * from t1;
show tables;

begin;
--error 5060
drop table t2;
insert into t1 values(7,1);
commit;
select * from t1;
show tables;

begin;
--error 5060
drop table t2;
insert into t1 values(8,1);
rollback;
select * from t1;
show tables;


drop table t1;
drop table t2;


###2-3:����������autocommitΪ0��ִ��DDL����create table, alter table, rename table, drop table
create table t1(c1 int, c2 int, primary key(c1));
create table t2(c1 int, c2 int, primary key(c1));

set autocommit=0;
create table t3(c1 int, c2 int,primary key(c1));
insert into t1 values(1,1);
commit;
show tables;
select * from t1;

set autocommit=0;
create table t4(c1 int, c2 int,primary key(c1));
insert into t1 values(2,1);
rollback;
show tables;
select * from t1;

set autocommit=0;
alter table t2 add column c3 int;
insert into t1 values(3,1);
commit;
select * from t1;
desc t2;

set autocommit=0;
alter table t2 add column c4 int;
insert into t1 values(4,1);
rollback;
select * from t1;
desc t2;

set autocommit=0;
rename table t2 to t22;
insert into t1 values(5,1);
commit;
select * from t1;
show tables;

set autocommit=0;
rename table t22 to t2;
insert into t1 values(6,1);
rollback;
select * from t1;
show tables;

set autocommit=0;
drop table t3;
insert into t1 values(7,1);
commit;
select * from t1;
show tables;

set autocommit=0;
drop table t4;
insert into t1 values(8,1);
rollback;
select * from t1;
show tables;
