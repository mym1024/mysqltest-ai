####################################必填######################################################
###1.测试功能点：在有无分区的环境下，验证count(distinct)
##
#
###2.测试项：(每新添一测试项，需在添加前注明测试项，注释填写在新添sq1前，不填在此处，如下样例）
###3.问题网址：xxx
###4.问题号：xxx
###5.预计运行时间：xxx
###6.编写/修改人：zhuyinying
###7.编写/修改日期：2019-12-17
###8.其他（选填）：case格式规范化修改
###
##
#
##############################################################################################

#####################################Do sql###################################################
# bug http://bugfree.corp.taobao.com/bug/200109
# multiple count(distinct)

###2-1：在无分区规则下，验证count(distinct)
#do sql
drop table if exists t1;
create table t1(id int primary key, n1 int, n2 int, s varchar(20), vs varchar(20), t varchar(256));
insert into t1 values (0, NULL, NULL, 'zero', 'zero', 'zero'), (1, 1, 11, 'one', 'eleven', 'eleven'), (2, 1, 11, 'one', 'eleven', 'eleven'), (3, 2, 11, 'two', 'eleven', 'eleven'), (4, 2, 12, 'two', 'twevle', 'twelve'), (5, 2, 13, 'two', 'thirteen', 'foo'), (6, 2, 13, 'two', 'thirteen', 'foo'), (7, 2, 13, 'two', 'thirteen', 'bar'), (8, NULL, 13, 'two', 'thirteen', 'bar'), (9, 2, NULL, 'two', 'thirteen', 'bar'), (10, 2, 13, NULL, 'thirteen', 'bar'), (11, 2, 13, 'two', NULL, 'bar'), (12, 2, 13, 'two', 'thirteen', NULL);
select n1,n2 from t1;
select count(distinct n1), count(distinct n2) from t1;
select count(n1), count(distinct n1), count(n2), count(distinct n2) from t1;
select count(distinct n1), count(distinct n2), count(n1), count(n2) from t1;


###2-2：在range分区规则下，验证count(distinct)
#do sql
--real_sleep 3
drop table if exists t1;
create table t1(id int primary key, n1 int, n2 int, s varchar(20), vs varchar(20), t varchar(256)) partition by range(id)(partition r0 values less than(5), partition r1 values less than(10), partition r2 values less than maxvalue);
--real_sleep 5
insert into t1 values (0, NULL, NULL, 'zero', 'zero', 'zero'), (1, 1, 11, 'one', 'eleven', 'eleven'), (2, 1, 11, 'one', 'eleven', 'eleven'), (3, 2, 11, 'two', 'eleven', 'eleven'), (4, 2, 12, 'two', 'twevle', 'twelve'), (5, 2, 13, 'two', 'thirteen', 'foo'), (6, 2, 13, 'two', 'thirteen', 'foo'), (7, 2, 13, 'two', 'thirteen', 'bar'), (8, NULL, 13, 'two', 'thirteen', 'bar'), (9, 2, NULL, 'two', 'thirteen', 'bar'), (10, 2, 13, NULL, 'thirteen', 'bar'), (11, 2, 13, 'two', NULL, 'bar'), (12, 2, 13, 'two', 'thirteen', NULL);
--real_sleep 5
select n1,n2 from t1;
select count(distinct n1), count(distinct n2) from t1;
select count(n1), count(distinct n1), count(n2), count(distinct n2) from t1;
select count(distinct n1), count(distinct n2), count(n1), count(n2) from t1;
drop table t1;


###2-3：在hash分区规则下，验证count(distinct)
#do sql
--real_sleep 3
drop table if exists t1;
--error 5077
drop partition function h1;
create hash partition function h1(x)'x+1';
create table t1(id int primary key, n1 int, n2 int, s varchar(20), vs varchar(20), t varchar(256))partition by(hs,h1,id);
--real_sleep 3
insert into t1 values (0, NULL, NULL, 'zero', 'zero', 'zero'), (1, 1, 11, 'one', 'eleven', 'eleven'), (2, 1, 11, 'one', 'eleven', 'eleven'), (3, 2, 11, 'two', 'eleven', 'eleven'), (4, 2, 12, 'two', 'twevle', 'twelve'), (5, 2, 13, 'two', 'thirteen', 'foo'), (6, 2, 13, 'two', 'thirteen', 'foo'), (7, 2, 13, 'two', 'thirteen', 'bar'), (8, NULL, 13, 'two', 'thirteen', 'bar'), (9, 2, NULL, 'two', 'thirteen', 'bar'), (10, 2, 13, NULL, 'thirteen', 'bar'), (11, 2, 13, 'two', NULL, 'bar'), (12, 2, 13, 'two', 'thirteen', NULL);
--real_sleep 5
select n1,n2 from t1;
select count(distinct n1), count(distinct n2) from t1;
select count(n1), count(distinct n1), count(n2), count(distinct n2) from t1;
select count(distinct n1), count(distinct n2), count(n1), count(n2) from t1;
drop table t1;
--real_sleep 1
drop partition function h1;


###///新添测试项///###
###2-x:(新增测试项说明)
#do sql
########################################################################################################
