####################################必填######################################################
###1.测试功能点：在不同分区规则表中使用prepare执行replace操作
##
#
###2.测试项：(每新添一测试项，需在添加前注明测试项，注释填写在新添sq1前，不填在此处，如下样例）
###3.问题网址：xxx
###4.问题号：xxx
###5.预计运行时间：xxx
###6.编写/修改人：zhuyinying
###7.编写/修改日期：2020-01-13
###8.其他（选填）：case格式规范化修改
###
##
#
##############################################################################################

#####################################Do sql###################################################
--disable_warnings
drop table if exists t1,t2,t3,t4; 
--enable_warnings

###2-1：range分区表中使用prepare执行replace操作
create table t1(i1 int,f1 float,s1 varchar(30),d1 datetime,i2 int,f2 float,s2 varchar(30),d2 datetime,primary key(i1,f1,s1,d1))partition by range(i1)(partition r0 values less than(5),partition r1 values less than(10),partition r2 values less than maxvalue);
--real_sleep 5
prepare stmt_replace from replace into t1 values(?,?,?,?,?,?,?,?);
--let $l=10
while($l)
{
	eval set @i1=$l;
	eval set @f1=$l.5;
	eval set @s1='abcdefg';
	eval set @d1=timestamp'2020-02-02 20:00:00';
	dec $l;
	eval set @i2=$l;
	eval set @f2=$l.5;
	eval set @s2='abcdefgh';
	eval set @d2=timestamp'2020-02-01 20:00:00';
	execute stmt_replace using @i1,@f1,@s1,@d1,@i2,@f2,@s2,@d2;
}
select * from t1;
drop table t1;


create table t1(i1 int,f1 float,s1 varchar(30),d1 datetime,i2 int,f2 float,s2 varchar(30),d2 datetime,primary key(i1,f1,s1,d1))partition by range(i1)(partition r0 values less than(5),partition r1 values less than(10),partition r2 values less than(15),partition r3 values less than maxvalue);
--real_sleep 5
prepare stmt_replace_i1 from replace into t1 values(1,?,?,?,?,?,?,?);
--let $l=10
while($l)
{
	eval set @f1=$l.5;
	eval set @s1='abcdefg';
	eval set @d1=timestamp'2020-02-02 20:00:00';
	dec $l;
	eval set @i2=$l;
	eval set @f2=$l.5;
	eval set @s2='abcdefgh';
	eval set @d2=timestamp'2020-02-01 20:00:00';
	execute stmt_replace_i1 using @f1,@s1,@d1,@i2,@f2,@s2,@d2;
}
select * from t1;
drop table t1;


###2-2:list分区表中使用prepare执行insert操作
create table t1(i1 int,f1 float,s1 varchar(30),d1 datetime,i2 int,f2 float,s2 varchar(30),d2 datetime,primary key(i1,f1,s1,d1))partition by list(i1)(partition q0 values in(1,3,7,9,10),partition q1 values in(2,4,5,6,8));
--real_sleep 5
prepare stmt_replace_f1 from replace into t1 values(?,1.5,?,?,?,?,?,?);
--let $l=10
while($l)
{
	eval set @i1=$l;
	eval set @s1='abcdefg';
	eval set @d1=timestamp'2020-02-02 20:00:00';
	dec $l;
	eval set @i2=$l;
	eval set @f2=$l.5;
	eval set @s2='abcdefgh';
	eval set @d2=timestamp'2020-02-01 20:00:00';
	execute stmt_replace_f1 using @i1,@s1,@d1,@i2,@f2,@s2,@d2;
}
select * from t1;
drop table t1;


###2-3:enum分区表中的prepare执行insert操作
--error 5077
drop partition function e;
create enum partition function e(x) '[(1)],[(6)],[(2)],[(5)],[(3)],[(4)],[(7)],[(8)],[(9)],[(10)]';

create table t2(i1 int,f1 float,s1 varchar(30),d1 datetime,i2 int,f2 float,s2 varchar(30),d2 datetime,primary key(i1,f1,s1,d1))partition by(em,e,i1);
--real_sleep 5
prepare stmt_insert_s1 from replace into t2 values(?,?,'abcdefg',?,?,?,?,?);
--let $l=10
while($l)
{
	eval set @i1=$l;
	eval set @f1=$l.5;
	eval set @s1='abcdefg';
	eval set @d1=timestamp'2020-02-02 20:00:00';
	dec $l;
	eval set @i2=$l;
	eval set @f2=$l.5;
	eval set @s2='abcdefgh';
	eval set @d2=timestamp'2020-02-01 20:00:00';
	execute stmt_insert_s1 using @i1,@f1,@d1,@i2,@f2,@s2,@d2;
}
select * from t2;
drop table t2;


###2-4:hash分区表中使用prepare执行insert操作
--error 5077
drop partition function h;
create hash partition function h(x) 'x+1';

create table t1(i1 int,f1 float,s1 varchar(30),d1 datetime,i2 int,f2 float,s2 varchar(30),d2 datetime,primary key(i1,f1,s1,d1))partition by(hs,h,i1);
--real_sleep 5
prepare stmt_replace_d1 from replace into t1 values(?,?,?,'2012-01-01 00:00:00',?,?,?,?);
--let $l=10
while($l)
{
	eval set @i1=$l;
	eval set @f1=$l.5;
	eval set @s1='abcdefg';
	eval set @d1=timestamp'2020-02-02 20:00:00';
	dec $l;
	eval set @i2=$l;
	eval set @f2=$l.5;
	eval set @s2='abcdefgh';
	eval set @d2=timestamp'2020-02-01 20:00:00';
	execute stmt_replace_d1 using @i1,@f1,@s1,@i2,@f2,@s2,@d2;
}
select * from t1;
drop table t1;


create table t1(i1 int,f1 float,s1 varchar(30),d1 datetime,i2 int,f2 float,s2 varchar(30),d2 datetime,primary key(i1,f1,s1,d1))partition by range(i1)(partition r0 values less than(5),partition r1 values less than(10),partition r2 values less than maxvalue);
--real_sleep 5
prepare stmt_replace_rowkey from replace into t1 values(10000,10000.5,'10000-abcdefg','2012-01-01 00:00:00',?,?,?,?);
--let $l=10
while($l)
{
	eval set @i1=$l;
	eval set @f1=$l.5;
	eval set @s1='abcdefg';
	eval set @d1=timestamp'2020-02-02 20:00:00';
	dec $l;
	eval set @i2=$l;
	eval set @f2=$l.5;
	eval set @s2='abcdefgh';
	eval set @d2=timestamp'2020-02-01 20:00:00';
	execute stmt_replace_rowkey using @i2,@f2,@s2,@d2;
}
select * from t1;
drop table t1; 


###///新添测试项///###
###2-x:(新增测试项说明)
#do sql
########################################################################################################























































































































































































































































































































































































































































































































































































































































































