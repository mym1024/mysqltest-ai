###########################################################################################
###1.测试功能点：partition_enum：带select的批量插入
##
#
###2.测试项：（每新添一测试项,需在添加前注明测试项,注释填写在新添sql前,不填在此处,如下样例）
###2.问题网址：xxx
###3.问题号：xxx
###4.预计运行时间：663.766943.s
###5.编写/修改人：lyy
###6.编写/修改日期：2019-11-01
###7.其它（选填）：case格式规范化修改
###
##
#
###########################################################################################

####################################Do sql######################################################
###2-1：单主键：distinct
--disable_warnings
drop table if exists t1,t2;
--error 5077
drop partition function e;
--enable_warnings
create enum partition function e(x)'[(1)],[(2)],[(3)],[(4)],[(5)],[(6)],[(7)],[(8)],[(9)],[(10)],[(11)],[(12)],[(13)],[(14)],[(15)]';
create table t1 (c1 int primary key ,c2 int ,c3 real) partition by(em,e,c1);
create table t2 (c1 int primary key, c2 int ,c3 varchar(30)) partition by(em,e,c1);
--real_sleep 8
insert into t2 values(1,1,'haha'),(2,1,'haha'),(3,1,'haha'),(4,1,'haha'),(5,1,'haha'),(6,1,'haha'),(7,1,'haha');
# --error 5024 -linf
--sleep 5
--error 119
insert into t1 select distinct c2 ,c1,c3 from t2;
--real_sleep 8
insert into t2 values(8,4,'mkoe');
--real_sleep 8
insert into t1 select c1 as grimp,c2 as tendency,c2 from t2 where c1=8;
--real_sleep 8
insert into t2 values (9,4,'mkoe'),(10,4,'mkoe'),(11,4,'mkoe'),(12,4,'mkoe'),(13,4,'mkoe');
--real_sleep 20
#--error 5047
insert into t1 select * from t2 where c1>8 limit 3;
--real_sleep 8
insert into t1 select * from t2 as t where c1=13;
--real_sleep 8
insert into t2 values(15,3,'maosy');

insert into t2 values(14,4,'linf');

# --error 7 -linf
--error 119
insert into t1 select * from t2 where c1=15 for update;
--real_sleep 15
select * from t1;
--real_sleep 8
select * from t2;
show partition groups;

###2-2:单主键：order by
--disable_warnings
drop table if exists t1,t2;
--error 5077
drop partition function e2;
create enum partition function e2(x)'[(1)],[(2)],[(3)],[(4)],[(5)],[(6)],[(7)],[(8)]';
--enable_warnings
create table t1 (c1 int primary key ,c2 int ,c3 real) partition by(em,e2,c1);
create table t2 (c1 int primary key, c2 int ,c3 varchar(30)) partition by(em,e2,c1);
--real_sleep 8
insert into t2 values(1,2,'mdetg'),(2,4,'mdetg'),(3,1,'mdetg'),(4,7,'mdetg'),(5,8,'mdetg'),(6,6,'mdetg'),(7,3,'mdetg');

--error 5702
insert into t2 values(9,4,'linf');
#--error 119
--real_sleep 8
insert into t1 select c2,c1,c3 from t2 order by (c2);
--real_sleep 8
select * from t1;
--real_sleep 8
select * from t2;
show partition groups;

###2-3:单主键：inner join
--disable_warnings
drop table if exists t1,t2,t3;
--error 5077
drop partition function e3;
create enum partition function e3(x)'[(1)],[(2)],[(3)],[(4)],[(5)],[(6)],[(7)]';
--enable_warnings
create table t1 (c1 int primary key ,c2 int ,c3 real) partition by(em,e3,c1);
create table t2 (c1 int primary key, c2 int ,c3 varchar(30)) partition by(em,e3,c1);
create table t3 (c1 int primary key, c2 int ,c3 varchar(30)) partition by(em,e3,c1);
--real_sleep 8
insert into t2 values(1,2,'mdetg'),(2,4,'qdetg'),(3,1,'rdetg'),(4,7,'ydetg'),(5,8,'wdetg'),(6,6,'mdetg'),(7,3,'mdetg');
--real_sleep 8
insert into t3 values(1,2,'mid'),(3,1,'rdetg');
--real_sleep 8
insert into t1 select t2.c1,t2.c2 ,t3.c2 from t2 inner join t3 on t2.c2=t3.c2 ;

--error 5702
insert into t2 values(8,4,'linf');

select * from t1;
--real_sleep 8
select * from t2;
--real_sleep 8
select * from t3;
show partition groups;

###2-4:单主键：left join
--disable_warnings
drop table if exists t1,t2;
--error 5077
drop partition function e4;
create enum partition function e4(x)'[(1)],[(2)],[(3)],[(4)],[(5)],[(6)],[(7)]';
--enable_warnings
create table t1 (c1 int primary key ,c2 int ,c3 real) partition by(em,e4,c1);
create table t2 (c1 int primary key, c2 int ,c3 varchar(30)) partition by(em,e4,c1);
--real_sleep 8
insert into t2 values(1,2,'mdetg'),(2,4,'qdetg'),(3,1,'rdetg'),(4,7,'ydetg'),(5,8,'wdetg'),(6,6,'mdetg'),(7,3,'mdetg');
--real_sleep 8
#--error 5047
insert into t1 select t2.c1,t2.c2 ,t2.c2 from t2 left join t1 on t2.c2=t1.c2 ;
--real_sleep 8

--error 5702
insert into t2 values(8,4,'linf');
--real_sleep 8

select * from t1;
--real_sleep 8
select * from t2;
show partition groups;

###2-5：单主键：union
--disable_warnings
drop table if exists t1,t2,t3;
--error 5077
drop partition function e5;
create enum partition function e5(x)'[(1)],[(2)],[(3)],[(4)],[(5)],[(6)],[(7)]';
--enable_warnings
create table t1 (c1 int primary key ,c2 int ,c3 real) partition by(em,e5,c1);
create table t2 (c1 int primary key, c2 int ,c3 varchar(30)) partition by(em,e5,c1);
create table t3 (c1 int primary key, c2 int ,c3 varchar(30)) partition by(em,e5,c1);
--real_sleep 8
insert into t2 values(1,2,'mdetg'),(2,4,'qdetg'),(3,1,'rdetg'),(4,7,'ydetg'),(5,8,'wdetg'),(6,6,'mdetg'),(7,3,'mdetg');
--real_sleep 8
insert into t3 values(1,2,'mid'),(3,1,'rdetg');

--error 5702
insert into t2 values(8,4,'linf');

#--error 6
insert into t1(c1,c2) select c1,c2 from t2 union select c1,c2 from t3 ;
--real_sleep 8
select * from t1;
--real_sleep 8
select * from t2;
--real_sleep 8
select * from t3;
show partition groups;

###2-6：单主键：except
--disable_warnings
drop table if exists t1;
--error 5077
drop partition function e6;
create enum partition function e6(x)'[(1)],[(2)],[(3)],[(4)],[(5)],[(6)],[(7)]';
--enable_warnings
create table t1 (c1 int primary key ,c2 int ,c3 real) partition by(em,e6,c1);
--real_sleep 8
insert into t1(c1,c2) select c1,c2 from t2 except select c1,c2 from t3 ;

--error 5702
insert into t2 values(8,4,'linf');
--real_sleep 8

select * from t1;
show partition groups;

###2-6:单主键：intersect
--disable_warnings
drop table if exists t1;
--error 5077
drop partition function e7;
create enum partition function e7(x)'[(1)],[(2)],[(3)],[(4)],[(5)],[(6)],[(7)]';
--enable_warnings
create table t1 (c1 int primary key ,c2 int ,c3 real) partition by(em,e7,c1);
--real_sleep 8
insert into t1(c1,c2) select c1,c2 from t2 intersect select c1,c2 from t3 ;
--real_sleep 8
select * from t1;
show partition groups;

###2-7:单主键：not in/in
--disable_warnings
drop table if exists t1;
--error 5077
drop partition function e8;
create enum partition function e8(x)'[(1)],[(2)],[(3)],[(4)],[(5)],[(6)],[(7)]';
--enable_warnings
create table t1 (c1 int primary key ,c2 int ,c3 real) partition by(em,e8,c1);
# --error 65535 -linf
--real_sleep 8
insert into t1(c1,c2) select c1,c2 from t2 where c1 in (select c1 from t3);
# --error 65535 -linf
insert into t1(c1,c2) select c1,c2 from t2 where c1 not in (select c1 from t1);
--real_sleep 8
select * from t1;
show partition groups;


###///新添测试项///###
###2-8：单主键： join
#do sql
##############################################################################################

--disable_warnings
drop table if exists t1,t2,t3;
--error 5077
drop partition function e9;
create enum partition function e9(x)'[(1)],[(2)],[(3)],[(4)],[(5)],[(6)],[(7)]';
--enable_warnings
create table t1 (c1 int primary key ,c2 int ,c3 real) partition by(em,e9,c1);
create table t2 (c1 int primary key, c2 int ,c3 varchar(30)) partition by(em,e9,c1);
create table t3 (c1 int primary key, c2 int ,c3 varchar(30)) partition by(em,e9,c1);
--real_sleep 8
insert into t2 values(1,2,'mdetg'),(2,4,'qdetg'),(3,1,'rdetg'),(4,7,'ydetg'),(5,8,'wdetg'),(6,6,'mdetg'),(7,3,'mdetg');
--real_sleep 8
insert into t3 values(1,2,'mid'),(3,1,'rdetg');
--real_sleep 8
insert into t1 select t2.c1,t2.c2 ,t3.c2 from t2 join t3 on t2.c2=t3.c2 ;
--real_sleep 8

--error 5702
insert into t2 values(8,4,'linf');
--real_sleep 8

select * from t1;
--real_sleep 8
select * from t2;
--real_sleep 8
select * from t3;
--real_sleep 8
show partition groups;
