--source merge.sql
####################################必填######################################################
###1.测试功能点：range分区,有空行记录的合并
##
#
###2.测试项：(每新添一测试项，需在添加前注明测试项，注释填写在新添sq1前，不填在此处，如下样例）
###3.问题网址：xxx
###4.问题号：xxx
###5.预计运行时间：xxx
###6.编写/修改人：zhuyinying
###7.编写/修改日期：2019-12-18
###8.其他（选填）：case格式规范化修改
###
##
#
##############################################################################################

#####################################Do sql###################################################
--disable_warnings
drop table if exists t1,t2,t3;
alter system set min_drop_cache_wait_time='10s' server_type=yaodatasvr;
alter system set each_tablet_sync_meta=False server_type=yaodatasvr;

###2-1:range分区，有空行记录的合并
create table t1(i1 int, s1 char(30), d1 datetime,i2 int,primary key (i1,s1,d1)) partition by range columns(i1,s1)(partition rr0 values less than(2,'b'),partition rr1 values less than(4,'a'), partition rr2 values less than (maxvalue,maxvalue));
--echo "refesh_schema"
exec $LOCAL_DIR/tools/as_admin -r $RS0_IP -p $RS0_PORT refresh_schema |tail -1;
--real_sleep 12
insert into t1 values(NULL,'s1','2013-1-25',1);
insert into t1 values(1,NULL,'2013-1-25',1);
insert into t1 values(1,'s1',NULL,1);
insert into t1 values(NULL,'s1',NULL,1);
insert into t1 values(NULL,NULL,'2013-1-25',1);
insert into t1 values(1,NULL,NULL,1);
insert into t1 values(NULL,NULL,NULL,1);
insert into t1 values(NULL,NULL,'2013-1-26',1);
--error 5024
insert into t1 values(NULL,NULL,NULL,NULL);

update t1 set i2=1 where i1 is NULL and s1 is NULL;
update t1 set i2=1 where i1 is NULL and s1 is NULL and d1 is NULL;

delete from t1 where i1 is NULL and s1 is NULL and d1 is NULL;
delete from t1 where i1 is NULL and s1='s1' and d1 is NULL;
delete from t1 where i1=1 and s1='s1' and d1 is NULL;
insert into t1 values(NULL,NULL,NULL,NULL);
insert into t1 values(NULL,'s1',NULL,NULL);
select * from t1;
exec $LOCAL_DIR/tools/as_admin -r $RS0_IP -p $RS0_PORT major_freeze |tail -1;
select * from t1;
--real_sleep 300
select * from t1;
--error 5024
insert into t1 values(NULL,NULL,NULL,NULL);
--error 5024
insert into t1 values(NULL,'s1',NULL,NULL);
insert into t1 values(1,'s1',NULL,NULL);
select * from t1;
drop table t1;

###///新添测试项///###
###2-x:(新增测试项说明)
#do sql
########################################################################################################
