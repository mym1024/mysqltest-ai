--source merge.sql
####################################必填######################################################
###1.测试功能点：update表中的一行记录和insert语句插入值个数与预期不符合返回值错误
##
#
###2.测试项：(每新添一测试项，需在添加前注明测试项，注释填写在新添sq1前，不填在此处，如下样例）
###3.问题网址：http://182.119.80.93/cbase_dev/cbase/issues/365
###4.问题号：365
###5.预计运行时间：0.09s
###6.编写/修改人：pantong
###7.编写/修改日期：2019-11-15
###8.其他（选填）：新编case
###
##
#
##############################################################################################

#####################################Do sql###################################################
--disable_warnings
drop table if exists t1;
--enable_warnings


###2-1：更新表中单条记录，改行中有主键值为null，数据中，insert插入列与values后的个数不符
#do sql
--disable_warnings
drop table if exists t1,t2;
--enable_warnings

create table t1(c1 int auto_increment, c2 int, primary key(c1));
--error 5007
insert into t1 values(NULL),(NULL);
--error 5024
insert into t1 values(NULL,1),(NULL,2);
--error 5007
insert into t1 values(1,2,3);
insert into t1 values(null,2);
update t1 set c2=3 where c1=null;
update t1 set c2=2 where c1=1;
select * from t1;
drop table t1;


###2-2：更新表中单条记录
#do sql
create table t1(c1 int primary key, c2 int);
insert into t1 values(1,1),(2,2);
update t1 set c2=0 where c1=1;
select * from t1;
update t1 set c2=0 where c1=2 and c2=1;
select * from t1;
update t1 set c2=0 where c1=2 and c2=2;
select * from t1;
drop table t1;

create table t1(c1 varchar(30) primary key, c2 varchar(30));
insert into t1 values(1,1),(2,2);
update t1 set c2=0 where c1=1;
select * from t1;
update t1 set c2=0 where c1=2 and c2=1;
select * from t1;
update t1 set c2=0 where c1=2 and c2=2;
select * from t1;
drop table t1;

create table t1(c1 int primary key, c2 int, c3 int);
insert into t1 values(1,1,1),(2,1,1),(3,NULL,NULL),(4,1,1);
update t1 set c2=0 where c1=1;
update t1 set c2=2 where c1=1 and c2=0;
update t1 set c2=3 where c1=1 and c2=0;
update t1 set c2=0 where c1=2 or c2=1;
update t1 set c2=0 where c1=2 and c2=1;
update t1 set c2=0 where c1=3 and c2=NULL;
update t1 set c2=0 where c1=3 and c2 is NULL;
update t1 set c2=NULL where c1=3 and c2=0;
update t1 set c2=0 where c1=4 and (c2=2 or c2=3);
update t1 set c2=0 where c1=4 and (c2=2 or c2=1);
update t1 set c2=10 where c1=4 and (c2=2 or c2=0);
select * from t1;
drop table t1;


###2-3：insert...select...时值与列个数不符
#do sql
create table t1(c1 int primary key,c2 int,c3 int);
insert into t1 values(1,2,3);
--error 5007
insert into t1 values(1,2);
--error 5007
insert into t1(c1,c2) values(3);
create table t2(c1 int primary key,c2 int,c3 int);
insert into t2 values(5,6,7);
--error 5007
insert into t1 select c1,c3 from t2;


###///新添测试项///###
###2-x:(新增测试项说明)
#do sql
########################################################################################################
