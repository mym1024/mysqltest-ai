####################################必填######################################################
###1.测试功能点：指定不同的分区表，bloomfilter_join与merge_join的使用
##
#
###2.测试项：
###3.问题网址：xxx
###4.问题号：xxx
###5.预计运行时间：96 s
###6.编写/修改人：machen
###7.编写/修改日期：2019-11-28
###8.其他（选填）：
###
##
#
##############################################################################################

#####################################Do sql###################################################
create database b;
using database b;
sleep 5;
--disable_warnings
drop table if exists persons,orders,t2,t3;
--error 5077
drop partition function h1,e1;
--enable_warnings



create hash partition function h1(x)'x+2';
create table persons (id_p int primary key, lastname varchar(20), firstname varchar(20), address varchar(20), city varchar(20)) partition by(per1,h1,id_p);
--real_sleep 3
insert into persons values(1,'a','a1','a2', 'a3');
insert into persons values(2,'b','b1','b2', 'b3');
insert into persons values(3,'c','c1','c2', 'c3');


create table orders(id_o int primary key, orderno int, id_p int) partition by range(id_o)(partition or1 values less than(3),partition  or2 values less than(6),partition or3 values less than maxvalue);
--real_sleep 3
insert into orders values(1,1111,3);
insert into orders values(2,2222,3);
insert into orders values(3,3333,1);
insert into orders values(4,4444,1);
insert into orders values(5,5555,65);

create enum partition function e1(x)'[(3)],[(4)],[(5)]';
create table t2 (
  id int,
  category int,
  county int,
  state int,
  phones int,
  nophones int,
  primary key (id)
) partition by(ta1,e1,id);
--real_sleep 3
insert into t2 values (3,2,11,12,5400,7800);
insert into t2 values (4,2,25,12,6500,11200);
insert into t2 values (5,1,37,6,10000,12000);

create table t3 (
  id int,
  name varchar(255) default NULL,
  primary key (id)
) partition by list(id)(partition ta1 values in(1,3,4),partition ta2 values in(2,5));
--real_sleep 3
insert into t3 values(1,'s1'),(2,'s2'),(3,'s3'),(4,'s4'),(5,'s5');
select /*+ join(bloomfilter_join) */ * from persons,t2,t3 where persons.id_p=t2.id and t2.id=t3.id and t2.id>(select /*+ join(bloomfilter_join) */ persons.id_p from persons,orders where persons.id_p=orders.id_o and persons.id_p=2) ;
select /*+ join(merge_join) */ * from persons,t2,t3 where persons.id_p=t2.id and t2.id=t3.id and t2.id>(select /*+ join(bloomfilter_join) */ persons.id_p from persons,orders where persons.id_p=orders.id_o and persons.id_p=2) ;

select /*+ join(bloomfilter_join) */ * from persons,t2,t3 where persons.id_p=t2.id and t2.id=t3.id and t2.id>(select persons.id_p from persons where persons.id_p=2) ;
select /*+ join(merge_join) */ * from persons,t2,t3 where persons.id_p=t2.id and t2.id=t3.id and t2.id>(select persons.id_p from persons where persons.id_p=2) ;

drop table orders,persons,t2,t3;
drop partition function h1,e1;
###///新添测试项///###
###2-x:(新增测试项说明)
#do sql
########################################################################################################
