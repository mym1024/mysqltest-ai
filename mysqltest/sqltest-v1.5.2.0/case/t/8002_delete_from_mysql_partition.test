####################################必填######################################################
###1.测试功能点：有分区时delete功能的测试
##
#
###2.测试项：(每新添一测试项，需在添加前注明测试项，注释填写在新添sq1前，不填在此处，如下样例）
###3.问题网址：xxx
###4.问题号：xxx
###5.预计运行时间：xxx
###6.编写/修改人：zhuyinying
###7.编写/修改日期：2019-12-18
###8.其他（选填）：case格式规范化修改
###
##
#
##############################################################################################

#####################################Do sql###################################################

###2-1：range分区时从表中删除数据

--disable_warnings
drop table if exists t1,t2,t3,t11,t12;
--real_sleep 3
--enable_warnings
create table t1 (a int, b int, c int,primary key(a,b))partition by range columns(a,b)(partition r1 values less than (1,2),partition r2 values less than (2,3),partition r3 values less than(maxvalue,maxvalue));
exec $LOCAL_DIR/tools/as_admin -r $RS0_IP -p $RS0_PORT refresh_schema | tail -1;
--real_sleep 3
insert into t1 values (1,1,0);
insert into t1 values (1,2,0);
insert into t1 values (1,3,0);
delete from t1 where a=1 and b=1;

insert into t1 values (1,1,0);
delete from t1 where a=1 and b=1;
delete from t1 where a=1 and b=2;
delete from t1 where a=1 and b=3;
insert into t1 values (1,2,0);
delete from t1 where a=1 and b=2;
insert into t1 values (1,2,0);
delete from t1 where a=1 and b=2;
drop table t1;
--real_sleep 3
###2-2：哈希分区时从表中删除主键外全为默认值的数据
create hash partition function h1(x)'x*3+4';
create table t1(
    a bigint not null,
	b bigint not null default 0,
	c bigint not null default 0,
	d bigint not null default 0,
	e bigint not null default 0,
	f bigint not null default 0,
	g bigint not null default 0,
	h bigint not null default 0,
	i bigint not null default 0,
	j bigint not null default 0,
	primary key (a)) partition by(ha1,h1,a);
exec $LOCAL_DIR/tools/as_admin -r $RS0_IP -p $RS0_PORT refresh_schema | tail -1;
--real_sleep 3
insert into t1 (a) values (2),(4),(6),(8),(10),(12),(14),(16),(18),(20),(22),(24),(26),(23);
--real_sleep 5
delete from t1 where a=26;
drop table t1;
drop partition function h1;
--real_sleep 3

###2-3：哈希分区时以NULL值为过滤条件删除
--error 5077
drop partition function h2;
create hash partition function h2(x)'x*2/4+7'; 
create table t1(
  bool1 char (0) default NULL,
  not_null varchar (20) NOT NULL default '',
  misc integer not null,
  primary key (not_null))partition by (ta1,h2,not_null);
exec $LOCAL_DIR/tools/as_admin -r $RS0_PORT refresh_schema | tail -1;
--real_sleep 3
insert into t1 values (NULL ,'a',4),(NULL ,'b',5),(NULL ,'c',6),(NULL ,'d',7);

select * from t1 where misc > 5 and bool1 is null;
delete from t1 where not_null='c';
delete from t1 where not_null='d';
select * from t1 where misc > 5 and bool1 is null;
  
select count(*) from t1;
select count(*) from t1;
select count(*) from t1;
drop table  t1;
--real_sleep 3
drop partition function h2;
--real_sleep 3 
  
  

###///新添测试项///###
###2-x:(新增测试项说明)
#do sql
########################################################################################################
