--source merge.sql
##############################################################################################
###1.测试功能点：非主键update，更新数据
##
#
###2.测试项：(每新添一测试项，需在添加前注明测试项，注释填写在新添sq1前，不填在此处，如下样例）
###3.问题网址：xxx
###4.问题号：xxx
###5.预计运行时间：1009s
###6.编写/修改人：zhuyinying
###7.编写/修改日期：2019-10-11
###8.其他（选填）：case格式规范化修改
###
##
#
##############################################################################################

#####################################Do sql###################################################
alter system set balance_max_concurrent_migrate_num=30 server_type=yaoadminsvr;
alter system set balance_max_migrate_in_per_ds=6 server_type=yaoadminsvr;
alter system set balance_max_migrate_out_per_ds=6 server_type=yaoadminsvr;
alter system set max_migrate_task_count=6 server_type=yaodatasvr;

--disable_warnings
drop table if exists t1,t2;
--enable_warnings
--disable_query_log
--enable_query_log

set global yao_query_timeout=30000000;
create table t1(c1 int,c2 decimal(3,2),c3 double,c4 datetime,c5 bool,c6 real,c7 varchar(20),c8 decimal(4,3),c9 int,primary key(c1,c2));
insert into t1 values(1,1.23,1.234587,'2015-05-05 12:00:00',1,1.2324,'subeima',3.125,1),(2,1.23,1.234587,'2015-05-05 12:00:00',1,1.2334324,'su2343a',1.659,5),(3,1.21,1.2345344,'2085-02-28 18:00:00',1,1.2324,'hellokitty',5.987,2);
select * from t1;
create index index0 on t1(c6,c3,c8) storing(c9,c5,c4);
create index index1 on t1(c4,c9,c2,c6,c5);
create index index2 on t1(c8,c2,c3,c1) storing(c9,c5,c6,c4);
create index index3 on t1(c6,c9,c1,c3) storing(c7,c5,c8);
create index index4 on t1(c8,c3,c6,c2) storing(c4,c7,c5);

--echo "merge"
exec $LOCAL_DIR/tools/as_admin -r $RS0_IP -p $RS0_PORT major_freeze | tail -1;
--real_sleep 800
exec $LOCAL_DIR/tools/as_admin -r $RS0_IP -p $RS0_PORT stat -o merge | tail -1;

show index on t1;
let $n=query_get_value(select table_id from __first_tablet_entry where table_name='t1',table_id,1);
--let $table_head =__
--let $table_end =__idx__index0
--let $table_name=$table_head$n$table_end
echo $table_name;
eval select * from $table_name;

--let $table_end1 =__idx__index1
--let $table_name1=$table_head$n$table_end1
eval select * from $table_name1;

--let $table_end2 =__idx__index2
--let $table_name2=$table_head$n$table_end2
eval select * from $table_name2;

--let $table_end3 =__idx__index3
--let $table_name3=$table_head$n$table_end3
eval select * from $table_name3;

--let $table_end4 =__idx__index4
--let $table_name4=$table_head$n$table_end4
eval select * from $table_name4;


###2-1:修改非主键、int类型
update t1 set c9=12 where c1=1 and c2=1.23;
select * from t1;
eval select * from $table_name;
eval select * from $table_name1;
eval select * from $table_name2;
eval select * from $table_name3;
eval select * from $table_name4;

###2-2:修改非主键datetime类型
update t1 set c4='5045-01-08 15:00:55' where c1=1 and c2=1.23;
select * from t1;
eval select * from $table_name;
eval select * from $table_name1;
eval select * from $table_name2;
eval select * from $table_name3;
eval select * from $table_name4;

###2-3:修改非主键decimal类型
update t1 set c8=1.1 where c1=1 and c2=1.23;
select * from t1;
eval select * from $table_name;
eval select * from $table_name1;
eval select * from $table_name2;
eval select * from $table_name3;
eval select * from $table_name4;

###2-4:修改非主键varchar类型
update t1 set c7='ontime' where c1=1 and c2=1.23;
select * from t1;
eval select * from $table_name;
eval select * from $table_name1;
eval select * from $table_name2;
eval select * from $table_name3;
eval select * from $table_name4;

###2-5:修改非主键double type
update t1 set c3=1.5698 where c1=1 and c2=1.23;
select * from t1;
eval select * from $table_name;
eval select * from $table_name1;
eval select * from $table_name2;
eval select * from $table_name3;
eval select * from $table_name4;

###2-6:修改非主键int类型,加之计算式，calculate primary key
update t1 set c9=7*8 where c1=2 and c2=1.23;
select * from t1;
eval select * from $table_name;
eval select * from $table_name1;
eval select * from $table_name2;
eval select * from $table_name3;
eval select * from $table_name4;

###2-7:修改非主键double类型,加之计算式，calculate index cloumn
update t1 set c3=1.235*12.54 where c1=2 and c2=1.23;
select * from t1;
eval select * from $table_name;
eval select * from $table_name1;
eval select * from $table_name2;
eval select * from $table_name3;
eval select * from $table_name4;

###2-8:修改非主键real类型,加之计算式，calculate storing column
update t1 set c6=8/15.28 where c1=2 and c2=1.23;
select * from t1;
eval select * from $table_name;
eval select * from $table_name1;
eval select * from $table_name2;
eval select * from $table_name3;
eval select * from $table_name4;

###2-9:修改非主键decimal类型,加之计算式，calculate decimal column
update t1 set c8=5/9 where c1=2 and c2=1.23;
select * from t1;
eval select * from $table_name;
eval select * from $table_name1;
eval select * from $table_name2;
eval select * from $table_name3;
eval select * from $table_name4;

###2-10:修改修改非主键int类型,加之计算式，column+number primary key
update t1 set c9=c1+8 where c1=3 and c2=1.21;
select * from t1;
eval select * from $table_name;
eval select * from $table_name1;
eval select * from $table_name2;
eval select * from $table_name3;
eval select * from $table_name4;

###2-11:修改非主键decimal类型,加之计算式
--error 58
update t1 set c8=c2+18 where c1=3 and c2=1.21;
select * from t1;
eval select * from $table_name;
eval select * from $table_name1;
eval select * from $table_name2;
eval select * from $table_name3;
eval select * from $table_name4;

###2-12:修改非主键double类型,加之计算式
update t1 set c6=c3*5.396 where c1=3 and c2=1.21;
select * from t1;
eval select * from $table_name;
eval select * from $table_name1;
eval select * from $table_name2;
eval select * from $table_name3;
eval select * from $table_name4;

###2-13:同时修改非主键int和double类型
update t1 set c9=122,c3=7.86 where c1=1 and c2=1.23;
select * from t1;
eval select * from $table_name;
eval select * from $table_name1;
eval select * from $table_name2;
eval select * from $table_name3;
eval select * from $table_name4;

###2-14:修改非主键datetime类型
update t1 set c4='4445-01-08 12:00:55' where c1=1 and c2=1.23;
select * from t1;
eval select * from $table_name;
eval select * from $table_name1;
eval select * from $table_name2;
eval select * from $table_name3;
eval select * from $table_name4;

###2-15:修改非主键decimal type
update t1 set c8=1.131,c6=7.892 where c1=1 and c2=1.23;
select * from t1;
eval select * from $table_name;
eval select * from $table_name1;
eval select * from $table_name2;
eval select * from $table_name3;
eval select * from $table_name4;

###2-16:修改非主键varchar type
update t1 set c7='alittlegril',c8=4.554 where c1=1 and c2=1.23;
select * from t1;
eval select * from $table_name;
eval select * from $table_name1;
eval select * from $table_name2;
eval select * from $table_name3;
eval select * from $table_name4;

###2-17:修改非主键double type
update t1 set c3=3.38565,c6=8.66842 where c1=1 and c2=1.23;
select * from t1;
eval select * from $table_name;
eval select * from $table_name1;
eval select * from $table_name2;
eval select * from $table_name3;
eval select * from $table_name4;

###2-18:同时修改不包含主键的int,double类型
update t1 set c9=9/7,c3=4.56*7.89 where c1=2 and c2=1.23;
select * from t1;
eval select * from $table_name;
eval select * from $table_name1;
eval select * from $table_name2;
eval select * from $table_name3;
eval select * from $table_name4;

###2-19:同时修改不包含主键的double和real类型，加之计算式，calculate index column
update t1 set c3=1.2365655*12.54,c6=7.58/9.5412 where c1=2 and c2=1.23;
select * from t1;
eval select * from $table_name;
eval select * from $table_name1;
eval select * from $table_name2;
eval select * from $table_name3;
eval select * from $table_name4;

###2-20:同时修改不包含主键的real,bool类型，calculate storing column
update t1 set c6=8/18,c5=8-8 where c1=2 and c2=1.23;
select * from t1;
eval select * from $table_name;
eval select * from $table_name1;
eval select * from $table_name2;
eval select * from $table_name3;
eval select * from $table_name4;

###2-21:同时修改不包含主键的decimal和int类型，加之计算式，calculate decimal column
--error 58
update t1 set c8=4569/9,c9=87*554 where c1=2 and c2=1.23;
select * from t1;
eval select * from $table_name;
eval select * from $table_name1;
eval select * from $table_name2;
eval select * from $table_name3;
eval select * from $table_name4;

###2-22:同时修改不包含主键的int,real类型，加之计算式
update t1 set c9=c1+123,c6=c3-5.941 where c1=2 and c2=1.23;
select * from t1;
eval select * from $table_name;
eval select * from $table_name1;
eval select * from $table_name2;
eval select * from $table_name3;
eval select * from $table_name4;

###2-23:同时修改非主键的decimal和double类型，加之计算式
update t1 set c8=c2+7.981,c3=c6*5.6561 where c1=2 and c2=1.23;
select * from t1;
eval select * from $table_name;
eval select * from $table_name1;
eval select * from $table_name2;
eval select * from $table_name3;
eval select * from $table_name4;

###2-24:修改非主键的real类型，加之计算式
update t1 set c6=c3*4354.96 where c1=2 and c2=1.23;
select * from t1;
eval select * from $table_name;
eval select * from $table_name1;
eval select * from $table_name2;
eval select * from $table_name3;
eval select * from $table_name4;

###2-25:加之事务进行测试，修改非主键int类型
set autocommit=0;
update t1 set c9=88 where c1=1 and c2=1.23;
select * from t1;
eval select * from $table_name;
eval select * from $table_name1;
eval select * from $table_name2;
eval select * from $table_name3;
eval select * from $table_name4;
commit;
select * from t1;
eval select * from $table_name;
eval select * from $table_name1;
eval select * from $table_name2;
eval select * from $table_name3;
eval select * from $table_name4;

###2-26:结合事务,修改非主键datetime类型
update t1 set c4='2011-02-13' where c1=1 and c2=1.23;
select * from t1;
eval select * from $table_name;
eval select * from $table_name1;
eval select * from $table_name2;
eval select * from $table_name3;
eval select * from $table_name4;
commit;
select * from t1;
eval select * from $table_name;
eval select * from $table_name1;
eval select * from $table_name2;
eval select * from $table_name3;
eval select * from $table_name4;

###2-27:修改非主键decimal type
update t1 set c8=9.654 where c1=1 and c2=1.23;
select * from t1;
eval select * from $table_name;
eval select * from $table_name1;
eval select * from $table_name2;
eval select * from $table_name3;
eval select * from $table_name4;
commit;
select * from t1;
eval select * from $table_name;
eval select * from $table_name1;
eval select * from $table_name2;
eval select * from $table_name3;
eval select * from $table_name4;

###2-28:非主键varchar type
update t1 set c7='during ' where c1=1 and c2=1.23;
select * from t1;
eval select * from $table_name;
eval select * from $table_name1;
eval select * from $table_name2;
eval select * from $table_name3;
eval select * from $table_name4;
commit;
select * from t1;
eval select * from $table_name;
eval select * from $table_name1;
eval select * from $table_name2;
eval select * from $table_name3;
eval select * from $table_name4;

###2-29:非主键double类型
update t1 set c3=5.89 where c1=1 and c2=1.23;
select * from t1;
eval select * from $table_name;
eval select * from $table_name1;
eval select * from $table_name2;
eval select * from $table_name3;
eval select * from $table_name4;
commit;
select * from t1;
eval select * from $table_name;
eval select * from $table_name1;
eval select * from $table_name2;
eval select * from $table_name3;
eval select * from $table_name4;

###2-30:非主键int类型,加之计算式
update t1 set c9=9*5 where c1=2 and c2=1.23;
select * from t1;
eval select * from $table_name;
eval select * from $table_name1;
eval select * from $table_name2;
eval select * from $table_name3;
eval select * from $table_name4;
commit;
select * from t1;
eval select * from $table_name;
eval select * from $table_name1;
eval select * from $table_name2;
eval select * from $table_name3;
eval select * from $table_name4;

###2-31:修改非主键double类型,calculate index cloumn
update t1 set c3=8*12.54 where c1=2 and c2=1.23;
select * from t1;
eval select * from $table_name;
eval select * from $table_name1;
eval select * from $table_name2;
eval select * from $table_name3;
eval select * from $table_name4;
commit;
select * from t1;
eval select * from $table_name;
eval select * from $table_name1;
eval select * from $table_name2;
eval select * from $table_name3;
eval select * from $table_name4;


###2-32:修改非主键real类型,calculate storing column
update t1 set c6=89/3 where c1=2 and c2=1.23;
select * from t1;
eval select * from $table_name;
eval select * from $table_name1;
eval select * from $table_name2;
eval select * from $table_name3;
eval select * from $table_name4;
commit;
select * from t1;
eval select * from $table_name;
eval select * from $table_name1;
eval select * from $table_name2;
eval select * from $table_name3;
eval select * from $table_name4;

###2-33:非主键decimal类型,加之计算式
update t1 set c8=87/9 where c1=2 and c2=1.23;
select * from t1;
eval select * from $table_name;
eval select * from $table_name1;
eval select * from $table_name2;
eval select * from $table_name3;
eval select * from $table_name4;
commit;
select * from t1;
eval select * from $table_name;
eval select * from $table_name1;
eval select * from $table_name2;
eval select * from $table_name3;
eval select * from $table_name4;

###2-34:修改非主键int类型,加之计算式cloumn +number
update t1 set c9=c1*88 where c1=2 and c2=1.23;
select * from t1;
eval select * from $table_name;
eval select * from $table_name1;
eval select * from $table_name2;
eval select * from $table_name3;
eval select * from $table_name4;
commit;
select * from t1;
eval select * from $table_name;
eval select * from $table_name1;
eval select * from $table_name2;
eval select * from $table_name3;
eval select * from $table_name4;

###2-35:修改非主键decimal类型,加之计算式,即cloumn+ number
update t1 set c8=c2+4.56 where c1=2 and c2=1.23;
select * from t1;
eval select * from $table_name;
eval select * from $table_name1;
eval select * from $table_name2;
eval select * from $table_name3;
eval select * from $table_name4;
commit;
select * from t1;
eval select * from $table_name;
eval select * from $table_name1;
eval select * from $table_name2;
eval select * from $table_name3;
eval select * from $table_name4;

###2-36:非主键double type,加之计算式,即cloumn+number
update t1 set c6=c3*5.396 where c1=2 and c2=1.23;
select * from t1;
eval select * from $table_name;
eval select * from $table_name1;
eval select * from $table_name2;
eval select * from $table_name3;
eval select * from $table_name4;
commit;
select * from t1;
eval select * from $table_name;
eval select * from $table_name1;
eval select * from $table_name2;
eval select * from $table_name3;
eval select * from $table_name4;

###2-37:修改非主键int+double类型
update t1 set c9=1,c3=0 where c1=1 and c2=1.23;
select * from t1;
eval select * from $table_name;
eval select * from $table_name1;
eval select * from $table_name2;
eval select * from $table_name3;
eval select * from $table_name4;
commit;
select * from t1;
eval select * from $table_name;
eval select * from $table_name1;
eval select * from $table_name2;
eval select * from $table_name3;
eval select * from $table_name4;

###2-38:同时修改datetime+bool类型，非主键
update t1 set c4='4445-01-08 12:00:55' ,c5=0 where c1=1 and c2=1.23;
select * from t1;
eval select * from $table_name;
eval select * from $table_name1;
eval select * from $table_name2;
eval select * from $table_name3;
eval select * from $table_name4;
commit;
select * from t1;
eval select * from $table_name;
eval select * from $table_name1;
eval select * from $table_name2;
eval select * from $table_name3;
eval select * from $table_name4;

###2-39:同时修改非主键ireal+decimal type
update t1 set c8=1.131,c6=7.892 where c1=1 and c2=1.23;
select * from t1;
eval select * from $table_name;
eval select * from $table_name1;
eval select * from $table_name2;
eval select * from $table_name3;
eval select * from $table_name4;
commit;
select * from t1;
eval select * from $table_name;
eval select * from $table_name1;
eval select * from $table_name2;
eval select * from $table_name3;
eval select * from $table_name4;

###2-40:同时修改varchar+ decimal type
update t1 set c7='alittlegril',c8=4.554 where c1=1 and c2=1.23;
select * from t1;
eval select * from $table_name;
eval select * from $table_name1;
eval select * from $table_name2;
eval select * from $table_name3;
eval select * from $table_name4;
commit;
select * from t1;
eval select * from $table_name;
eval select * from $table_name1;
eval select * from $table_name2;
eval select * from $table_name3;
eval select * from $table_name4;

###2-41:同时修改double+real类型
update t1 set c3=3.38565,c6=8.66842 where c1=1 and c2=1.23;
select * from t1;
eval select * from $table_name;
eval select * from $table_name1;
eval select * from $table_name2;
eval select * from $table_name3;
eval select * from $table_name4;
commit;
select * from t1;
eval select * from $table_name;
eval select * from $table_name1;
eval select * from $table_name2;
eval select * from $table_name3;
eval select * from $table_name4;

###2-42:同时修改int+double类型,非主键
update t1 set c9=9/7,c3=4.56*7.89 where c1=2 and c2=1.23;
select * from t1;
eval select * from $table_name;
eval select * from $table_name1;
eval select * from $table_name2;
eval select * from $table_name3;
eval select * from $table_name4;
commit;
select * from t1;
eval select * from $table_name;
eval select * from $table_name1;
eval select * from $table_name2;
eval select * from $table_name3;
eval select * from $table_name4;

###2-43:同时修改double+real类型，加之计算式
update t1 set c3=1.2365655*12.54,c6=7.58/9.5412 where c1=2 and c2=1.23;
select * from t1;
eval select * from $table_name;
eval select * from $table_name1;
eval select * from $table_name2;
eval select * from $table_name3;
eval select * from $table_name4;
commit;
select * from t1;
eval select * from $table_name;
eval select * from $table_name1;
eval select * from $table_name2;
eval select * from $table_name3;
eval select * from $table_name4;

###2-44:同时修改real+bool类型,加之计算式
update t1 set c6=8/18,c5=8-8 where c1=2 and c2=1.23;
select * from t1;
eval select * from $table_name;
eval select * from $table_name1;
eval select * from $table_name2;
eval select * from $table_name3;
eval select * from $table_name4;
commit;
select * from t1;
eval select * from $table_name;
eval select * from $table_name1;
eval select * from $table_name2;
eval select * from $table_name3;
eval select * from $table_name4;

###2-45:同时修改非主键decimal+int类型,加之计算式
--error 58
update t1 set c8=4569/9,c9=87*554 where c1=2 and c2=1.23;
select * from t1;
eval select * from $table_name;
eval select * from $table_name1;
eval select * from $table_name2;
eval select * from $table_name3;
eval select * from $table_name4;
commit;
select * from t1;
eval select * from $table_name;
eval select * from $table_name1;
eval select * from $table_name2;
eval select * from $table_name3;
eval select * from $table_name4;

###2-46:同时修改int+real类型,非主键,加之计算式
update t1 set c9=c1+123,c6=c3-5.941 where c1=2 and c2=1.23;
select * from t1;
eval select * from $table_name;
eval select * from $table_name1;
eval select * from $table_name2;
eval select * from $table_name3;
eval select * from $table_name4;
commit;
select * from t1;
eval select * from $table_name;
eval select * from $table_name1;
eval select * from $table_name2;
eval select * from $table_name3;
eval select * from $table_name4;

###2-47:同时修改非主键decimal+double类型,加之计算式
update t1 set c8=c2+7.981,c3=c6*5.6561 where c1=2 and c2=1.23;
select * from t1;
eval select * from $table_name;
eval select * from $table_name1;
eval select * from $table_name2;
eval select * from $table_name3;
eval select * from $table_name4;
commit;
select * from t1;
eval select * from $table_name;
eval select * from $table_name1;
eval select * from $table_name2;
eval select * from $table_name3;
eval select * from $table_name4;


###2-48:同时修改非主键real类型，加之计算式，形式为cloumn+number
update t1 set c6=c3*4354.96 where c1=2 and c2=1.23;
select * from t1;
eval select * from $table_name;
eval select * from $table_name1;
eval select * from $table_name2;
eval select * from $table_name3;
eval select * from $table_name4;
commit;
select * from t1;
eval select * from $table_name;
eval select * from $table_name1;
eval select * from $table_name2;
eval select * from $table_name3;
eval select * from $table_name4;

drop table t1;

###///新添测试项///###
###2-x:(新增测试项说明)
#do sql
########################################################################################################
