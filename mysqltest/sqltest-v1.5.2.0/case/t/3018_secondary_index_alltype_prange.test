--source merge.sql
##############################################################################################
###1.测试功能点：分别在指定相同range分区规则下，测试相同字段不同表名的数据表中，创建相同索引以及索引列之间的字段类型的组合方式
##
#
###2.测试项：(每新添一测试项，需在添加前注明测试项，注释填写在新添sq1前，不填在此处，如下样例）
###3.问题网址：xxx
###4.问题号：xxx
###5.预计运行时间：1113s
###6.编写/修改人：zhuyinying
###7.编写/修改日期：2019-10-10
###8.其他（选填）：case格式规范化修改
###
##
#
##############################################################################################

#####################################Do sql###################################################
alter system set balance_max_concurrent_migrate_num=30 server_type=yaoadminsvr;
alter system set balance_max_migrate_in_per_ds=6 server_type=yaoadminsvr;
alter system set balance_max_migrate_out_per_ds=6 server_type=yaoadminsvr;
alter system set max_migrate_task_count=6 server_type=yaodatasvr;
--disable_warnings
drop table if exists t1;
drop table if exists t2;
drop table if exists t3;
drop table if exists t4;
--enable_warnings
--disable_query_log
--enable_query_log



create table t1 (c1 int primary key,c2 varchar(8),c3 bool,c4 datetime,c5 decimal(4,3)) partition by range(c1) (partition r0 values less than (5),partition r1 values less than (10),partition r2 values less than (15),partition r3 values less than maxvalue);

create index il on t1(c2) storing (c3);
create index il1 on t1(c3) storing (c4);
create index il2 on t1(c4) storing (c5);
create index il3 on t1(c5) storing (c2);

create table t2 (c1 int primary key,c2 varchar(8),c3 bool,c4 datetime,c5 decimal(4,3)) partition by range(c1) (partition r0 values less than (5),partition r1 values less than (10),partition r2 values less than (15),partition r3 values less than maxvalue);

create index il on t2(c2,c3) storing (c4);
create index il1 on t2(c3,c4) storing (c5);
create index il2 on t2(c4,c5) storing (c2);
create index il3 on t2(c5,c2) storing (c3);

create table t3 (c1 int primary key,c2 varchar(8),c3 bool,c4 datetime,c5 decimal(4,3)) partition by range(c1) (partition r0 values less than (5),partition r1 values less than (10),partition r2 values less than (15),partition r3 values less than maxvalue);

create index il on t3(c2,c3) storing (c4);
create index il1 on t3(c3,c4) storing (c5);
create index il2 on t3(c4,c5) storing (c2);
create index il3 on t3(c5,c2) storing (c3);

--echo "merge"
exec $LOCAL_DIR/tools/as_admin -r $RS0_IP -p $RS0_PORT major_freeze | tail -1;
--real_sleep 800
exec $LOCAL_DIR/tools/as_admin -r $RS0_IP -p $RS0_PORT stat -o merge | tail -1;

insert into t1 values(1,'maosi',0,'2015-01-01 12:00:00',3.142),(2,'zhangd',1,'1258-04-09 12:24:00',3.438),(3,'peioy',1,'1258-04-09 12:24:00',3.438),(4,'shil',1,'1258-04-09 12:24:00',3.438),(5,'shidi',1,'1258-04-09 12:24:00',3.438),(6,'linf',1,'1258-04-09 12:24:00',3.438),(7,'guot',1,'1258-04-09 12:24:00',3.438),(8,'lzf',1,'1258-04-09 12:24:00',3.438),(9,'aaa',1,'1258-04-09 12:24:00',3.438),(10,'bbb',1,'1258-04-09 12:24:00',3.438),(11,'ccc',1,'1258-04-09 12:24:00',3.438),(12,'ddd',1,'1258-04-09 12:24:00',3.438),(13,'eee',1,'1258-04-09 12:24:00',3.438),(14,'fff',1,'1258-04-09 12:24:00',3.438);
let $n=query_get_value(select table_id from __first_tablet_entry where table_name='t1',table_id,1);
--let $table_head =__
--let $table_end =__idx__il
--let $table_name=$table_head$n$table_end
eval select * from $table_name;
--let $table_end=__idx__il1
--let $table_name=$table_head$n$table_end
eval select * from $table_name;
--let $table_end=__idx__il2
--let $table_name=$table_head$n$table_end
eval select * from $table_name;
--let $table_end=__idx__il3
--let $table_name=$table_head$n$table_end
eval select * from $table_name;


insert into t2 values(1,'maosi',0,'2015-01-01 12:00:00',3.142),(2,'zhangd',1,'1258-04-09 12:24:00',3.438),(3,'peioy',1,'1258-04-09 12:24:00',3.438),(4,'shil',1,'1258-04-09 12:24:00',3.438),(5,'shidi',1,'1258-04-09 12:24:00',3.438),(6,'linf',1,'1258-04-09 12:24:00',3.438),(7,'guot',1,'1258-04-09 12:24:00',3.438),(8,'lzf',1,'1258-04-09 12:24:00',3.438),(9,'aaa',1,'1258-04-09 12:24:00',3.438),(10,'bbb',1,'1258-04-09 12:24:00',3.438),(11,'ccc',1,'1258-04-09 12:24:00',3.438),(12,'ddd',1,'1258-04-09 12:24:00',3.438),(13,'eee',1,'1258-04-09 12:24:00',3.438),(14,'fff',1,'1258-04-09 12:24:00',3.438);
let $n=query_get_value(select table_id from __first_tablet_entry where table_name='t1',table_id,1);
--let $table_head =__
--let $table_end =__idx__il
--let $table_name=$table_head$n$table_end
eval select * from $table_name;
--let $table_end=__idx__il1
--let $table_name=$table_head$n$table_end
eval select * from $table_name;
--let $table_end=__idx__il2
--let $table_name=$table_head$n$table_end
eval select * from $table_name;
--let $table_end=__idx__il3
--let $table_name=$table_head$n$table_end
eval select * from $table_name;


insert into t3 values(1,'maosi',0,'2015-01-01 12:00:00',3.142),(2,'zhangd',1,'1258-04-09 12:24:00',3.438),(3,'peioy',1,'1258-04-09 12:24:00',3.438),(4,'shil',1,'1258-04-09 12:24:00',3.438),(5,'shidi',1,'1258-04-09 12:24:00',3.438),(6,'linf',1,'1258-04-09 12:24:00',3.438),(7,'guot',1,'1258-04-09 12:24:00',3.438),(8,'lzf',1,'1258-04-09 12:24:00',3.438),(9,'aaa',1,'1258-04-09 12:24:00',3.438),(10,'bbb',1,'1258-04-09 12:24:00',3.438),(11,'ccc',1,'1258-04-09 12:24:00',3.438),(12,'ddd',1,'1258-04-09 12:24:00',3.438),(13,'eee',1,'1258-04-09 12:24:00',3.438),(14,'fff',1,'1258-04-09 12:24:00',3.438);
let $n=query_get_value(select table_id from __first_tablet_entry where table_name='t1',table_id,1);
--let $table_head =__
--let $table_end =__idx__il
--let $table_name=$table_head$n$table_end
eval select * from $table_name;
--let $table_end=__idx__il1
--let $table_name=$table_head$n$table_end
eval select * from $table_name;
--let $table_end=__idx__il2
--let $table_name=$table_head$n$table_end
eval select * from $table_name;
--let $table_end=__idx__il3
--let $table_name=$table_head$n$table_end
eval select * from $table_name;

###///新添测试项///###
###2-x:(新增测试项说明)
#do sql
########################################################################################################
